---
:platform:
  :name: azure
  :release: azure_mgmt_resources-v0.18.2
  :target_id: e2929914-5fda-5e55-9897-c5b85179231f
:profiles:
- :name: cis-azure-foundations-level1-v1.5.0
  :version: 1.5.0-1
  :sha256: 66699606ba4a4a8c30cea132c8dc7752007cf3712dda1c1f608f4187d915521f
  :title: CIS Azure Foundations Benchmark 1.5.0 Level 1
  :maintainer: Chef Software, Inc.
  :summary: A profile to test coverage of the CIS Azure Foundations Benchmark 1.5.0
    Level 1
  :license: Proprietary, All rights reserved
  :copyright: Chef Software, Inc.
  :copyright_email: support@chef.io
  :supports: []
  :attributes:
  - :name: additional_email_addresses
    :options:
      :type: Array
      :value: []
  - :name: provided_resource_group
    :options:
      :value:
      - ResourceMoverRG-westus-eastus2-eus2
      - butler-sa
      - cloud-custodian
      - DefaultResourceGroup-EUS
      - AzureBackupRG_eastus_1
      - cloud-shell-storage-eastus
      - NetworkWatcherRG
      - DEFAULT-EVENTGRID
      - sa-jmaz
      - azure-dns-rg
      - habitat_windows_workstations
  - :name: approved_extensions
    :options:
      :value: []
  :depends:
  - :name: inspec-azure
    :url: https://github.com/inspec/inspec-azure/archive/refs/tags/v1.118.32.tar.gz
    :status: loaded
  :groups:
  - :id: controls/translated-controls.rb
    :controls:
    - 1.1.1
    - 1.1.2
    - 1.1.4
    - 1.2.3
    - 1.2.4
    - 1.2.5
    - 1.2.6
    - '1.4'
    - '1.5'
    - '1.6'
    - '1.7'
    - '1.8'
    - '1.9'
    - '1.10'
    - '1.13'
    - '1.17'
    - '1.22'
    - '1.23'
    - 2.2.1
    - 2.3.1
    - 2.3.2
    - 2.3.3
    - '2.5'
    - '2.6'
    - '3.1'
    - '3.3'
    - '3.4'
    - '3.6'
    - '3.7'
    - '3.8'
    - '3.10'
    - '3.11'
    - '3.15'
    - 4.1.1
    - 4.1.2
    - 4.1.4
    - 4.1.5
    - 4.1.6
    - 4.2.5
    - 4.3.1
    - 4.3.2
    - 4.3.3
    - 4.3.4
    - 4.3.5
    - 4.3.6
    - 4.3.7
    - 4.3.8
    - 4.4.1
    - 4.4.2
    - 5.1.1
    - 5.1.3
    - 5.1.5
    - 5.2.1
    - 5.2.2
    - 5.2.3
    - 5.2.4
    - 5.2.5
    - 5.2.6
    - 5.2.7
    - 5.2.8
    - 5.2.9
    - 5.2.10
    - '5.3'
    - '6.1'
    - '6.2'
    - '6.3'
    - '6.4'
    - '6.7'
    - '7.1'
    - '7.4'
    - '8.1'
    - '8.2'
    - '8.3'
    - '8.4'
    - '8.5'
    - '9.2'
    - '9.3'
    - '9.5'
    - '9.6'
    - '9.7'
    - '9.8'
    - '9.9'
    - '9.10'
  :controls:
  - :id: 1.1.1
    :title: Ensure Security Defaults is enabled on Azure Active Directory
    :desc: "Security defaults in Azure Active Directory (Azure AD) make it easier
      to be secure \nand help protect your organization. Security defaults contain
      preconfigured \nsecurity settings for common attacks.\n\nMicrosoft is making
      security defaults available to everyone. The goal is to ensure \nthat all organizations
      have a basic level of security enabled at no extra cost. \nYou may turn on security
      defaults in the Azure portal.\n\nSecurity defaults provide secure default settings
      that we manage on behalf of \norganizations to keep customers safe until they
      are ready to manage their own identity \nsecurity settings.\n\nFor example,
      doing the following:\n* Requiring all users and admins to register for MFA.\n*
      Challenging users with MFA - mostly when they show up on a new device or app,
      but more \n  often for critical roles and tasks.\n* Disabling authentication
      from legacy authentication clients, which can't do MFA."
    :descriptions:
    - :label: default
      :data: "Security defaults in Azure Active Directory (Azure AD) make it easier
        to be secure \nand help protect your organization. Security defaults contain
        preconfigured \nsecurity settings for common attacks.\n\nMicrosoft is making
        security defaults available to everyone. The goal is to ensure \nthat all
        organizations have a basic level of security enabled at no extra cost. \nYou
        may turn on security defaults in the Azure portal.\n\nSecurity defaults provide
        secure default settings that we manage on behalf of \norganizations to keep
        customers safe until they are ready to manage their own identity \nsecurity
        settings.\n\nFor example, doing the following:\n* Requiring all users and
        admins to register for MFA.\n* Challenging users with MFA - mostly when they
        show up on a new device or app, but more \n  often for critical roles and
        tasks.\n* Disabling authentication from legacy authentication clients, which
        can't do MFA."
    :impact: 0.0
    :refs: []
    :tags:
      :cis: azure:1.1.1
      :level: 1
    :code: "control '1.1.1' do\n  title 'Ensure Security Defaults is enabled on Azure
      Active Directory'\n  impact 0.0\n  tag cis: 'azure:1.1.1'\n  tag level: 1\n
      \ desc <<-DESC\n    Security defaults in Azure Active Directory (Azure AD) make
      it easier to be secure \n    and help protect your organization. Security defaults
      contain preconfigured \n    security settings for common attacks.\n\n    Microsoft
      is making security defaults available to everyone. The goal is to ensure \n
      \   that all organizations have a basic level of security enabled at no extra
      cost. \n    You may turn on security defaults in the Azure portal.\n\n    Security
      defaults provide secure default settings that we manage on behalf of \n    organizations
      to keep customers safe until they are ready to manage their own identity \n
      \   security settings.\n\n    For example, doing the following:\n    * Requiring
      all users and admins to register for MFA.\n    * Challenging users with MFA
      - mostly when they show up on a new device or app, but more \n      often for
      critical roles and tasks.\n    * Disabling authentication from legacy authentication
      clients, which can't do MFA.\n  DESC\n\n  describe 'no API support' do\n    skip
      'No Azure API support. Alternative Audit Procedure:\n\n    From Azure Portal:\n\n
      \   To ensure security defaults is enabled in your directory:\n    1. From Azure
      Home select the Portal Menu.\n    2. Browse to Azure Active Directory > Properties.\n
      \   3. Select Manage security defaults.\n    4. Verify the Enable security defaults
      toggle is Yes.'\n  end\nend\n"
    :source_location:
      :line: 71
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 1.593e-05
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:

            From Azure Portal:

            To ensure security defaults is enabled in your directory:
            1. From Azure Home select the Portal Menu.
            2. Browse to Azure Active Directory > Properties.
            3. Select Manage security defaults.
            4. Verify the Enable security defaults toggle is Yes.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: 1.1.2
    :title: Ensure that 'Multi-Factor Auth Status' is 'Enabled' for all Privileged
      Users
    :desc: "Enable multi-factor authentication for all roles, groups, and users that
      have write\naccess or permissions to Azure resources. These include custom created
      objects or \nbuilt-in roles such as;\n\n* Service Co-Administrators\n* Subscription
      Owners\n* Contributors\n\nMulti-factor authentication requires an individual
      to present a minimum of two separate \nforms of authentication before access
      is granted. Multi-factor authentication provides \nadditional assurance that
      the individual attempting to gain access is who they claim to \nbe. With multi-factor
      authentication, an attacker would need to compromise at least two \ndifferent
      authentication mechanisms, increasing the difficulty of compromise and thus
      \nreducing the risk."
    :descriptions:
    - :label: default
      :data: "Enable multi-factor authentication for all roles, groups, and users
        that have write\naccess or permissions to Azure resources. These include custom
        created objects or \nbuilt-in roles such as;\n\n* Service Co-Administrators\n*
        Subscription Owners\n* Contributors\n\nMulti-factor authentication requires
        an individual to present a minimum of two separate \nforms of authentication
        before access is granted. Multi-factor authentication provides \nadditional
        assurance that the individual attempting to gain access is who they claim
        to \nbe. With multi-factor authentication, an attacker would need to compromise
        at least two \ndifferent authentication mechanisms, increasing the difficulty
        of compromise and thus \nreducing the risk."
    :impact: 0.0
    :refs: []
    :tags:
      :cis: azure:1.1.2
      :level: 1
    :code: "control '1.1.2' do\n  title \"Ensure that 'Multi-Factor Auth Status' is
      'Enabled' for all Privileged Users\"\n  impact 0.0\n  tag cis: 'azure:1.1.2'\n
      \ tag level: 1\n  desc <<-DESC\n    Enable multi-factor authentication for all
      roles, groups, and users that have write\n    access or permissions to Azure
      resources. These include custom created objects or \n    built-in roles such
      as;\n    \n    * Service Co-Administrators\n    * Subscription Owners\n    *
      Contributors\n\n    Multi-factor authentication requires an individual to present
      a minimum of two separate \n    forms of authentication before access is granted.
      Multi-factor authentication provides \n    additional assurance that the individual
      attempting to gain access is who they claim to \n    be. With multi-factor authentication,
      an attacker would need to compromise at least two \n    different authentication
      mechanisms, increasing the difficulty of compromise and thus \n    reducing
      the risk.\n  DESC\n\n  describe 'no API support' do\n    skip 'No Azure API
      support. Alternative Audit Procedure:\n\n    From Azure Portal:\n\n    1. From
      Azure Home select the Portal Menu\n    2. Select the Azure Active Directory
      blade\n    3. Then Users\n    4. All Users\n    5. Click on the Per-User MFA
      button in the top row menu\n    6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled
      for all users who are Service\n       Co-Administrators, Owners, OR Contributors.'\n
      \ end\nend\n"
    :source_location:
      :line: 109
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 3.956e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:

            From Azure Portal:

            1. From Azure Home select the Portal Menu
            2. Select the Azure Active Directory blade
            3. Then Users
            4. All Users
            5. Click on the Per-User MFA button in the top row menu
            6. Ensure that MULTI-FACTOR AUTH STATUS is Enabled for all users who are Service
               Co-Administrators, Owners, OR Contributors.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: 1.1.4
    :title: Ensure that 'Restore multi-factor authentication on all remembered devices'
      is Enabled
    :desc: "Do not allow users to remember multi-factor authentication on devices.\n\nRemembering
      Multi-Factor Authentication (MFA) for devices and browsers allows users to have
      the\noption to bypass MFA for a set number of days after performing a successful
      sign-in using MFA. \nThis can enhance usability by minimizing the number of
      times a user may need to perform two-step \nverification on the same device.
      However, if an account or device is compromised, remembering \nMFA for trusted
      devices may affect security. Hence, it is recommended that users not be allowed
      \nto bypass MFA."
    :descriptions:
    - :label: default
      :data: "Do not allow users to remember multi-factor authentication on devices.\n\nRemembering
        Multi-Factor Authentication (MFA) for devices and browsers allows users to
        have the\noption to bypass MFA for a set number of days after performing a
        successful sign-in using MFA. \nThis can enhance usability by minimizing the
        number of times a user may need to perform two-step \nverification on the
        same device. However, if an account or device is compromised, remembering
        \nMFA for trusted devices may affect security. Hence, it is recommended that
        users not be allowed \nto bypass MFA."
    :impact: 0.0
    :refs: []
    :tags:
      :cis: azure:1.1.4
      :level: 1
    :code: "control '1.1.4' do\n  title \"Ensure that 'Restore multi-factor authentication
      on all remembered devices' is Enabled\"\n  impact 0.0\n  tag cis: 'azure:1.1.4'\n
      \ tag level: 1\n  desc <<-DESC\n    Do not allow users to remember multi-factor
      authentication on devices.\n\n    Remembering Multi-Factor Authentication (MFA)
      for devices and browsers allows users to have the\n    option to bypass MFA
      for a set number of days after performing a successful sign-in using MFA. \n
      \   This can enhance usability by minimizing the number of times a user may
      need to perform two-step \n    verification on the same device. However, if
      an account or device is compromised, remembering \n    MFA for trusted devices
      may affect security. Hence, it is recommended that users not be allowed \n    to
      bypass MFA.\n  DESC\n\n  describe 'no API support' do\n    skip 'No Azure API
      support. Alternative Audit Procedure:\n\n    From Azure Portal:\n\n    1. From
      Azure Home select the Portal Menu\n    2. Select the Azure Active Directory\n
      \   3. Then Users\n    4. Select All Users\n    5. Click on Per-User MFA button
      on the top bar\n    6. Select User(s) and click on Manage user settings in the
      right column\n    7. Ensure that Restore multi-factor authentication on all
      remembered devices is enabled'\n  end\nend\n"
    :source_location:
      :line: 146
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 3.601e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:

            From Azure Portal:

            1. From Azure Home select the Portal Menu
            2. Select the Azure Active Directory
            3. Then Users
            4. Select All Users
            5. Click on Per-User MFA button on the top bar
            6. Select User(s) and click on Manage user settings in the right column
            7. Ensure that Restore multi-factor authentication on all remembered devices is enabled
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: 1.2.3
    :title: Ensure that A Multi-factor Authentication Policy Exists for Administrative
      Groups
    :desc: |-
      For designated users, they will be prompted to use their multi-factor authentication (MFA)
      process on login.

      Enabling multi-factor authentication is a recommended setting to limit the use of
      Administrative accounts to authenticated personnel.
    :descriptions:
    - :label: default
      :data: |-
        For designated users, they will be prompted to use their multi-factor authentication (MFA)
        process on login.

        Enabling multi-factor authentication is a recommended setting to limit the use of
        Administrative accounts to authenticated personnel.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.2.3
      :level: 1
    :code: |
      control '1.2.3' do
        title 'Ensure that A Multi-factor Authentication Policy Exists for Administrative Groups'
        impact 1.0
        tag cis: 'azure:1.2.3'
        tag level: 1
        desc <<-DESC
          For designated users, they will be prompted to use their multi-factor authentication (MFA)
          process on login.

          Enabling multi-factor authentication is a recommended setting to limit the use of
          Administrative accounts to authenticated personnel.
        DESC

        describe 'Manual check' do
          skip('There is no automatic check for this control.
          To ensure that A Multi-factor Authentication Policy Exists for Administrative Groups:
          From Azure Portal,
          1. From Azure Home open the Portal Menu in the top left, and select Azure Active Directory.
          2. Scroll down in the menu on the left, and select Security.
          3. Select on the left side Conditional Access.
          4. Select the policy you wish to audit.
          5. View under Users and Groups the corresponding users and groups to whom the policy is applied.
          Be certain the emergency access account is not in the list.
          6. View under Exclude to determine which Users and groups to whom the policy is not applied.')
        end
      end
    :source_location:
      :line: 177
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 3.129e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control.
            To ensure that A Multi-factor Authentication Policy Exists for Administrative Groups:
            From Azure Portal,
            1. From Azure Home open the Portal Menu in the top left, and select Azure Active Directory.
            2. Scroll down in the menu on the left, and select Security.
            3. Select on the left side Conditional Access.
            4. Select the policy you wish to audit.
            5. View under Users and Groups the corresponding users and groups to whom the policy is applied.
            Be certain the emergency access account is not in the list.
            6. View under Exclude to determine which Users and groups to whom the policy is not applied.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: 1.2.4
    :title: Ensure that A Multi-factor Authentication Policy Exists for All Users
    :desc: |-
      For designated users, they will be prompted to use their multi-factor authentication (MFA)
      process on logins.

      Enabling multi-factor authentication is a recommended setting to limit the potential of
      accounts being compromised and limiting access to authenticated personnel.
    :descriptions:
    - :label: default
      :data: |-
        For designated users, they will be prompted to use their multi-factor authentication (MFA)
        process on logins.

        Enabling multi-factor authentication is a recommended setting to limit the potential of
        accounts being compromised and limiting access to authenticated personnel.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.2.4
      :level: 1
    :code: |
      control '1.2.4' do
        title 'Ensure that A Multi-factor Authentication Policy Exists for All Users'
        impact 1.0
        tag cis: 'azure:1.2.4'
        tag level: 1
        desc <<-DESC
          For designated users, they will be prompted to use their multi-factor authentication (MFA)
          process on logins.

          Enabling multi-factor authentication is a recommended setting to limit the potential of
          accounts being compromised and limiting access to authenticated personnel.
        DESC

        describe 'Manual check' do
          skip('There is no automatic check for this control.
          To ensure that A Multi-factor Authentication Policy Exists for All Users:
          From Azure Portal,
          1. From Azure Home open the Portal Menu in the top left, and select Azure Active Directory.
          2. Scroll down in the menu on the left, and select Security.
          3. Select on the left side Conditional Access.
          4. Select the policy you wish to audit.
          5. View under Users and Groups the corresponding users and groups to whom the policy is applied.
          6. View under Exclude to determine which users and groups to whom the policy is not applied.')
        end
      end
    :source_location:
      :line: 204
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 3.025e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control.
            To ensure that A Multi-factor Authentication Policy Exists for All Users:
            From Azure Portal,
            1. From Azure Home open the Portal Menu in the top left, and select Azure Active Directory.
            2. Scroll down in the menu on the left, and select Security.
            3. Select on the left side Conditional Access.
            4. Select the policy you wish to audit.
            5. View under Users and Groups the corresponding users and groups to whom the policy is applied.
            6. View under Exclude to determine which users and groups to whom the policy is not applied.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: 1.2.5
    :title: Ensure Multi-factor Authentication is Required for Risky Sign-ins
    :desc: |-
      For designated users, they will be prompted to use their multi-factor authentication (MFA)
      process on login.

      Enabling multi-factor authentication is a recommended setting to limit the potential of accounts
      being compromised and limiting access to authenticated personnel.
    :descriptions:
    - :label: default
      :data: |-
        For designated users, they will be prompted to use their multi-factor authentication (MFA)
        process on login.

        Enabling multi-factor authentication is a recommended setting to limit the potential of accounts
        being compromised and limiting access to authenticated personnel.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.2.5
      :level: 1
    :code: |
      control '1.2.5' do
        title 'Ensure Multi-factor Authentication is Required for Risky Sign-ins'
        impact 1.0
        tag cis: 'azure:1.2.5'
        tag level: 1
        desc <<-DESC
          For designated users, they will be prompted to use their multi-factor authentication (MFA)
          process on login.

          Enabling multi-factor authentication is a recommended setting to limit the potential of accounts
          being compromised and limiting access to authenticated personnel.
        DESC

        describe 'Manual check' do
          skip('There is no automatic check for this control.
          To ensure Multi-factor Authentication is Required for Risky Sign-ins:
          From Azure Portal,
          1. From Azure Home select the Portal Menu and select Security.
          2. Select on the left side Conditional Access.
          3. Select the policy you wish to audit.
          4. View under Users and Groups the corresponding users and groups to whom the policy is applied.
          5. View under Exclude to determine which users and groups to whom the policy is not applied.')
        end
      end
    :source_location:
      :line: 230
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 4.139e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control.
            To ensure Multi-factor Authentication is Required for Risky Sign-ins:
            From Azure Portal,
            1. From Azure Home select the Portal Menu and select Security.
            2. Select on the left side Conditional Access.
            3. Select the policy you wish to audit.
            4. View under Users and Groups the corresponding users and groups to whom the policy is applied.
            5. View under Exclude to determine which users and groups to whom the policy is not applied.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: 1.2.6
    :title: Ensure Multi-factor Authentication is Required for Azure Management
    :desc: |-
      For designated users, they will be prompted to use their multi-factor authentication (MFA)
      process on logins.

      Enabling multi-factor authentication is a recommended setting to limit the use of
      Administrative actions and to prevent intruders from changing settings.
    :descriptions:
    - :label: default
      :data: |-
        For designated users, they will be prompted to use their multi-factor authentication (MFA)
        process on logins.

        Enabling multi-factor authentication is a recommended setting to limit the use of
        Administrative actions and to prevent intruders from changing settings.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.2.6
      :level: 1
    :code: |
      control '1.2.6' do
        title 'Ensure Multi-factor Authentication is Required for Azure Management'
        impact 1.0
        tag cis: 'azure:1.2.6'
        tag level: 1
        desc <<-DESC
          For designated users, they will be prompted to use their multi-factor authentication (MFA)
          process on logins.

          Enabling multi-factor authentication is a recommended setting to limit the use of
          Administrative actions and to prevent intruders from changing settings.
        DESC

        describe 'Manual check' do
          skip('There is no automatic check for this control.
          To ensure Multi-factor Authentication is Required for Azure Management:
          From Azure Portal,
          1. From Azure Home select the Portal Menu and select Azure Active Directory.
          2. Scroll down in the menu on the left, and select Security.
          3. Select on the left side Conditional Access.
          4. Select the policy you wish to audit.
          5. View under Users and Groups the corresponding users and groups to whom the policy is applied.
          6. View under Exclude to determine which Users and groups to whom the policy is not applied.')
        end
      end
    :source_location:
      :line: 255
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 3.21e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control.
            To ensure Multi-factor Authentication is Required for Azure Management:
            From Azure Portal,
            1. From Azure Home select the Portal Menu and select Azure Active Directory.
            2. Scroll down in the menu on the left, and select Security.
            3. Select on the left side Conditional Access.
            4. Select the policy you wish to audit.
            5. View under Users and Groups the corresponding users and groups to whom the policy is applied.
            6. View under Exclude to determine which Users and groups to whom the policy is not applied.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: '1.4'
    :title: Ensure Guest Users Are Reviewed on a Regular Basis
    :desc: |-
      Azure AD is extended to include Azure AD B2B collaboration, allowing you to invite people from
      outside your organization to be guest users in your cloud account and sign in with their own work,
      school, or social identities. Guest users allow you to share your company's applications and
      services with users from any other organization, while maintaining control over your own corporate data.

      Work with external partners, large or small, even if they don't have Azure AD or an IT department.
      A simple invitation and redemption process lets partners use their own credentials to access your
      company's resources as a guest user.

      Guest users in every subscription should be review on a regular basis to ensure that inactive and
      unneeded accounts are removed.

      Guest users in the Azure AD are generally required for collaboration purposes in Office 365, and
      may also be required for Azure functions in enterprises with multiple Azure tenants. Guest users
      are typically added outside your employee on-boarding/off-boarding process and could potentially
      be overlooked indefinitely, leading to a potential vulnerability. To prevent this, guest users should
      be reviewed on a regular basis. During this audit, guest users should also be determined to not have
      administrative privileges.
    :descriptions:
    - :label: default
      :data: |-
        Azure AD is extended to include Azure AD B2B collaboration, allowing you to invite people from
        outside your organization to be guest users in your cloud account and sign in with their own work,
        school, or social identities. Guest users allow you to share your company's applications and
        services with users from any other organization, while maintaining control over your own corporate data.

        Work with external partners, large or small, even if they don't have Azure AD or an IT department.
        A simple invitation and redemption process lets partners use their own credentials to access your
        company's resources as a guest user.

        Guest users in every subscription should be review on a regular basis to ensure that inactive and
        unneeded accounts are removed.

        Guest users in the Azure AD are generally required for collaboration purposes in Office 365, and
        may also be required for Azure functions in enterprises with multiple Azure tenants. Guest users
        are typically added outside your employee on-boarding/off-boarding process and could potentially
        be overlooked indefinitely, leading to a potential vulnerability. To prevent this, guest users should
        be reviewed on a regular basis. During this audit, guest users should also be determined to not have
        administrative privileges.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.4
      :level: 1
    :code: "control '1.4' do\n  title 'Ensure Guest Users Are Reviewed on a Regular
      Basis'\n  impact 1.0\n  tag cis: 'azure:1.4'\n  tag level: 1\n  desc <<-DESC\n
      \   Azure AD is extended to include Azure AD B2B collaboration, allowing you
      to invite people from\n    outside your organization to be guest users in your
      cloud account and sign in with their own work,\n    school, or social identities.
      Guest users allow you to share your company's applications and\n    services
      with users from any other organization, while maintaining control over your
      own corporate data.\n\n    Work with external partners, large or small, even
      if they don't have Azure AD or an IT department.\n    A simple invitation and
      redemption process lets partners use their own credentials to access your\n
      \   company's resources as a guest user.\n    \n    Guest users in every subscription
      should be review on a regular basis to ensure that inactive and\n    unneeded
      accounts are removed.\n\n    Guest users in the Azure AD are generally required
      for collaboration purposes in Office 365, and\n    may also be required for
      Azure functions in enterprises with multiple Azure tenants. Guest users\n    are
      typically added outside your employee on-boarding/off-boarding process and could
      potentially\n    be overlooked indefinitely, leading to a potential vulnerability.
      To prevent this, guest users should\n    be reviewed on a regular basis. During
      this audit, guest users should also be determined to not have\n    administrative
      privileges.\n  DESC\n\n  describe 'Manual check' do\n    skip('There is no automatic
      check for this control.\n    To ensure Guest Users Are Reviewed on a Regular
      Basis:\n    From Azure Portal,\n    1. From Azure Home select the Portal Menu\n
      \   2. Select Azure Active Directory\n    3. Then Users and group\n    4. Select
      All Users\n    5. Click on Add filters button, select User type, click Apply,
      select Guest, click Apply\n    6. Audit the listed guest users.')\n  end\nend\n"
    :source_location:
      :line: 281
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 3.03e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control.
            To ensure Guest Users Are Reviewed on a Regular Basis:
            From Azure Portal,
            1. From Azure Home select the Portal Menu
            2. Select Azure Active Directory
            3. Then Users and group
            4. Select All Users
            5. Click on Add filters button, select User type, click Apply, select Guest, click Apply
            6. Audit the listed guest users.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: '1.5'
    :title: " Ensure that 'Allow users to remember multi-factor authentication on
      devices they trust' is 'Disabled'"
    :desc: "Do not allow users to remember multi-factor authentication on devices.\n\nRemembering
      Multi-Factor Authentication (MFA) for devices and browsers allows users to have
      the option to bypass MFA \nfor a set number of days after performing a successful
      sign-in using MFA. \nThis can enhance usability by minimizing the number of
      times a user may need to perform two-step verification on the same device. \nHowever,
      if an account or device is compromised, remembering MFA for trusted devices
      may affect security. \nHence, it is recommended that users not be allowed to
      bypass MFA."
    :descriptions:
    - :label: default
      :data: "Do not allow users to remember multi-factor authentication on devices.\n\nRemembering
        Multi-Factor Authentication (MFA) for devices and browsers allows users to
        have the option to bypass MFA \nfor a set number of days after performing
        a successful sign-in using MFA. \nThis can enhance usability by minimizing
        the number of times a user may need to perform two-step verification on the
        same device. \nHowever, if an account or device is compromised, remembering
        MFA for trusted devices may affect security. \nHence, it is recommended that
        users not be allowed to bypass MFA."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.5
      :level: 1
    :code: "control '1.5' do\n  title \" Ensure that 'Allow users to remember multi-factor
      authentication on devices they trust' is 'Disabled'\"\n  impact 1.0\n  tag cis:
      'azure:1.5'\n  tag level: 1\n  desc <<-DESC\n    Do not allow users to remember
      multi-factor authentication on devices.\n\n    Remembering Multi-Factor Authentication
      (MFA) for devices and browsers allows users to have the option to bypass MFA
      \n    for a set number of days after performing a successful sign-in using MFA.
      \n    This can enhance usability by minimizing the number of times a user may
      need to perform two-step verification on the same device. \n    However, if
      an account or device is compromised, remembering MFA for trusted devices may
      affect security. \n    Hence, it is recommended that users not be allowed to
      bypass MFA.\n  DESC\n\n  describe 'no API support' do\n    skip 'No Azure API
      support. Alternative Audit Procedure:\n    On the Azure Console:\n\n    1. Go
      to Azure Active Directory\n    2. Go to Users\n    3. Go to All Users\n    4.
      Click on Multi-Factor Authentication button on the top bar\n    5. Click on
      service settings\n    6. Ensure that Allow users to remember multi-factor authentication
      on devices they trust is not enabled'\n  end\nend\n"
    :source_location:
      :line: 320
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 3.038e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:
            On the Azure Console:

            1. Go to Azure Active Directory
            2. Go to Users
            3. Go to All Users
            4. Click on Multi-Factor Authentication button on the top bar
            5. Click on service settings
            6. Ensure that Allow users to remember multi-factor authentication on devices they trust is not enabled
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.6'
    :title: Ensure That 'Number of methods required to reset' is set to '2'
    :desc: "Ensures that two alternate forms of identification are \nprovided before
      allowing a password reset.\n\nRationale: A Self-service Password Reset (SSPR)
      through Azure Multi-factor Authentication (MFA) ensures the user's \nidentity
      is confirmed using two separate methods of identification. With multiple methods
      set, an attacker \nwould have to compromise both methods before they could maliciously
      reset a user's password."
    :descriptions:
    - :label: default
      :data: "Ensures that two alternate forms of identification are \nprovided before
        allowing a password reset.\n\nRationale: A Self-service Password Reset (SSPR)
        through Azure Multi-factor Authentication (MFA) ensures the user's \nidentity
        is confirmed using two separate methods of identification. With multiple methods
        set, an attacker \nwould have to compromise both methods before they could
        maliciously reset a user's password."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.6
      :level: 1
    :code: "control '1.6' do\n  title \"Ensure That 'Number of methods required to
      reset' is set to '2'\"\n  impact 1.0\n  tag cis: 'azure:1.6'\n  tag level: 1\n
      \ desc <<-DESC\n    Ensures that two alternate forms of identification are \n
      \   provided before allowing a password reset.\n\n    Rationale: A Self-service
      Password Reset (SSPR) through Azure Multi-factor Authentication (MFA) ensures
      the user's \n    identity is confirmed using two separate methods of identification.
      With multiple methods set, an attacker \n    would have to compromise both methods
      before they could maliciously reset a user's password. \n\n  DESC\n\n  describe
      'no API support' do\n    skip 'No Azure API support. Alternative Audit Procedure:\n\n
      \   On the Azure Console:\n\n    1. Go to Azure Active Directory\n    2. Go
      to Users\n    3. Go to Password reset\n    4. Go to Authentication methods\n
      \   5. Ensure that Number of methods required to reset is set to 2'\n  end\nend\n"
    :source_location:
      :line: 348
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 3.167e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:

            On the Azure Console:

            1. Go to Azure Active Directory
            2. Go to Users
            3. Go to Password reset
            4. Go to Authentication methods
            5. Ensure that Number of methods required to reset is set to 2
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.7'
    :title: Ensure that a Custom Bad Password List is set to 'Enforce' for your Organization
    :desc: "Microsoft Azure creates a default bad password policy that is already
      applied to \nAzure administrative and normal user accounts. This is not applied
      to user accounts \nthat are synced from an on-premise Active Directory unless
      Azure AD Connect is used and \nyou enable EnforceCloudPasswordPolicyForPasswordSyncedUsers.
      Please see the list in default values on the specifics of this policy."
    :descriptions:
    - :label: default
      :data: "Microsoft Azure creates a default bad password policy that is already
        applied to \nAzure administrative and normal user accounts. This is not applied
        to user accounts \nthat are synced from an on-premise Active Directory unless
        Azure AD Connect is used and \nyou enable EnforceCloudPasswordPolicyForPasswordSyncedUsers.
        Please see the list in default values on the specifics of this policy."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.7
      :level: 1
    :code: "control '1.7' do\n  title \"Ensure that a Custom Bad Password List is
      set to 'Enforce' for your Organization\"\n  impact 1.0\n  tag cis: 'azure:1.7'\n
      \ tag level: 1\n  desc <<-DESC\n    Microsoft Azure creates a default bad password
      policy that is already applied to \n    Azure administrative and normal user
      accounts. This is not applied to user accounts \n    that are synced from an
      on-premise Active Directory unless Azure AD Connect is used and \n    you enable
      EnforceCloudPasswordPolicyForPasswordSyncedUsers. Please see the list in default
      values on the specifics of this policy.\n\n  DESC\n\n  describe 'no API support'
      do\n    skip 'No Azure API support. Alternative Audit Procedure:\n\n    On the
      Azure Console:\n\n    1. Select Azure Active directory in the menu that opens,
      and then Security.\n    2. Under Management select Authentication then Password
      Protection.\n    3. Ensure Enforce custom list is set to Yes.\n    4. Go to
      Authentication methods\n    5. Scroll through the list to view the enforced
      passwords.'\n  end\nend\n"
    :source_location:
      :line: 376
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 3.044e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:

            On the Azure Console:

            1. Select Azure Active directory in the menu that opens, and then Security.
            2. Under Management select Authentication then Password Protection.
            3. Ensure Enforce custom list is set to Yes.
            4. Go to Authentication methods
            5. Scroll through the list to view the enforced passwords.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.8'
    :title: Ensure that 'Number of days before users are asked to re-confirm their
      authentication information' is not set to '0'
    :desc: "Ensure that the number of days before users are asked to re-confirm \ntheir
      authentication information is not set to 0.\n\nRationale: This setting is necessary
      if you have setup 'Require users to register when signing in option'. \nIf authentication
      re-confirmation is disabled, registered users will never be prompted to re-confirm
      their \nexisting authentication information. If the authentication information
      for a user changes, such as a phone number \nor email, then the password reset
      information for that user reverts to the previously registered authentication
      information."
    :descriptions:
    - :label: default
      :data: "Ensure that the number of days before users are asked to re-confirm
        \ntheir authentication information is not set to 0.\n\nRationale: This setting
        is necessary if you have setup 'Require users to register when signing in
        option'. \nIf authentication re-confirmation is disabled, registered users
        will never be prompted to re-confirm their \nexisting authentication information.
        If the authentication information for a user changes, such as a phone number
        \nor email, then the password reset information for that user reverts to the
        previously registered authentication information."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.8
      :level: 1
    :code: "control '1.8' do\n  title \"Ensure that 'Number of days before users are
      asked to re-confirm their authentication information' is not set to '0'\"\n
      \ impact 1.0\n  tag cis: 'azure:1.8'\n  tag level: 1\n  desc <<-DESC\n    Ensure
      that the number of days before users are asked to re-confirm \n    their authentication
      information is not set to 0.\n\n    Rationale: This setting is necessary if
      you have setup 'Require users to register when signing in option'. \n    If
      authentication re-confirmation is disabled, registered users will never be prompted
      to re-confirm their \n    existing authentication information. If the authentication
      information for a user changes, such as a phone number \n    or email, then
      the password reset information for that user reverts to the previously registered
      authentication information.\n  DESC\n\n  describe 'no API support' do\n    skip
      'No Azure API support. Alternative Audit Procedure:\n\n    On the Azure Console:\n\n
      \   1. Go to Azure Active Directory\n    2. Go to Users\n    3. Go to Password
      reset\n    4. Go to Registration\n    5. Ensure that Number of days before users
      are asked to re-confirm their authentication information is not set to 0'\n
      \ end\nend\n"
    :source_location:
      :line: 402
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 2.771e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:

            On the Azure Console:

            1. Go to Azure Active Directory
            2. Go to Users
            3. Go to Password reset
            4. Go to Registration
            5. Ensure that Number of days before users are asked to re-confirm their authentication information is not set to 0
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.9'
    :title: Ensure that 'Notify users on password resets?' is set to 'Yes'
    :desc: "Ensure that users are notified on their primary and secondary \nemails
      on password resets.\n\nRationale: User notification on password reset is a passive
      way of confirming \npassword reset activity. It helps the user to recognize
      unauthorized password \nreset activities."
    :descriptions:
    - :label: default
      :data: "Ensure that users are notified on their primary and secondary \nemails
        on password resets.\n\nRationale: User notification on password reset is a
        passive way of confirming \npassword reset activity. It helps the user to
        recognize unauthorized password \nreset activities."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.9
      :level: 1
    :code: "control '1.9' do\n  title \"Ensure that 'Notify users on password resets?'
      is set to 'Yes'\"\n  impact 1.0\n  tag cis: 'azure:1.9'\n  tag level: 1\n  desc
      <<-DESC\n    Ensure that users are notified on their primary and secondary \n
      \   emails on password resets.\n\n    Rationale: User notification on password
      reset is a passive way of confirming \n    password reset activity. It helps
      the user to recognize unauthorized password \n    reset activities. \n\n  DESC\n\n
      \ describe 'no API support' do\n    skip 'No Azure API support. Alternative
      Audit Procedure:\n\n    On the Azure Console:\n\n    1. Go to Azure Active Directory\n
      \   2. Go to Users\n    3. Go to Password reset\n    4. Go to Notification\n
      \   5. Ensure that Notify users on password resets? is set to Yes'\n  end\nend\n"
    :source_location:
      :line: 430
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 3.09e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:

            On the Azure Console:

            1. Go to Azure Active Directory
            2. Go to Users
            3. Go to Password reset
            4. Go to Notification
            5. Ensure that Notify users on password resets? is set to Yes
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.10'
    :title: Ensure That 'Notify all admins when other admins reset their password?'
      is set to 'Yes'
    :desc: "Ensure that all administrators are notified if any other administrator
      resets their password.\n\nAdministrator accounts are sensitive. Any password
      reset activity notification, when sent to \nall administrators, ensures that
      all administrators can passively confirm if such a reset is \na common pattern
      within their group. For example, if all administrators change their password
      \nevery 30 days, any password reset activity before that may require administrator(s)
      to evaluate \nany unusual activity and confirm its origin."
    :descriptions:
    - :label: default
      :data: "Ensure that all administrators are notified if any other administrator
        resets their password.\n\nAdministrator accounts are sensitive. Any password
        reset activity notification, when sent to \nall administrators, ensures that
        all administrators can passively confirm if such a reset is \na common pattern
        within their group. For example, if all administrators change their password
        \nevery 30 days, any password reset activity before that may require administrator(s)
        to evaluate \nany unusual activity and confirm its origin."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.10
      :level: 1
    :code: "control '1.10' do\n  title \"Ensure That 'Notify all admins when other
      admins reset their password?' is set to 'Yes'\"\n  impact 1.0\n  tag cis: 'azure:1.10'\n
      \ tag level: 1\n  desc <<-DESC\n    Ensure that all administrators are notified
      if any other administrator resets their password.\n\n    Administrator accounts
      are sensitive. Any password reset activity notification, when sent to \n    all
      administrators, ensures that all administrators can passively confirm if such
      a reset is \n    a common pattern within their group. For example, if all administrators
      change their password \n    every 30 days, any password reset activity before
      that may require administrator(s) to evaluate \n    any unusual activity and
      confirm its origin.\n\n  DESC\n\n  describe 'no API support' do\n    skip 'No
      Azure API support. Alternative Audit Procedure:\n    On the Azure Console:\n\n
      \   1. Go to Azure Active Directory\n    2. Go to Users\n    3. Go to Password
      reset\n    4. Go to Notification\n    5. Ensure that Notify all admins when
      other admins reset their password? is set to Yes\n'\n  end\nend\n"
    :source_location:
      :line: 458
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 2.958e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |
        No Azure API support. Alternative Audit Procedure:
            On the Azure Console:

            1. Go to Azure Active Directory
            2. Go to Users
            3. Go to Password reset
            4. Go to Notification
            5. Ensure that Notify all admins when other admins reset their password? is set to Yes
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.13'
    :title: Ensure that 'Users can add gallery apps to My Apps' is set to 'No'
    :desc: |-
      Require administrators to provide consent for the apps before use.

      Rationale: Unless Azure Active Directory is running as an identity provider for third-party applications, do not allow users to use their identity outside of your cloud environment. User profiles contain private information such as phone numbers and email addresses which could then be sold off to other third parties without requiring any further consent from the user.
    :descriptions:
    - :label: default
      :data: |-
        Require administrators to provide consent for the apps before use.

        Rationale: Unless Azure Active Directory is running as an identity provider for third-party applications, do not allow users to use their identity outside of your cloud environment. User profiles contain private information such as phone numbers and email addresses which could then be sold off to other third parties without requiring any further consent from the user.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.13
      :level: 1
    :code: |
      control '1.13' do
        title "Ensure that 'Users can add gallery apps to My Apps' is set to 'No'"
        impact 1.0
        tag cis: 'azure:1.13'
        tag level: 1
        desc <<-DESC
          Require administrators to provide consent for the apps before use.

          Rationale: Unless Azure Active Directory is running as an identity provider for third-party applications, do not allow users to use their identity outside of your cloud environment. User profiles contain private information such as phone numbers and email addresses which could then be sold off to other third parties without requiring any further consent from the user.
        DESC

        describe 'no API support' do
          skip 'No Azure API support.
          From Azure Portal

          1. From Azure Home select the Portal Menu
          2. Select Azure Active Directory
          3. Then Users
          4. Select User settings
          5. Then Manage how end users launch and view their applications, and ensure that Users can add gallery apps to My Apps is set to No
          '
        end
      end
    :source_location:
      :line: 487
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 3.017e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: "No Azure API support.\n    From Azure Portal\n\n    1. From
        Azure Home select the Portal Menu\n    2. Select Azure Active Directory\n
        \   3. Then Users\n    4. Select User settings\n    5. Then Manage how end
        users launch and view their applications, and ensure that Users can add gallery
        apps to My Apps is set to No\n    "
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.17'
    :title: Ensure That 'Restrict access to Azure AD administration portal' is Set
      to 'Yes'
    :desc: |-
      Restrict access to the Azure AD administration portal to administrators only.
      NOTE: This only affects access to the Azure AD administrator's web portal. This setting does not prohibit privileged users from using other methods such as Rest API or Powershell to obtain sensitive information from Azure AD

      Rationale: The Azure AD administrative portal has sensitive data and permission settings. All non-administrators should be prohibited from accessing any Azure AD data in the administration portal to avoid exposure.
    :descriptions:
    - :label: default
      :data: |-
        Restrict access to the Azure AD administration portal to administrators only.
        NOTE: This only affects access to the Azure AD administrator's web portal. This setting does not prohibit privileged users from using other methods such as Rest API or Powershell to obtain sensitive information from Azure AD

        Rationale: The Azure AD administrative portal has sensitive data and permission settings. All non-administrators should be prohibited from accessing any Azure AD data in the administration portal to avoid exposure.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.17
      :level: 1
    :code: |
      control '1.17' do
        title "Ensure That 'Restrict access to Azure AD administration portal' is Set to 'Yes'"
        impact 1.0
        tag cis: 'azure:1.17'
        tag level: 1
        desc <<-DESC
          Restrict access to the Azure AD administration portal to administrators only.
          NOTE: This only affects access to the Azure AD administrator's web portal. This setting does not prohibit privileged users from using other methods such as Rest API or Powershell to obtain sensitive information from Azure AD

          Rationale: The Azure AD administrative portal has sensitive data and permission settings. All non-administrators should be prohibited from accessing any Azure AD data in the administration portal to avoid exposure.
        DESC

        describe 'no API support' do
          skip 'No Azure API support.
          From Azure Portal

          1. From Azure Home select the Portal Menu
          2. Select Azure Active Directory
          3. Then Users
          4. Select User settings
          5. Ensure that Restrict access to Azure AD administration portal is set to Yes
          '
        end
      end
    :source_location:
      :line: 511
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 2.962e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: "No Azure API support.\n    From Azure Portal\n\n    1. From
        Azure Home select the Portal Menu\n    2. Select Azure Active Directory\n
        \   3. Then Users\n    4. Select User settings\n    5. Ensure that Restrict
        access to Azure AD administration portal is set to Yes\n    "
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.22'
    :title: Ensure that 'Require Multi-Factor Authentication to register or join devices
      with Azure AD' is set to 'Yes'
    :desc: |-
      Restrict security group creation to administrators only.

      RATIONALE: When creating security groups is enabled, all users in the directory
      are allowed to create new security groups and add members to those groups.
      Unless a business requires this day-to-day delegation, security group creation
      should be restricted to administrators only.
    :descriptions:
    - :label: default
      :data: |-
        Restrict security group creation to administrators only.

        RATIONALE: When creating security groups is enabled, all users in the directory
        are allowed to create new security groups and add members to those groups.
        Unless a business requires this day-to-day delegation, security group creation
        should be restricted to administrators only.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.22
      :level: 1
    :code: |
      control '1.22' do
        title "Ensure that 'Require Multi-Factor Authentication to register or join devices with Azure AD' is set to 'Yes'"
        impact 1.0
        tag cis: 'azure:1.22'
        tag level: 1
        desc <<-DESC
          Restrict security group creation to administrators only.

          RATIONALE: When creating security groups is enabled, all users in the directory
          are allowed to create new security groups and add members to those groups.
          Unless a business requires this day-to-day delegation, security group creation
          should be restricted to administrators only.
        DESC

        describe 'no API support' do
          skip 'No Azure API support. Alternative Audit Procedure:
          From Azure Console:

          1. From Azure Home select the Portal Menu
          2. Select Azure Active Directory
          3. Then Devices
          4. Select Device settings
          5. Ensure that Require Multi-Factor Authentication to register or join devices with Azure AD is set to Yes'
        end
      end
    :source_location:
      :line: 536
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 2.92e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:
            From Azure Console:

            1. From Azure Home select the Portal Menu
            2. Select Azure Active Directory
            3. Then Devices
            4. Select Device settings
            5. Ensure that Require Multi-Factor Authentication to register or join devices with Azure AD is set to Yes
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '1.23'
    :title: Ensure That No Custom Subscription Owner Roles Are Created
    :desc: |-
      Subscription ownership should not include permission to create custom owner roles.
      The principle of least privilege should be followed and only necessary privileges
      should be assigned instead of allowing full administrative access.

      RATIONALE: Classic subscription admin roles offer basic access management and include
      Account Administrator, Service Administrator, and Co-Administrators. It is recommended
      the least necessary permissions be given initially. Permissions can be added as
      needed by the account holder. This ensures the account holder cannot perform
      actions which were not intended.
    :descriptions:
    - :label: default
      :data: |-
        Subscription ownership should not include permission to create custom owner roles.
        The principle of least privilege should be followed and only necessary privileges
        should be assigned instead of allowing full administrative access.

        RATIONALE: Classic subscription admin roles offer basic access management and include
        Account Administrator, Service Administrator, and Co-Administrators. It is recommended
        the least necessary permissions be given initially. Permissions can be added as
        needed by the account holder. This ensures the account holder cannot perform
        actions which were not intended.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:1.23
      :level: 1
    :code: |
      control '1.23' do
        title "Ensure That No Custom Subscription Owner Roles Are Created"
        impact 1.0
        tag cis: 'azure:1.23'
        tag level: 1
        desc <<-DESC
          Subscription ownership should not include permission to create custom owner roles.
          The principle of least privilege should be followed and only necessary privileges
          should be assigned instead of allowing full administrative access.

          RATIONALE: Classic subscription admin roles offer basic access management and include
          Account Administrator, Service Administrator, and Co-Administrators. It is recommended
          the least necessary permissions be given initially. Permissions can be added as
          needed by the account holder. This ensures the account holder cannot perform
          actions which were not intended.
        DESC

        custom_owners = azure_role_definitions.entries
                                              .select { |r| r.properties.type == 'CustomRole' &&
                                                r.properties.assignableScopes.include?('/') &&
                                                r.properties.permissions.any? { |perm| perm.actions.include?('*') }}
                                              .map(&:name)
        if custom_owners.empty?
          describe custom_owners do
            it { should be_empty }
          end
        else
          custom_owners.each do |role|
            describe azure_role_definition(name: role) do
              it { should_not exist }
            end
          end
        end
      end
    :source_location:
      :line: 562
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: "[] is expected to be empty"
      :run_time: 0.009567787
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: ''
  - :id: 2.2.1
    :title: Ensure that Auto provisioning of 'Log Analytics agent for Azure VMs' is
      Set to 'On'
    :desc: |-
      Enable automatic provisioning of the monitoring agent to collect security data.

      Rationale: When Log Analytics agent for Azure VMs is turned on, Microsoft Defender for Cloud provisions the Microsoft Monitoring Agent on all existing supported Azure virtual machines and any new ones that are created. The Microsoft Monitoring Agent scans for various security-related configurations and events such as system updates, OS vulnerabilities, endpoint protection, and provides alerts.
    :descriptions:
    - :label: default
      :data: |-
        Enable automatic provisioning of the monitoring agent to collect security data.

        Rationale: When Log Analytics agent for Azure VMs is turned on, Microsoft Defender for Cloud provisions the Microsoft Monitoring Agent on all existing supported Azure virtual machines and any new ones that are created. The Microsoft Monitoring Agent scans for various security-related configurations and events such as system updates, OS vulnerabilities, endpoint protection, and provides alerts.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:2.2.1
      :level: 1
    :code: |
      control '2.2.1' do
        title "Ensure that Auto provisioning of 'Log Analytics agent for Azure VMs' is Set to 'On'"
        impact 1.0
        tag cis: 'azure:2.2.1'
        tag level: 1
        desc <<-DESC
          Enable automatic provisioning of the monitoring agent to collect security data.

          Rationale: When Log Analytics agent for Azure VMs is turned on, Microsoft Defender for Cloud provisions the Microsoft Monitoring Agent on all existing supported Azure virtual machines and any new ones that are created. The Microsoft Monitoring Agent scans for various security-related configurations and events such as system updates, OS vulnerabilities, endpoint protection, and provides alerts.
        DESC

        describe azure_security_center_policy do
          it { should have_auto_provisioning_enabled }
        end
      end
    :source_location:
      :line: 597
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Security Center Policy - api_version: 2015-06-01-preview
        latest: Microsoft.Security/policies default /subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/policies/
        is expected to have auto provisioning enabled'
      :run_time: 0.14525686
      :start_time: '2024-03-26T19:38:52+00:00'
      :message: 'expected `Azure Security Center Policy - api_version: 2015-06-01-preview
        latest: Microsoft.Security/policies default /subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/policies/.has_auto_provisioning_enabled?`
        to be truthy, got false'
      :resource_class: azure_security_center_policy
      :resource_params: "[]"
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/policies/default"
  - :id: 2.3.1
    :title: Ensure That 'All users with the following roles' is set to 'Owner'
    :desc: "Enable security alert emails to subscription owners.  \n\nRationale: Enabling
      security alert emails to subscription owners ensures that they receive security
      alert emails from Microsoft. This ensures that they are aware of any potential
      security issues and can mitigate the risk in a timely fashion."
    :descriptions:
    - :label: default
      :data: "Enable security alert emails to subscription owners.  \n\nRationale:
        Enabling security alert emails to subscription owners ensures that they receive
        security alert emails from Microsoft. This ensures that they are aware of
        any potential security issues and can mitigate the risk in a timely fashion."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:2.3.1
      :level: 1
    :code: "control '2.3.1' do\n  title \"Ensure That 'All users with the following
      roles' is set to 'Owner'\"\n  impact 1.0\n  tag cis: 'azure:2.3.1'\n  tag level:
      1\n  desc <<-DESC\n    Enable security alert emails to subscription owners.
      \ \n\n    Rationale: Enabling security alert emails to subscription owners ensures
      that they receive security alert emails from Microsoft. This ensures that they
      are aware of any potential security issues and can mitigate the risk in a timely
      fashion.\n  DESC\n\n  describe azure_microsoft_defender_securitycontact do\n
      \   its('properties.notificationsByRole.roles') { should eq [\"Owner\"] }\n
      \ end\nend\n"
    :source_location:
      :line: 613
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Microsoft Defender Security Contact : Microsoft.Security/securityContacts
        default /subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/securityContacts '
      :run_time: 9.4096e-05
      :start_time: '2024-03-26T19:38:52+00:00'
      :message: |-
        Unable to get information from the REST API for azure_microsoft_defender_security_contact: Microsoft.Security/securityContacts default /subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/securityContacts.
        Unsuccessful HTTP request to Azure REST API.
        HTTP 404.
        {:error=>{:code=>"404", :message=>"Could not find security contact with name default for subscriptionId: b02e675a-cee0-49bd-a056-daa7ed05bf4e"}} {:error=>{:code=>"404", :message=>"Could not find security contact with name default for subscriptionId: b02e675a-cee0-49bd-a056-daa7ed05bf4e"}}
      :exception: Inspec::Exceptions::ResourceFailed
      :backtrace:
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:366:in
        `block (2 levels) in rspec_failed_block'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:263:in
        `instance_exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:263:in
        `block in run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:511:in
        `block in with_around_and_singleton_context_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:468:in
        `block in with_around_example_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:486:in
        `block in run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:624:in
        `run_around_example_hooks_for'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:486:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:468:in
        `with_around_example_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:511:in
        `with_around_and_singleton_context_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:259:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:646:in
        `block in run_examples'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:642:in
        `map'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:642:in
        `run_examples'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:607:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `block (3 levels) in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `map'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `block (2 levels) in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/configuration.rb:2070:in
        `with_suite_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:116:in
        `block in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/reporter.rb:74:in
        `report'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:115:in
        `run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner_rspec.rb:97:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:222:in
        `run_tests'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:178:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:410:in
        `block in exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature/runner.rb:21:in
        `with_feature'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature.rb:6:in
        `with_feature'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:395:in
        `exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/command.rb:27:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in
        `invoke_command'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor.rb:392:in
        `dispatch'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/base.rb:485:in
        `start'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/base_cli.rb:40:in
        `start'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-bin-6.6.0/bin/inspec:11:in
        `<top (required)>'"
      - "/usr/bin/inspec:280:in `load'"
      - "/usr/bin/inspec:280:in `<main>'"
      :resource_class: azure_microsoft_defender_security_contact
      :resource_params: '[{:name=>"default", :resource_provider=>"Microsoft.Security/securityContacts",
        :allowed_parameters=>[:built_in], :resource_uri=>"/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/securityContacts",
        :add_subscription_id=>true}]'
  - :id: 2.3.2
    :title: Ensure 'Additional email addresses' is Configured with a Security Contact
      Email
    :desc: "Microsoft Defender for Cloud emails the subscription owners whenever a
      high-severity alert is triggered for their subscription. You should provide
      a security contact email address as an additional email address. \n\nRationale:
      Microsoft Defender for Cloud emails the Subscription Owner to notify them about
      security alerts. Adding your Security Contact's email address to the 'Additional
      email addresses' field ensures that your organization's Security Team is included
      in these alerts. This ensures that the proper people are aware of any potential
      compromise in order to mitigate the risk in a timely fashion."
    :descriptions:
    - :label: default
      :data: "Microsoft Defender for Cloud emails the subscription owners whenever
        a high-severity alert is triggered for their subscription. You should provide
        a security contact email address as an additional email address. \n\nRationale:
        Microsoft Defender for Cloud emails the Subscription Owner to notify them
        about security alerts. Adding your Security Contact's email address to the
        'Additional email addresses' field ensures that your organization's Security
        Team is included in these alerts. This ensures that the proper people are
        aware of any potential compromise in order to mitigate the risk in a timely
        fashion."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:2.3.2
      :level: 1
    :code: "control '2.3.2' do\n  title \"Ensure 'Additional email addresses' is Configured
      with a Security Contact Email\"\n  impact 1.0\n  tag cis: 'azure:2.3.2'\n  tag
      level: 1\n  desc <<-DESC\n    Microsoft Defender for Cloud emails the subscription
      owners whenever a high-severity alert is triggered for their subscription. You
      should provide a security contact email address as an additional email address.
      \n\n    Rationale: Microsoft Defender for Cloud emails the Subscription Owner
      to notify them about security alerts. Adding your Security Contact's email address
      to the 'Additional email addresses' field ensures that your organization's Security
      Team is included in these alerts. This ensures that the proper people are aware
      of any potential compromise in order to mitigate the risk in a timely fashion.\n
      \ DESC\n\n  additional_emails_expected = input('additional_email_addresses')\n\n
      \ additional_emails = azure_microsoft_defender_securitycontact.properties.emails\n
      \ additional_emails_current = additional_emails.split(';')\n\n  only_if('For
      this audit to take place, please give the input for additional_email_addresses')
      { !(additional_emails_expected.empty?) }\n    if(additional_emails_current.empty?)\n
      \     describe azure_microsoft_defender_securitycontact do\n        its('properties.emails')
      { should_not be_empty }\n      end\n    else\n      counter = 0\n      additional_emails_current.each
      do |email|\n        if(!additional_emails_expected.include? email)\n          counter+=1\n
      \         break\n        end\n      end\n  \n      describe \"Azure Microsoft
      Defender for Cloud\" do\n        it \"Additional email addresses should only
      include #{additional_emails_expected}\" do\n          expect(counter).to(cmp
      == 0)\n        end\n      end\n    end\nend\n"
    :source_location:
      :line: 629
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: No-op
      :run_time: 6.187e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: No-op
      :skip_message: 'Skipped control due to only_if condition: For this audit to
        take place, please give the input for additional_email_addresses'
      :resource_class: noop
      :resource_params: "[]"
      :resource_id: No-op
  - :id: 2.3.3
    :title: Ensure That 'Notify about alerts with the following severity' is Set to
      'High'
    :desc: |-
      Enables emailing security alerts to the subscription owner or other designated security contact.

      Rationale: Enabling security alert emails ensures that security alert emails are received from Microsoft. This ensures that the right people are aware of any potential security issues and are able to mitigate the risk.
    :descriptions:
    - :label: default
      :data: |-
        Enables emailing security alerts to the subscription owner or other designated security contact.

        Rationale: Enabling security alert emails ensures that security alert emails are received from Microsoft. This ensures that the right people are aware of any potential security issues and are able to mitigate the risk.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:2.3.3
      :level: 1
    :code: |
      control '2.3.3' do
        title "Ensure That 'Notify about alerts with the following severity' is Set to 'High'"
        impact 1.0
        tag cis: 'azure:2.3.3'
        tag level: 1
        desc <<-DESC
          Enables emailing security alerts to the subscription owner or other designated security contact.

          Rationale: Enabling security alert emails ensures that security alert emails are received from Microsoft. This ensures that the right people are aware of any potential security issues and are able to mitigate the risk.
        DESC

        describe azure_microsoft_defender_securitycontact do
          its('properties.alertNotifications.state') { should cmp "On" }
          its('properties.alertNotifications.minimalSeverity') { should cmp "High" }
        end
      end
    :source_location:
      :line: 667
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Microsoft Defender Security Contact : Microsoft.Security/securityContacts
        default /subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/securityContacts '
      :run_time: 5.9086e-05
      :start_time: '2024-03-26T19:38:52+00:00'
      :message: |-
        Unable to get information from the REST API for azure_microsoft_defender_security_contact: Microsoft.Security/securityContacts default /subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/securityContacts.
        Unsuccessful HTTP request to Azure REST API.
        HTTP 404.
        {:error=>{:code=>"404", :message=>"Could not find security contact with name default for subscriptionId: b02e675a-cee0-49bd-a056-daa7ed05bf4e"}} {:error=>{:code=>"404", :message=>"Could not find security contact with name default for subscriptionId: b02e675a-cee0-49bd-a056-daa7ed05bf4e"}}
      :exception: Inspec::Exceptions::ResourceFailed
      :backtrace:
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:366:in
        `block (2 levels) in rspec_failed_block'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:263:in
        `instance_exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:263:in
        `block in run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:511:in
        `block in with_around_and_singleton_context_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:468:in
        `block in with_around_example_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:486:in
        `block in run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:624:in
        `run_around_example_hooks_for'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:486:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:468:in
        `with_around_example_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:511:in
        `with_around_and_singleton_context_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:259:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:646:in
        `block in run_examples'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:642:in
        `map'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:642:in
        `run_examples'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:607:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `block (3 levels) in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `map'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `block (2 levels) in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/configuration.rb:2070:in
        `with_suite_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:116:in
        `block in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/reporter.rb:74:in
        `report'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:115:in
        `run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner_rspec.rb:97:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:222:in
        `run_tests'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:178:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:410:in
        `block in exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature/runner.rb:21:in
        `with_feature'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature.rb:6:in
        `with_feature'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:395:in
        `exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/command.rb:27:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in
        `invoke_command'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor.rb:392:in
        `dispatch'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/base.rb:485:in
        `start'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/base_cli.rb:40:in
        `start'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-bin-6.6.0/bin/inspec:11:in
        `<top (required)>'"
      - "/usr/bin/inspec:280:in `load'"
      - "/usr/bin/inspec:280:in `<main>'"
      :resource_class: azure_microsoft_defender_security_contact
      :resource_params: '[{:name=>"default", :resource_provider=>"Microsoft.Security/securityContacts",
        :allowed_parameters=>[:built_in], :resource_uri=>"/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/providers/Microsoft.Security/securityContacts",
        :add_subscription_id=>true}]'
  - :id: '2.5'
    :title: Ensure that Microsoft Defender Recommendation for 'Apply system updates'
      status is 'Completed'
    :desc: |-
      Ensure that the latest OS patches for all virtual machines are applied.

      Rationale: Windows and Linux virtual machines should be kept updated to:
                  Address a specific bug or flaw
                  Improve an OS or applications general stability
                  Fix a security vulnerability
                 The Azure Security Center retrieves a list of available security and critical updates from Windows Update or Windows Server Update Services (WSUS), depending on which service is configured on a Windows VM. The security center also checks for the latest updates in Linux systems. If a VM is missing a system update, the security center will recommend system updates be applied.
    :descriptions:
    - :label: default
      :data: |-
        Ensure that the latest OS patches for all virtual machines are applied.

        Rationale: Windows and Linux virtual machines should be kept updated to:
                    Address a specific bug or flaw
                    Improve an OS or applications general stability
                    Fix a security vulnerability
                   The Azure Security Center retrieves a list of available security and critical updates from Windows Update or Windows Server Update Services (WSUS), depending on which service is configured on a Windows VM. The security center also checks for the latest updates in Linux systems. If a VM is missing a system update, the security center will recommend system updates be applied.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:2.5
      :level: 1
    :code: |
      control '2.5' do
        title "Ensure that Microsoft Defender Recommendation for 'Apply system updates' status is 'Completed'"
        impact 1.0
        tag cis: 'azure:2.5'
        tag level: 1
        desc <<-DESC
          Ensure that the latest OS patches for all virtual machines are applied.

          Rationale: Windows and Linux virtual machines should be kept updated to:
                      Address a specific bug or flaw
                      Improve an OS or applications general stability
                      Fix a security vulnerability
                     The Azure Security Center retrieves a list of available security and critical updates from Windows Update or Windows Server Update Services (WSUS), depending on which service is configured on a Windows VM. The security center also checks for the latest updates in Linux systems. If a VM is missing a system update, the security center will recommend system updates be applied.
        DESC

        describe 'no API support' do
          skip 'No Azure API support.
          From Azure Portal

          1. From Azure Home select the Portal Menu
          2. Select Microsoft Defender for Cloud
          3. Then the Recommendations blade
          4. Ensure that there are no recommendations for Apply system updates

          Alternatively, you can employ your own patch assessment and management tool to periodically assess, report and install the required security patches for your OS.
          '
        end
      end
    :source_location:
      :line: 684
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 4.259e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: "No Azure API support.\n    From Azure Portal\n\n    1. From
        Azure Home select the Portal Menu\n    2. Select Microsoft Defender for Cloud\n
        \   3. Then the Recommendations blade\n    4. Ensure that there are no recommendations
        for Apply system updates\n\n    Alternatively, you can employ your own patch
        assessment and management tool to periodically assess, report and install
        the required security patches for your OS.\n    "
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '2.6'
    :title: Ensure Any of the ASC Default Policy Settings are Not Set to 'Disabled'
    :desc: |-
      None of the settings offered by ASC Default policy should be set to effect Disabled.

      Rationale: A security policy defines the desired configuration of your workloads and helps ensure compliance with company or regulatory security requirements. ASC Default policy is associated with every subscription by default. ASC default policy assignment is a set of security recommendations based on best practices. Enabling recommendations in ASC default policy ensures that Azure security center provides the ability to monitor all of the supported recommendations and optionally allow automated action for a few of the supported recommendations.
    :descriptions:
    - :label: default
      :data: |-
        None of the settings offered by ASC Default policy should be set to effect Disabled.

        Rationale: A security policy defines the desired configuration of your workloads and helps ensure compliance with company or regulatory security requirements. ASC Default policy is associated with every subscription by default. ASC default policy assignment is a set of security recommendations based on best practices. Enabling recommendations in ASC default policy ensures that Azure security center provides the ability to monitor all of the supported recommendations and optionally allow automated action for a few of the supported recommendations.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:2.6
      :level: 1
    :code: |
      control '2.6' do
        title "Ensure Any of the ASC Default Policy Settings are Not Set to 'Disabled'"
        impact 1.0
        tag cis: 'azure:2.6'
        tag level: 1
        desc <<-DESC
          None of the settings offered by ASC Default policy should be set to effect Disabled.

          Rationale: A security policy defines the desired configuration of your workloads and helps ensure compliance with company or regulatory security requirements. ASC Default policy is associated with every subscription by default. ASC default policy assignment is a set of security recommendations based on best practices. Enabling recommendations in ASC default policy ensures that Azure security center provides the ability to monitor all of the supported recommendations and optionally allow automated action for a few of the supported recommendations.
        DESC

        describe 'no API support' do
          skip('No Azure API support.
              From Azure Portal
              1. From Azure Home select the Portal Menu
              2. Select Microsoft Defender for Cloud
              3. Then Environment Settings
              4. Select subscription
              5. Then on Security Policy in the left column.
              6. Followed by on ASC Default under Default initiative
              7. Scroll down to Policy Enforcement and ensure it is set to Enabled
              8. Click on the Parameters tab and uncheck Only show parameters that need input or review
              9. Review the Parameters to ensure none of the items are set to Disabled.
              The View effective Policy button can be used to see all effects of policies even if they have not been modified.')
        end
      end
    :source_location:
      :line: 713
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 4.655e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support.
                From Azure Portal
                1. From Azure Home select the Portal Menu
                2. Select Microsoft Defender for Cloud
                3. Then Environment Settings
                4. Select subscription
                5. Then on Security Policy in the left column.
                6. Followed by on ASC Default under Default initiative
                7. Scroll down to Policy Enforcement and ensure it is set to Enabled
                8. Click on the Parameters tab and uncheck Only show parameters that need input or review
                9. Review the Parameters to ensure none of the items are set to Disabled.
                The View effective Policy button can be used to see all effects of policies even if they have not been modified.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '3.1'
    :title: Ensure that 'Secure transfer required' is set to 'Enabled'
    :desc: |-
      Enable data encryption in transit.

      The secure transfer option enhances the security of your storage account
      by only allowing requests to the storage account by a secure connection.
    :descriptions:
    - :label: default
      :data: |-
        Enable data encryption in transit.

        The secure transfer option enhances the security of your storage account
        by only allowing requests to the storage account by a secure connection.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.1
      :level: 1
    :code: |
      control '3.1' do
        title "Ensure that 'Secure transfer required' is set to 'Enabled'"
        impact 1.0
        tag cis: 'azure:3.1'
        tag level: 1
        desc <<-DESC
          Enable data encryption in transit.

          The secure transfer option enhances the security of your storage account
          by only allowing requests to the storage account by a secure connection.
        DESC

        storage_accounts.each do |resource_group, azure_storage_account_names|
          azure_storage_account_names.each do | asa_hash |
            asa_hash.keys.each do | storage_account_name |
              a_storage_account = asa_hash[storage_account_name]
              describe a_storage_account do
                its('properties') { should have_attributes(supportsHttpsTrafficOnly: true) }
              end
            end
          end
        end
      end
    :source_location:
      :line: 740
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts butlersa properties is expected to have
        attributes {:supportsHttpsTrafficOnly => true}'
      :run_time: 0.003357302
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"butler-sa", :name=>"butlersa", :resource_provider=>"Microsoft.Storage/storageAccounts",
        :allowed_parameters=>[:activity_log_alert_api_version, :storage_service_endpoint_api_version,
        :diagnostic_settings_api_version], :storage_service_endpoint_api_version=>"2019-12-12",
        :activity_log_alert_api_version=>"latest", :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa"
    - :status: passed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts custodiand9730719 properties is expected
        to have attributes {:supportsHttpsTrafficOnly => true}'
      :run_time: 0.000213961
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719"
    - :status: passed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts cs21003200188a89c60 properties is expected
        to have attributes {:supportsHttpsTrafficOnly => true}'
      :run_time: 0.00028408
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60"
    - :status: passed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts habwinws properties is expected to have
        attributes {:supportsHttpsTrafficOnly => true}'
      :run_time: 0.000147562
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws"
  - :id: '3.3'
    :title: Ensure that 'Enable key rotation reminders' is enabled for each Storage
      Account
    :desc: "Access Keys authenticate application access requests to data contained
      in Storage Accounts. \nA periodic rotation of these keys is recommended to ensure
      that potentially compromised keys cannot result in a long-term exploitable credential.
      \nThe \"Rotation Reminder\" is an automatic reminder feature for a manual procedure."
    :descriptions:
    - :label: default
      :data: "Access Keys authenticate application access requests to data contained
        in Storage Accounts. \nA periodic rotation of these keys is recommended to
        ensure that potentially compromised keys cannot result in a long-term exploitable
        credential. \nThe \"Rotation Reminder\" is an automatic reminder feature for
        a manual procedure."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.3
      :level: 1
    :code: "control '3.3' do\n  title \"Ensure that 'Enable key rotation reminders'
      is enabled for each Storage Account\"\n  impact 1.0\n  tag cis: 'azure:3.3'\n
      \ tag level: 1\n  desc <<-DESC\n    Access Keys authenticate application access
      requests to data contained in Storage Accounts. \n    A periodic rotation of
      these keys is recommended to ensure that potentially compromised keys cannot
      result in a long-term exploitable credential. \n    The \"Rotation Reminder\"
      is an automatic reminder feature for a manual procedure.\n  DESC\n\n  describe
      'no API support' do\n    skip 'No Azure API support.\n    From Azure Portal\n\n
      \   1. Go to Storage Accounts\n    2. For each Storage Account, go to Access
      keys\n    3. Click Set rotation reminder\n    If the checkbox for Enable key
      rotation reminders is already checked, that Storage Account is compliant. Review
      the Remind me every field for a desirable periodic setting that fits your security
      programs needs.'\n  end\nend\n"
    :source_location:
      :line: 764
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 6.886e-06
      :start_time: '2024-03-26T19:38:52+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support.
            From Azure Portal

            1. Go to Storage Accounts
            2. For each Storage Account, go to Access keys
            3. Click Set rotation reminder
            If the checkbox for Enable key rotation reminders is already checked, that Storage Account is compliant. Review the Remind me every field for a desirable periodic setting that fits your security programs needs.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '3.4'
    :title: Ensure that Storage Account Access Keys are Periodically Regenerated
    :desc: |-
      For increased security, regenerate storage account access keys periodically.

      When you create a storage account, Azure generates two 512-bit storage access keys,
      which are used for authentication when the storage account is accessed. Rotating
      these keys periodically ensures that any inadvertent access or exposure does not
      result in these keys being compromised.
    :descriptions:
    - :label: default
      :data: |-
        For increased security, regenerate storage account access keys periodically.

        When you create a storage account, Azure generates two 512-bit storage access keys,
        which are used for authentication when the storage account is accessed. Rotating
        these keys periodically ensures that any inadvertent access or exposure does not
        result in these keys being compromised.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.4
      :level: 1
    :code: |
      control '3.4' do
        title 'Ensure that Storage Account Access Keys are Periodically Regenerated'
        impact 1.0
        tag cis: 'azure:3.4'
        tag level: 1
        desc <<-DESC
          For increased security, regenerate storage account access keys periodically.

          When you create a storage account, Azure generates two 512-bit storage access keys,
          which are used for authentication when the storage account is accessed. Rotating
          these keys periodically ensures that any inadvertent access or exposure does not
          result in these keys being compromised.
        DESC

        storage_accounts.each do |resource_group, azure_storage_account_names|
          azure_storage_account_names.each do | asa_hash |
            asa_hash.keys.each do | storage_account_name |
              a_storage_account = asa_hash[storage_account_name]
              describe a_storage_account do
                it { should have_recently_generated_access_key }
              end
            end
          end
        end
      end
    :source_location:
      :line: 786
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts butlersa is expected to have recently generated
        access key'
      :run_time: 1.767286217
      :start_time: '2024-03-26T19:38:52+00:00'
      :message: 'expected `Azure Storage Account - api_version: 2023-05-01 latest:
        butler-sa Microsoft.Storage/storageAccounts butlersa.has_recently_generated_access_key?`
        to be truthy, got false'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"butler-sa", :name=>"butlersa", :resource_provider=>"Microsoft.Storage/storageAccounts",
        :allowed_parameters=>[:activity_log_alert_api_version, :storage_service_endpoint_api_version,
        :diagnostic_settings_api_version], :storage_service_endpoint_api_version=>"2019-12-12",
        :activity_log_alert_api_version=>"latest", :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts custodiand9730719 is expected to have recently
        generated access key'
      :run_time: 1.005178182
      :start_time: '2024-03-26T19:38:54+00:00'
      :message: 'expected `Azure Storage Account - api_version: 2023-05-01 latest:
        cloud-custodian Microsoft.Storage/storageAccounts custodiand9730719.has_recently_generated_access_key?`
        to be truthy, got false'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts cs21003200188a89c60 is expected to have
        recently generated access key'
      :run_time: 2.06396041
      :start_time: '2024-03-26T19:38:55+00:00'
      :message: 'expected `Azure Storage Account - api_version: 2023-05-01 latest:
        cloud-shell-storage-eastus Microsoft.Storage/storageAccounts cs21003200188a89c60.has_recently_generated_access_key?`
        to be truthy, got false'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts habwinws is expected to have recently generated
        access key'
      :run_time: 3.092205351
      :start_time: '2024-03-26T19:38:57+00:00'
      :message: 'expected `Azure Storage Account - api_version: 2023-05-01 latest:
        habitat_windows_workstations Microsoft.Storage/storageAccounts habwinws.has_recently_generated_access_key?`
        to be truthy, got false'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws"
  - :id: '3.6'
    :title: Ensure that shared access signature tokens expire within an hour
    :desc: |-
      Expire shared access signature tokens within an hour.

      A shared access signature (SAS) is a URI that grants restricted access rights to
      Azure Storage resources. A shared access signature can be provided to clients who should
      not be trusted with the storage account key but for whom it may be necessary to delegate
      access to certain storage account resources. Providing a shared access signature URI to
      these clients allows them access to a resource for a specified period of time.
      This time should be set as low as possible and preferably no longer than an hour.
    :descriptions:
    - :label: default
      :data: |-
        Expire shared access signature tokens within an hour.

        A shared access signature (SAS) is a URI that grants restricted access rights to
        Azure Storage resources. A shared access signature can be provided to clients who should
        not be trusted with the storage account key but for whom it may be necessary to delegate
        access to certain storage account resources. Providing a shared access signature URI to
        these clients allows them access to a resource for a specified period of time.
        This time should be set as low as possible and preferably no longer than an hour.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.6
      :level: 1
    :code: |
      control '3.6' do
        title 'Ensure that shared access signature tokens expire within an hour'
        impact 1.0
        tag cis: 'azure:3.6'
        tag level: 1
        desc <<-DESC
          Expire shared access signature tokens within an hour.

          A shared access signature (SAS) is a URI that grants restricted access rights to
          Azure Storage resources. A shared access signature can be provided to clients who should
          not be trusted with the storage account key but for whom it may be necessary to delegate
          access to certain storage account resources. Providing a shared access signature URI to
          these clients allows them access to a resource for a specified period of time.
          This time should be set as low as possible and preferably no longer than an hour.
        DESC

        describe 'no API support' do
          skip 'No Azure API support.

          Currently, SAS token expiration times cannot be audited.
          Until Microsoft makes token expiration time a setting rather than a token creation parameter,
          this recommendation would require a manual verification.

          When generating shared access signature tokens, use start and end time such that it falls within an hour.'
        end
      end
    :source_location:
      :line: 812
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 7.644e-06
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support.

            Currently, SAS token expiration times cannot be audited.
            Until Microsoft makes token expiration time a setting rather than a token creation parameter,
            this recommendation would require a manual verification.

            When generating shared access signature tokens, use start and end time such that it falls within an hour.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: '3.7'
    :title: Ensure that 'Public access level' is disabled for storage accounts with
      blob containers
    :desc: Disallowing public access for a storage account overrides the public access
      settings for individual containers in that storage account.
    :descriptions:
    - :label: default
      :data: Disallowing public access for a storage account overrides the public
        access settings for individual containers in that storage account.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.7
      :level: 1
    :code: "control '3.7' do\n  title \"Ensure that 'Public access level' is disabled
      for storage accounts with blob containers\"\n  impact 1.0\n  tag cis: 'azure:3.7'\n
      \ tag level: 1\n  desc <<-DESC\n    Disallowing public access for a storage
      account overrides the public access settings for individual containers in that
      storage account.\n  DESC\n  \n  storage_accounts.each do |resource_group, azure_storage_account_names|\n
      \   azure_storage_account_names.each do | asa_hash |\n      asa_hash.keys.each
      do | storage_account_name |\n        a_storage_account = asa_hash[storage_account_name]\n
      \       describe a_storage_account do\n          its('properties.allowBlobPublicAccess')
      { should eq false }\n        end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 839
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts butlersa properties.allowBlobPublicAccess
        is expected to eq false'
      :run_time: 0.002038218
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: false
             got: true

        (compared using ==)

        Diff:
        @@ -1 +1 @@
        -false
        +true
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"butler-sa", :name=>"butlersa", :resource_provider=>"Microsoft.Storage/storageAccounts",
        :allowed_parameters=>[:activity_log_alert_api_version, :storage_service_endpoint_api_version,
        :diagnostic_settings_api_version], :storage_service_endpoint_api_version=>"2019-12-12",
        :activity_log_alert_api_version=>"latest", :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts custodiand9730719 properties.allowBlobPublicAccess
        is expected to eq false'
      :run_time: 0.00032592
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: false
             got: true

        (compared using ==)

        Diff:
        @@ -1 +1 @@
        -false
        +true
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719"
    - :status: passed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts cs21003200188a89c60 properties.allowBlobPublicAccess
        is expected to eq false'
      :run_time: 0.000148105
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts habwinws properties.allowBlobPublicAccess
        is expected to eq false'
      :run_time: 0.000284175
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: false
             got: true

        (compared using ==)

        Diff:
        @@ -1 +1 @@
        -false
        +true
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws"
  - :id: '3.8'
    :title: " Ensure Default Network Access Rule for Storage Accounts is Set to Deny"
    :desc: Restricting default network access helps to provide a new layer of security,
      since storage accounts accept connections from clients on any network. To limit
      access to selected networks, the default action must be changed.
    :descriptions:
    - :label: default
      :data: Restricting default network access helps to provide a new layer of security,
        since storage accounts accept connections from clients on any network. To
        limit access to selected networks, the default action must be changed.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.8
      :level: 1
    :code: |
      control '3.8' do
        title " Ensure Default Network Access Rule for Storage Accounts is Set to Deny"
        impact 1.0
        tag cis: 'azure:3.8'
        tag level: 1
        desc <<-DESC
          Restricting default network access helps to provide a new layer of security, since storage accounts accept connections from clients on any network. To limit access to selected networks, the default action must be changed.
        DESC

        storage_accounts.each do |resource_group, azure_storage_account_names|
          azure_storage_account_names.each do | asa_hash |
            asa_hash.keys.each do | storage_account_name |
              a_storage_account = asa_hash[storage_account_name]
              describe a_storage_account do
                its('properties.networkAcls.defaultAction') { should eq "Deny" }
              end
            end
          end
        end
      end
    :source_location:
      :line: 860
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts butlersa properties.networkAcls.defaultAction
        is expected to eq "Deny"'
      :run_time: 0.000152225
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: "Deny"
             got: "Allow"

        (compared using ==)
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"butler-sa", :name=>"butlersa", :resource_provider=>"Microsoft.Storage/storageAccounts",
        :allowed_parameters=>[:activity_log_alert_api_version, :storage_service_endpoint_api_version,
        :diagnostic_settings_api_version], :storage_service_endpoint_api_version=>"2019-12-12",
        :activity_log_alert_api_version=>"latest", :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts custodiand9730719 properties.networkAcls.defaultAction
        is expected to eq "Deny"'
      :run_time: 0.000126594
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: "Deny"
             got: "Allow"

        (compared using ==)
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts cs21003200188a89c60 properties.networkAcls.defaultAction
        is expected to eq "Deny"'
      :run_time: 0.000119846
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: "Deny"
             got: "Allow"

        (compared using ==)
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts habwinws properties.networkAcls.defaultAction
        is expected to eq "Deny"'
      :run_time: 0.000128017
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: "Deny"
             got: "Allow"

        (compared using ==)
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws"
  - :id: '3.10'
    :title: Ensure Private Endpoints are used to access Storage Accounts
    :desc: "Use private endpoints for your Azure Storage accounts to allow clients
      and services to securely access data located over a network via an encrypted
      Private Link. \nTo do this, the private endpoint uses an IP address from the
      VNet for each service. \nNetwork traffic between disparate services securely
      traverses encrypted over the VNet. \nThis VNet can also link addressing space,
      extending your network and accessing resources on it. \nSimilarly, it can be
      a tunnel through public networks to connect remote infrastructures together.
      \nThis creates further security through segmenting network traffic and preventing
      outside sources from accessing it."
    :descriptions:
    - :label: default
      :data: "Use private endpoints for your Azure Storage accounts to allow clients
        and services to securely access data located over a network via an encrypted
        Private Link. \nTo do this, the private endpoint uses an IP address from the
        VNet for each service. \nNetwork traffic between disparate services securely
        traverses encrypted over the VNet. \nThis VNet can also link addressing space,
        extending your network and accessing resources on it. \nSimilarly, it can
        be a tunnel through public networks to connect remote infrastructures together.
        \nThis creates further security through segmenting network traffic and preventing
        outside sources from accessing it."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.10
      :level: 1
    :code: "control '3.10' do\n  title 'Ensure Private Endpoints are used to access
      Storage Accounts'\n  impact 1.0\n  tag cis: 'azure:3.10'\n  tag level: 1\n  desc
      <<-DESC\n  Use private endpoints for your Azure Storage accounts to allow clients
      and services to securely access data located over a network via an encrypted
      Private Link. \n  To do this, the private endpoint uses an IP address from the
      VNet for each service. \n  Network traffic between disparate services securely
      traverses encrypted over the VNet. \n  This VNet can also link addressing space,
      extending your network and accessing resources on it. \n  Similarly, it can
      be a tunnel through public networks to connect remote infrastructures together.
      \n  This creates further security through segmenting network traffic and preventing
      outside sources from accessing it.\n  DESC\n\n  storage_accounts.each do |resource_group,
      azure_storage_account_names|\n    azure_storage_account_names.each do | asa_hash
      |\n      asa_hash.keys.each do | storage_account_name |\n        a_storage_account
      = asa_hash[storage_account_name]\n        describe a_storage_account do\n          its('properties.privateEndpointConnections')
      { should_not be_empty }\n        end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 881
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts butlersa properties.privateEndpointConnections
        is expected not to be empty'
      :run_time: 0.002635037
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"butler-sa", :name=>"butlersa", :resource_provider=>"Microsoft.Storage/storageAccounts",
        :allowed_parameters=>[:activity_log_alert_api_version, :storage_service_endpoint_api_version,
        :diagnostic_settings_api_version], :storage_service_endpoint_api_version=>"2019-12-12",
        :activity_log_alert_api_version=>"latest", :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts custodiand9730719 properties.privateEndpointConnections
        is expected not to be empty'
      :run_time: 0.002319448
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts cs21003200188a89c60 properties.privateEndpointConnections
        is expected not to be empty'
      :run_time: 0.00218844
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts habwinws properties.privateEndpointConnections
        is expected not to be empty'
      :run_time: 0.002201755
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws"
  - :id: '3.11'
    :title: Ensure Soft Delete is Enabled for Azure Containers and Blob Storage
    :desc: "The Azure Storage blobs contain data like ePHI or Financial, which can
      be secret or personal. \nData that is erroneously modified or deleted by an
      application or other storage account user will cause data loss or unavailability.\nIt
      is recommended that both Azure Containers with attached Blob Storage and standalone
      containers with Blob Storage be made recoverable by enabling the soft delete
      configuration. \nThis is to save and recover data when blobs or blob snapshots
      are deleted.\nContainers and Blob Storage data can be incorrectly deleted. \nAn
      attacker/malicious user may do this deliberately in order to cause disruption.
      Deleting an Azure Storage blob causes immediate data loss. \nEnabling this configuration
      for Azure storage ensures that even if blobs/data were deleted from the storage
      account, Blobs/data objects are recoverable for a particular time which is set
      in the \"Retention policies,\" ranging from 7 days to 365 days."
    :descriptions:
    - :label: default
      :data: "The Azure Storage blobs contain data like ePHI or Financial, which can
        be secret or personal. \nData that is erroneously modified or deleted by an
        application or other storage account user will cause data loss or unavailability.\nIt
        is recommended that both Azure Containers with attached Blob Storage and standalone
        containers with Blob Storage be made recoverable by enabling the soft delete
        configuration. \nThis is to save and recover data when blobs or blob snapshots
        are deleted.\nContainers and Blob Storage data can be incorrectly deleted.
        \nAn attacker/malicious user may do this deliberately in order to cause disruption.
        Deleting an Azure Storage blob causes immediate data loss. \nEnabling this
        configuration for Azure storage ensures that even if blobs/data were deleted
        from the storage account, Blobs/data objects are recoverable for a particular
        time which is set in the \"Retention policies,\" ranging from 7 days to 365
        days."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.11
      :level: 1
    :code: "control '3.11' do\n  title 'Ensure Soft Delete is Enabled for Azure Containers
      and Blob Storage'\n  impact 1.0\n  tag cis: 'azure:3.11'\n  tag level: 1\n  desc
      <<-DESC\n  The Azure Storage blobs contain data like ePHI or Financial, which
      can be secret or personal. \n  Data that is erroneously modified or deleted
      by an application or other storage account user will cause data loss or unavailability.\n
      \ It is recommended that both Azure Containers with attached Blob Storage and
      standalone containers with Blob Storage be made recoverable by enabling the
      soft delete configuration. \n  This is to save and recover data when blobs or
      blob snapshots are deleted.\n  Containers and Blob Storage data can be incorrectly
      deleted. \n  An attacker/malicious user may do this deliberately in order to
      cause disruption. Deleting an Azure Storage blob causes immediate data loss.
      \n  Enabling this configuration for Azure storage ensures that even if blobs/data
      were deleted from the storage account, Blobs/data objects are recoverable for
      a particular time which is set in the \"Retention policies,\" ranging from 7
      days to 365 days.\n  DESC\n\n  storage_accounts.each do |resource_group, azure_storage_account_names|\n
      \   azure_storage_account_names.each do | asa_hash |\n      asa_hash.keys.each
      do | storage_account_name |\n        describe azure_blob_service(resource_group:
      resource_group, storage_account_name: storage_account_name) do\n          its('properties.containerDeleteRetentionPolicy.enabled')
      { should eq true }\n          its('properties.containerDeleteRetentionPolicy.days')
      { should_not be_nil }\n          its('properties.deleteRetentionPolicy.enabled')
      { should eq true }\n          its('properties.deleteRetentionPolicy.days') {
      should_not be_nil }\n        end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 907
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.000167088
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: #<#<Class:0x000078b4fd7d7d20>::NullResponse:0x000078b4fde53988>

        (compared using ==)
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"butler-sa", :storage_account_name=>"butlersa",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"butlersa/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 0.000130748
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"butler-sa", :storage_account_name=>"butlersa",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"butlersa/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.00032136
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: false

        (compared using ==)

        Diff:
        @@ -1 +1 @@
        -true
        +false
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"butler-sa", :storage_account_name=>"butlersa",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"butlersa/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 0.000116914
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"butler-sa", :storage_account_name=>"butlersa",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"butlersa/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.000140826
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: #<#<Class:0x000078b4fd7d7d20>::NullResponse:0x000078b4fde12028>

        (compared using ==)
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-custodian", :storage_account_name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"custodiand9730719/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 9.3864e-05
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-custodian", :storage_account_name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"custodiand9730719/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.000254032
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: false

        (compared using ==)

        Diff:
        @@ -1 +1 @@
        -true
        +false
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-custodian", :storage_account_name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"custodiand9730719/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 0.000104835
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-custodian", :storage_account_name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"custodiand9730719/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.000425141
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: #<#<Class:0x000078b4fd7d7d20>::NullResponse:0x000078b4fdb63cc8>

        (compared using ==)
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :storage_account_name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"cs21003200188a89c60/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 0.000105599
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :storage_account_name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"cs21003200188a89c60/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.000266371
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: false

        (compared using ==)

        Diff:
        @@ -1 +1 @@
        -true
        +false
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :storage_account_name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"cs21003200188a89c60/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 0.000109858
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :storage_account_name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"cs21003200188a89c60/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.000131391
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: #<#<Class:0x000078b4fd7d7d20>::NullResponse:0x000078b4fdbb39f8>

        (compared using ==)
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :storage_account_name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"habwinws/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts default properties.containerDeleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 9.5975e-05
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :storage_account_name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"habwinws/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.enabled
        is expected to eq true'
      :run_time: 0.000432694
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: true
             got: false

        (compared using ==)

        Diff:
        @@ -1 +1 @@
        -true
        +false
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :storage_account_name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"habwinws/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws/blobServices/default"
    - :status: failed
      :code_desc: 'Azure Blob Service - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts default properties.deleteRetentionPolicy.days
        is expected not to be nil'
      :run_time: 0.000117123
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_blob_service
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :storage_account_name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :required_parameters=>[:storage_account_name],
        :name=>"default", :resource_path=>"habwinws/blobServices", :method=>"get"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws/blobServices/default"
  - :id: '3.15'
    :title: Ensure the "Minimum TLS version" for storage accounts is set to "Version
      1.2"
    :desc: "In some cases, Azure Storage sets the minimum TLS version to be version
      1.0 by default. \nTLS 1.0 is a legacy version and has known vulnerabilities.
      This minimum TLS version can be configured to be later protocols such as TLS
      1.2."
    :descriptions:
    - :label: default
      :data: "In some cases, Azure Storage sets the minimum TLS version to be version
        1.0 by default. \nTLS 1.0 is a legacy version and has known vulnerabilities.
        This minimum TLS version can be configured to be later protocols such as TLS
        1.2."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:3.15
      :level: 1
    :code: "control '3.15' do\n  title 'Ensure the \"Minimum TLS version\" for storage
      accounts is set to \"Version 1.2\"'\n  impact 1.0\n  tag cis: 'azure:3.15'\n
      \ tag level: 1\n  desc <<-DESC\n  In some cases, Azure Storage sets the minimum
      TLS version to be version 1.0 by default. \n  TLS 1.0 is a legacy version and
      has known vulnerabilities. This minimum TLS version can be configured to be
      later protocols such as TLS 1.2.\n  DESC\n\n  storage_accounts.each do |resource_group,
      azure_storage_account_names|\n    azure_storage_account_names.each do | asa_hash
      |\n      asa_hash.keys.each do | storage_account_name |\n        a_storage_account
      = asa_hash[storage_account_name]\n        describe a_storage_account do\n          its('properties.minimumTlsVersion')
      { should eq \"TLS1_2\" }\n        end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 936
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: butler-sa
        Microsoft.Storage/storageAccounts butlersa properties.minimumTlsVersion is
        expected to eq "TLS1_2"'
      :run_time: 0.000124438
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"butler-sa", :name=>"butlersa", :resource_provider=>"Microsoft.Storage/storageAccounts",
        :allowed_parameters=>[:activity_log_alert_api_version, :storage_service_endpoint_api_version,
        :diagnostic_settings_api_version], :storage_service_endpoint_api_version=>"2019-12-12",
        :activity_log_alert_api_version=>"latest", :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/butler-sa/providers/Microsoft.Storage/storageAccounts/butlersa"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-custodian
        Microsoft.Storage/storageAccounts custodiand9730719 properties.minimumTlsVersion
        is expected to eq "TLS1_2"'
      :run_time: 0.000131104
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: "TLS1_2"
             got: "TLS1_0"

        (compared using ==)
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"custodiand9730719",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Storage/storageAccounts/custodiand9730719"
    - :status: passed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: cloud-shell-storage-eastus
        Microsoft.Storage/storageAccounts cs21003200188a89c60 properties.minimumTlsVersion
        is expected to eq "TLS1_2"'
      :run_time: 8.6057e-05
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"cloud-shell-storage-eastus", :name=>"cs21003200188a89c60",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-shell-storage-eastus/providers/Microsoft.Storage/storageAccounts/cs21003200188a89c60"
    - :status: failed
      :code_desc: 'Azure Storage Account - api_version: 2023-05-01 latest: habitat_windows_workstations
        Microsoft.Storage/storageAccounts habwinws properties.minimumTlsVersion is
        expected to eq "TLS1_2"'
      :run_time: 0.000117707
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |2

        expected: "TLS1_2"
             got: "TLS1_0"

        (compared using ==)
      :resource_class: azure_storage_account
      :resource_params: '[{:resource_group=>"habitat_windows_workstations", :name=>"habwinws",
        :resource_provider=>"Microsoft.Storage/storageAccounts", :allowed_parameters=>[:activity_log_alert_api_version,
        :storage_service_endpoint_api_version, :diagnostic_settings_api_version],
        :storage_service_endpoint_api_version=>"2019-12-12", :activity_log_alert_api_version=>"latest",
        :diagnostic_settings_api_version=>"2017-05-01-preview"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/habitat_windows_workstations/providers/Microsoft.Storage/storageAccounts/habwinws"
  - :id: 4.1.1
    :title: Ensure that 'Auditing' is set to 'On'
    :desc: |-
      The Azure platform allows a SQL server to be created as a service.
      Enabling auditing at the server level ensures that all existing and newly
      created databases on the SQL server instance are audited. Auditing policy
      applied on the SQL database does not override auditing policy and settings
      applied on the particular SQL server where the database is hosted.

      Auditing tracks database events and writes them to an audit log in the Azure
      storage account. It also helps to maintain regulatory compliance, understand
      database activity, and gain insight into discrepancies and anomalies that
      could indicate business concerns or suspected security violations.
    :descriptions:
    - :label: default
      :data: |-
        The Azure platform allows a SQL server to be created as a service.
        Enabling auditing at the server level ensures that all existing and newly
        created databases on the SQL server instance are audited. Auditing policy
        applied on the SQL database does not override auditing policy and settings
        applied on the particular SQL server where the database is hosted.

        Auditing tracks database events and writes them to an audit log in the Azure
        storage account. It also helps to maintain regulatory compliance, understand
        database activity, and gain insight into discrepancies and anomalies that
        could indicate business concerns or suspected security violations.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.1.1
      :level: 1
    :code: |
      control '4.1.1' do
        title "Ensure that 'Auditing' is set to 'On'"
        impact 1.0
        tag cis: 'azure:4.1.1'
        tag level: 1
        desc <<-DESC
          The Azure platform allows a SQL server to be created as a service.
          Enabling auditing at the server level ensures that all existing and newly
          created databases on the SQL server instance are audited. Auditing policy
          applied on the SQL database does not override auditing policy and settings
          applied on the particular SQL server where the database is hosted.

          Auditing tracks database events and writes them to an audit log in the Azure
          storage account. It also helps to maintain regulatory compliance, understand
          database activity, and gain insight into discrepancies and anomalies that
          could indicate business concerns or suspected security violations.
        DESC

        # Ensure that at least one Azure SQL server exist
        describe azure_SQL_servers do
          its('names') { should_not be_empty }
        end

        sql_servers.each do | resource_group, sql_server_list |
          sql_server_list.each do |sql_server_hash|
            sql_server_hash.keys.each do | server_name |
              server_configuration = sql_server_hash[server_name]
              describe server_configuration do
                its('auditing_settings.properties') { should have_attributes(state: 'Enabled') }
              end
            end
          end
        end
      end
    :source_location:
      :line: 958
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Sql Servers - api_version: 2023-08-01-preview latest Microsoft.Sql/servers
        names is expected not to be empty'
      :run_time: 0.002240919
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_sql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.1.2
    :title: Ensure no Azure SQL Databases allow ingress from 0.0.0.0/0 (ANY IP)
    :desc: "Ensure that no SQL Databases allow ingress from 0.0.0.0/0 (ANY IP).\n\nAzure
      SQL Server includes a firewall to block access to unauthorized connections.
      \nMore granular IP addresses can be defined by referencing the range of addresses
      available from specific datacenters.\n\nBy default, for a SQL server, a Firewall
      exists with StartIp of 0.0.0.0 and \nEndIP of 0.0.0.0 allowing access to all
      the Azure services.\n\nAdditionally, a custom rule can be set up with StartIp
      of 0.0.0.0\nand EndIP of 255.255.255.255 allowing access from ANY IP over the
      Internet.\n\nIn order to reduce the potential attack surface for a SQL server,
      firewall rules\nshould be defined with more granular IP addresses by referencing
      the range of\naddresses available from specific data-centers.\n\nNOTE:\nFirewall
      rules configured on individual SQL Database using Transact-sql overrides \nthe
      rules set on SQL server. Azure does not provides any Powershell, API, CLI or
      \nPortal option to check database level firewall rules and so far Transact-SQL
      is \nthe only way to check for the same. For comprehensive control over egress
      traffic \non SQL Databases, Firewall rules should be checked using a SQL client."
    :descriptions:
    - :label: default
      :data: "Ensure that no SQL Databases allow ingress from 0.0.0.0/0 (ANY IP).\n\nAzure
        SQL Server includes a firewall to block access to unauthorized connections.
        \nMore granular IP addresses can be defined by referencing the range of addresses
        available from specific datacenters.\n\nBy default, for a SQL server, a Firewall
        exists with StartIp of 0.0.0.0 and \nEndIP of 0.0.0.0 allowing access to all
        the Azure services.\n\nAdditionally, a custom rule can be set up with StartIp
        of 0.0.0.0\nand EndIP of 255.255.255.255 allowing access from ANY IP over
        the Internet.\n\nIn order to reduce the potential attack surface for a SQL
        server, firewall rules\nshould be defined with more granular IP addresses
        by referencing the range of\naddresses available from specific data-centers.\n\nNOTE:\nFirewall
        rules configured on individual SQL Database using Transact-sql overrides \nthe
        rules set on SQL server. Azure does not provides any Powershell, API, CLI
        or \nPortal option to check database level firewall rules and so far Transact-SQL
        is \nthe only way to check for the same. For comprehensive control over egress
        traffic \non SQL Databases, Firewall rules should be checked using a SQL client."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.1.2
      :level: 1
    :code: "control '4.1.2' do\n  title 'Ensure no Azure SQL Databases allow ingress
      from 0.0.0.0/0 (ANY IP)'\n  impact 1.0\n  tag cis: 'azure:4.1.2'\n  tag level:
      1\n  desc <<-DESC\n    Ensure that no SQL Databases allow ingress from 0.0.0.0/0
      (ANY IP).\n\n    Azure SQL Server includes a firewall to block access to unauthorized
      connections. \n    More granular IP addresses can be defined by referencing
      the range of addresses available from specific datacenters.\n\n    By default,
      for a SQL server, a Firewall exists with StartIp of 0.0.0.0 and \n    EndIP
      of 0.0.0.0 allowing access to all the Azure services.\n    \n    Additionally,
      a custom rule can be set up with StartIp of 0.0.0.0\n    and EndIP of 255.255.255.255
      allowing access from ANY IP over the Internet.\n\n    In order to reduce the
      potential attack surface for a SQL server, firewall rules\n    should be defined
      with more granular IP addresses by referencing the range of\n    addresses available
      from specific data-centers.\n\n    NOTE:\n    Firewall rules configured on individual
      SQL Database using Transact-sql overrides \n    the rules set on SQL server.
      Azure does not provides any Powershell, API, CLI or \n    Portal option to check
      database level firewall rules and so far Transact-SQL is \n    the only way
      to check for the same. For comprehensive control over egress traffic \n    on
      SQL Databases, Firewall rules should be checked using a SQL client.\n  DESC\n\n
      \ # Ensure that at least one Azure SQL server exist\n  describe azure_SQL_servers
      do\n    its('names') { should_not be_empty }\n  end\n\n  sql_servers.each do
      | resource_group, sql_server_list |\n    sql_server_list.each do |sql_server_hash|\n
      \     sql_server_hash.keys.each do | server_name |\n        server_configuration
      = sql_server_hash[server_name]\n        sql_server_firewall = server_configuration.firewall_rules\n
      \       if sql_server_firewall.empty?\n          describe sql_server_firewall
      do\n            it { should be_empty }\n          end\n        else\n          sql_server_firewall.each
      do |firewall_rule|\n            describe firewall_rule do\n              its('properties')
      { should_not have_attributes(startIpAddress: '0.0.0.0', endIpAddress: '0.0.0.0')
      }\n              its('properties') { should_not have_attributes(startIpAddress:
      '0.0.0.0', endIpAddress: '255.255.255.255') }\n            end\n          end\n
      \       end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 993
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Sql Servers - api_version: 2023-08-01-preview latest Microsoft.Sql/servers
        names is expected not to be empty'
      :run_time: 0.002194881
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_sql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.1.4
    :title: Ensure that Azure Active Directory Admin is Configured for SQL Servers
    :desc: |-
      Use Azure Active Directory Authentication for authentication with SQL Database
      Rationale Statement

      Azure Active Directory authentication is a mechanism of connecting to Microsoft Azure
      SQL Database and SQL Data Warehouse by using identities in Azure Active Directory (Azure AD).
      With Azure AD authentication, you can centrally manage the identities of database users
      and other Microsoft services in one central location. Central ID management provides a single
      place to manage database users and simplifies permission management.
    :descriptions:
    - :label: default
      :data: |-
        Use Azure Active Directory Authentication for authentication with SQL Database
        Rationale Statement

        Azure Active Directory authentication is a mechanism of connecting to Microsoft Azure
        SQL Database and SQL Data Warehouse by using identities in Azure Active Directory (Azure AD).
        With Azure AD authentication, you can centrally manage the identities of database users
        and other Microsoft services in one central location. Central ID management provides a single
        place to manage database users and simplifies permission management.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.1.4
      :level: 1
    :code: "control '4.1.4' do\n  title 'Ensure that Azure Active Directory Admin
      is Configured for SQL Servers'\n  impact 1.0\n  tag cis: 'azure:4.1.4'\n  tag
      level: 1\n  desc <<-DESC\n    Use Azure Active Directory Authentication for
      authentication with SQL Database\n    Rationale Statement\n\n    Azure Active
      Directory authentication is a mechanism of connecting to Microsoft Azure\n    SQL
      Database and SQL Data Warehouse by using identities in Azure Active Directory
      (Azure AD).\n    With Azure AD authentication, you can centrally manage the
      identities of database users\n    and other Microsoft services in one central
      location. Central ID management provides a single\n    place to manage database
      users and simplifies permission management.\n  DESC\n\n  # Ensure that at least
      one Azure SQL server exist\n  describe azure_SQL_servers do\n    its('names')
      { should_not be_empty }\n  end\n\n  sql_servers.each do | resource_group, sql_server_list
      |\n    sql_server_list.each do |sql_server_hash|\n      sql_server_hash.keys.each
      do | server_name |\n        server_configuration = sql_server_hash[server_name]\n
      \       describe server_configuration do\n          its('administrators') {
      should_not be_empty }\n        end\n  \n        server_configuration.administrators.each
      do |admin|\n          describe admin do\n            its('id')         { should_not
      be_nil }\n            its('properties') { should have_attributes(administratorType:
      'ActiveDirectory') }\n          end\n        end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 1049
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Sql Servers - api_version: 2023-08-01-preview latest Microsoft.Sql/servers
        names is expected not to be empty'
      :run_time: 0.00235229
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_sql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.1.5
    :title: Ensure that 'Data encryption' is set to 'On' on a SQL Database
    :desc: |-
      Enable Transparent Data Encryption on every SQL server.

      Azure SQL Database transparent data encryption helps protect against the threat of malicious activity
      by performing real-time encryption and decryption of the database, associated backups, and transaction
      log files at rest without requiring changes to the application.
    :descriptions:
    - :label: default
      :data: |-
        Enable Transparent Data Encryption on every SQL server.

        Azure SQL Database transparent data encryption helps protect against the threat of malicious activity
        by performing real-time encryption and decryption of the database, associated backups, and transaction
        log files at rest without requiring changes to the application.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.1.5
      :level: 1
    :code: "control '4.1.5' do\n  title \"Ensure that 'Data encryption' is set to
      'On' on a SQL Database\"\n  impact 1.0\n  tag cis: 'azure:4.1.5'\n  tag level:
      1\n  desc <<-DESC\n    Enable Transparent Data Encryption on every SQL server.\n
      \   \n    Azure SQL Database transparent data encryption helps protect against
      the threat of malicious activity\n    by performing real-time encryption and
      decryption of the database, associated backups, and transaction\n    log files
      at rest without requiring changes to the application.\n  DESC\n\n  # Ensure
      that at least one Azure SQL server exist\n  describe azure_SQL_servers do\n
      \   its('names') { should_not be_empty }\n  end\n\n  sql_servers.each do | resource_group,
      sql_server_list |\n    sql_server_list.each do |sql_server_hash|\n      sql_server_hash.keys.each
      do |sql_server_name|\n        azure_sql_databases(resource_group: resource_group,
      server_name: sql_server_name).names.each do |sql_database_name|\n          next
      unless sql_database_name != 'master' # master DB is excluded https://docs.microsoft.com/en-gb/azure/sql-database/transparent-data-encryption-azure-sql?view=sql-server-2017\n
      \         describe azure_sql_database(resource_group: resource_group, server_name:
      sql_server_name, database_name: sql_database_name) do\n            its('encryption_settings.properties.state')
      { should eq 'Enabled' }\n          end\n        end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 1089
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Sql Servers - api_version: 2023-08-01-preview latest Microsoft.Sql/servers
        names is expected not to be empty'
      :run_time: 0.002156256
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_sql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.1.6
    :title: Ensure that 'Auditing' Retention is 'greater than 90 days'
    :desc: |-
      SQL Server Audit Retention should be configured to be greater than 90 days.

      Audit Logs can be used to check for anomalies and give insight into
      suspected breaches or misuse of information and access.
    :descriptions:
    - :label: default
      :data: |-
        SQL Server Audit Retention should be configured to be greater than 90 days.

        Audit Logs can be used to check for anomalies and give insight into
        suspected breaches or misuse of information and access.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.1.6
      :level: 1
    :code: |
      control '4.1.6' do
        title "Ensure that 'Auditing' Retention is 'greater than 90 days'"
        impact 1.0
        tag cis: 'azure:4.1.6'
        tag level: 1
        desc <<-DESC
          SQL Server Audit Retention should be configured to be greater than 90 days.

          Audit Logs can be used to check for anomalies and give insight into
          suspected breaches or misuse of information and access.
        DESC

        # Ensure that at least one Azure SQL server exist
        describe azure_SQL_servers do
          its('names') { should_not be_empty }
        end

        sql_servers.each do | resource_group, sql_server_list |
          sql_server_list.each do |sql_server_hash|
            sql_server_hash.keys.each do | server_name |
              server_configuration = sql_server_hash[server_name]
              describe server_configuration.auditing_settings do
                its('properties') { should have_attributes(state: 'Enabled') }
              end
              describe.one do
                describe server_configuration.auditing_settings do
                  its('properties.retentionDays') { should cmp >= 90 }
                end
                describe server_configuration.auditing_settings do
                  its('properties.retentionDays') { should cmp 0 }
                end
              end
            end
          end
        end
      end
    :source_location:
      :line: 1121
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Sql Servers - api_version: 2023-08-01-preview latest Microsoft.Sql/servers
        names is expected not to be empty'
      :run_time: 0.002249222
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_sql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.2.5
    :title: Ensure that Vulnerability Assessment (VA) is enabled on a SQL server by
      setting a Storage Account
    :desc: "Enable Vulnerability Assessment (VA) service scans for critical SQL servers
      and corresponding SQL databases.\n\nEnabling Microsoft Defender for SQL server
      does not enables Vulnerability Assessment capability for individual SQL databases
      unless storage account is set to store the scanning data and reports.\nThe Vulnerability
      Assessment service scans databases for known security vulnerabilities and highlights
      deviations from best practices, such as misconfigurations, excessive permissions,
      and \nunprotected sensitive data. Results of the scan include actionable steps
      to resolve each issue and provide customized remediation scripts where applicable.
      Additionally, an assessment report can be \ncustomized by setting an acceptable
      baseline for permission configurations, feature configurations, and database
      settings."
    :descriptions:
    - :label: default
      :data: "Enable Vulnerability Assessment (VA) service scans for critical SQL
        servers and corresponding SQL databases.\n\nEnabling Microsoft Defender for
        SQL server does not enables Vulnerability Assessment capability for individual
        SQL databases unless storage account is set to store the scanning data and
        reports.\nThe Vulnerability Assessment service scans databases for known security
        vulnerabilities and highlights deviations from best practices, such as misconfigurations,
        excessive permissions, and \nunprotected sensitive data. Results of the scan
        include actionable steps to resolve each issue and provide customized remediation
        scripts where applicable. Additionally, an assessment report can be \ncustomized
        by setting an acceptable baseline for permission configurations, feature configurations,
        and database settings."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.2.5
      :level: 1
    :code: "control '4.2.5' do\n  title \"Ensure that Vulnerability Assessment (VA)
      is enabled on a SQL server by setting a Storage Account\"\n  impact 1.0\n  tag
      cis: 'azure:4.2.5'\n  tag level: 1\n  desc <<-DESC\n    Enable Vulnerability
      Assessment (VA) service scans for critical SQL servers and corresponding SQL
      databases.\n\n    Enabling Microsoft Defender for SQL server does not enables
      Vulnerability Assessment capability for individual SQL databases unless storage
      account is set to store the scanning data and reports.\n    The Vulnerability
      Assessment service scans databases for known security vulnerabilities and highlights
      deviations from best practices, such as misconfigurations, excessive permissions,
      and \n    unprotected sensitive data. Results of the scan include actionable
      steps to resolve each issue and provide customized remediation scripts where
      applicable. Additionally, an assessment report can be \n    customized by setting
      an acceptable baseline for permission configurations, feature configurations,
      and database settings.\n  DESC\n\n  # Ensure that at least one Azure SQL server
      exist\n  describe azure_SQL_servers do\n    its('names') { should_not be_empty
      }\n  end\n\n  # Ensure that the SQL server/servers is/are configured correctly\n
      \ sql_servers.each do | resource_group, sql_server_list |\n    sql_server_list.each
      do |sql_server_hash|\n      sql_server_hash.keys.each do | server_name |\n        server_configuration
      = azure_sql_database_server_vulnerability_assessment(resource_group: resource_group,
      server_name: server_name)\n        describe server_configuration.properties.storageContainerPath.empty?
      do\n          it { should eq false }\n        end\n        describe server_configuration
      do\n          its('properties.recurringScans.emailSubscriptionAdmins') { should
      eq true }\n        end\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 1158
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Sql Servers - api_version: 2023-08-01-preview latest Microsoft.Sql/servers
        names is expected not to be empty'
      :run_time: 0.002285756
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_sql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.1
    :title: Ensure 'Enforce SSL connection' is set to 'ENABLED' for PostgreSQL Database
      Server
    :desc: |-
      Enable SSL connection on PostgreSQL Servers.

      SSL connectivity helps to provide a new layer of security, by connecting
      database server to client applications using Secure Sockets Layer (SSL).
      Enforcing SSL connections between database server and client applications
      helps protect against "man in the middle" attacks by encrypting the data
      stream between the server and application.
    :descriptions:
    - :label: default
      :data: |-
        Enable SSL connection on PostgreSQL Servers.

        SSL connectivity helps to provide a new layer of security, by connecting
        database server to client applications using Secure Sockets Layer (SSL).
        Enforcing SSL connections between database server and client applications
        helps protect against "man in the middle" attacks by encrypting the data
        stream between the server and application.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.1
      :level: 1
    :code: |
      control '4.3.1' do
        title "Ensure 'Enforce SSL connection' is set to 'ENABLED' for PostgreSQL Database Server"
        impact 1.0
        tag cis: 'azure:4.3.1'
        tag level: 1
        desc <<-DESC
          Enable SSL connection on PostgreSQL Servers.

          SSL connectivity helps to provide a new layer of security, by connecting
          database server to client applications using Secure Sockets Layer (SSL).
          Enforcing SSL connections between database server and client applications
          helps protect against "man in the middle" attacks by encrypting the data
          stream between the server and application.
        DESC

        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration do
                its('properties.sslEnforcement') { should eq 'Enabled' }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1193
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.002192524
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.2
    :title: Ensure Server Parameter 'log_checkpoints' is set to 'ON' for PostgreSQL
      Database Server
    :desc: |-
      Enable log_checkpoints on PostgreSQL Servers.

      Enabling log_checkpoints helps the PostgreSQL Database to Log each checkpoint in turn generates
      query and error logs. However, access to transaction logs is not supported.
      Query and error logs can be used to identify, troubleshoot, and repair configuration
      errors and sub-optimal performance.
    :descriptions:
    - :label: default
      :data: |-
        Enable log_checkpoints on PostgreSQL Servers.

        Enabling log_checkpoints helps the PostgreSQL Database to Log each checkpoint in turn generates
        query and error logs. However, access to transaction logs is not supported.
        Query and error logs can be used to identify, troubleshoot, and repair configuration
        errors and sub-optimal performance.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.2
      :level: 1
    :code: |
      control '4.3.2' do
        title "Ensure Server Parameter 'log_checkpoints' is set to 'ON' for PostgreSQL Database Server"
        impact 1.0
        tag cis: 'azure:4.3.2'
        tag level: 1
        desc <<-DESC
          Enable log_checkpoints on PostgreSQL Servers.

          Enabling log_checkpoints helps the PostgreSQL Database to Log each checkpoint in turn generates
          query and error logs. However, access to transaction logs is not supported.
          Query and error logs can be used to identify, troubleshoot, and repair configuration
          errors and sub-optimal performance.
        DESC

        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration do
                its('configurations') { is_expected.to respond_to(:log_checkpoints) }
                its('configurations.log_checkpoints.properties.value') { should cmp 'On' }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1226
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.002231915
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.3
    :title: Ensure server parameter 'log_connections' is set to 'ON' for PostgreSQL
      Database Server
    :desc: |-
      Enable log_connections on PostgreSQL Servers.

      Enabling log_connections helps PostgreSQL Database to log attempted connection to the server,
      as well as successful completion of client authentication. Log data can be used to identify,
      troubleshoot, and repair configuration errors and suboptimal performance.
    :descriptions:
    - :label: default
      :data: |-
        Enable log_connections on PostgreSQL Servers.

        Enabling log_connections helps PostgreSQL Database to log attempted connection to the server,
        as well as successful completion of client authentication. Log data can be used to identify,
        troubleshoot, and repair configuration errors and suboptimal performance.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.3
      :level: 1
    :code: |
      control '4.3.3' do
        title "Ensure server parameter 'log_connections' is set to 'ON' for PostgreSQL Database Server"
        impact 1.0
        tag cis: 'azure:4.3.3'
        tag level: 1
        desc <<-DESC
          Enable log_connections on PostgreSQL Servers.

          Enabling log_connections helps PostgreSQL Database to log attempted connection to the server,
          as well as successful completion of client authentication. Log data can be used to identify,
          troubleshoot, and repair configuration errors and suboptimal performance.
        DESC

        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration do
                its('configurations') { is_expected.to respond_to(:log_connections) }
                its('configurations.log_connections.properties.value') { should cmp 'On' }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1259
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.002436017
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.4
    :title: Ensure server parameter 'log_disconnections' is set to 'ON' for PostgreSQL
      Database Server
    :desc: |-
      Enable log_disconnections on PostgreSQL Servers.

      Enabling log_disconnections helps PostgreSQL Database to Logs end of a session,
      including duration, which in turn generates query and error logs. Query and error
      logs can be used to identify, troubleshoot, and repair configuration errors
      and sub-optimal performance.
    :descriptions:
    - :label: default
      :data: |-
        Enable log_disconnections on PostgreSQL Servers.

        Enabling log_disconnections helps PostgreSQL Database to Logs end of a session,
        including duration, which in turn generates query and error logs. Query and error
        logs can be used to identify, troubleshoot, and repair configuration errors
        and sub-optimal performance.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.4
      :level: 1
    :code: |
      control '4.3.4' do
        title "Ensure server parameter 'log_disconnections' is set to 'ON' for PostgreSQL Database Server"
        impact 1.0
        tag cis: 'azure:4.3.4'
        tag level: 1
        desc <<-DESC
          Enable log_disconnections on PostgreSQL Servers.

          Enabling log_disconnections helps PostgreSQL Database to Logs end of a session,
          including duration, which in turn generates query and error logs. Query and error
          logs can be used to identify, troubleshoot, and repair configuration errors
          and sub-optimal performance.
        DESC

        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration do
                its('configurations') { is_expected.to respond_to(:log_disconnections) }
                its('configurations.log_disconnections.properties.value') { should cmp 'On' }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1291
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.002186071
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.5
    :title: Ensure server parameter 'connection_throttling' is set to 'ON' for PostgreSQL
      Database Server
    :desc: |-
      Enable connection_throttling on PostgreSQL Servers.

      Enabling connection_throttling helps the PostgreSQL Database to Set the verbosity of
      logged messages. This in turn generates query and error logs with respect to concurrent connections,
      that could lead to a successful Denial of Service (DoS) attack by exhausting connection resources.
      A system can also fail or be degraded by an overload of legitimate users. Query and error logs can be
      used to identify, troubleshoot, and repair configuration errors and sub-optimal performance.
    :descriptions:
    - :label: default
      :data: |-
        Enable connection_throttling on PostgreSQL Servers.

        Enabling connection_throttling helps the PostgreSQL Database to Set the verbosity of
        logged messages. This in turn generates query and error logs with respect to concurrent connections,
        that could lead to a successful Denial of Service (DoS) attack by exhausting connection resources.
        A system can also fail or be degraded by an overload of legitimate users. Query and error logs can be
        used to identify, troubleshoot, and repair configuration errors and sub-optimal performance.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.5
      :level: 1
    :code: |
      control '4.3.5' do
        title "Ensure server parameter 'connection_throttling' is set to 'ON' for PostgreSQL Database Server"
        impact 1.0
        tag cis: 'azure:4.3.5'
        tag level: 1
        desc <<-DESC
          Enable connection_throttling on PostgreSQL Servers.

          Enabling connection_throttling helps the PostgreSQL Database to Set the verbosity of
          logged messages. This in turn generates query and error logs with respect to concurrent connections,
          that could lead to a successful Denial of Service (DoS) attack by exhausting connection resources.
          A system can also fail or be degraded by an overload of legitimate users. Query and error logs can be
          used to identify, troubleshoot, and repair configuration errors and sub-optimal performance.
        DESC

        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration do
                its('configurations') { is_expected.to respond_to(:connection_throttling) }
                its('configurations.connection_throttling.properties.value') { should cmp 'On' }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1324
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.002232951
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.6
    :title: Ensure Server Parameter 'log_retention_days' is greater than 3 days for
      PostgreSQL Database Server
    :desc: |-
      Enable log_retention_days on PostgreSQL Servers.

      Enabling log_retention_days helps PostgreSQL Database to Sets number of days a log file is
      retained which in turn generates query and error logs. Query and error logs can be used to identify,
      troubleshoot, and repair configuration errors and sub-optimal performance.
    :descriptions:
    - :label: default
      :data: |-
        Enable log_retention_days on PostgreSQL Servers.

        Enabling log_retention_days helps PostgreSQL Database to Sets number of days a log file is
        retained which in turn generates query and error logs. Query and error logs can be used to identify,
        troubleshoot, and repair configuration errors and sub-optimal performance.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.6
      :level: 1
    :code: |
      control '4.3.6' do
        title "Ensure Server Parameter 'log_retention_days' is greater than 3 days for PostgreSQL Database Server"
        impact 1.0
        tag cis: 'azure:4.3.6'
        tag level: 1
        desc <<-DESC
          Enable log_retention_days on PostgreSQL Servers.

          Enabling log_retention_days helps PostgreSQL Database to Sets number of days a log file is
          retained which in turn generates query and error logs. Query and error logs can be used to identify,
          troubleshoot, and repair configuration errors and sub-optimal performance.
        DESC

        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration do
                its('configurations') { is_expected.to respond_to(:log_retention_days) }
                its('configurations.log_retention_days.properties.value') { should cmp > 3 }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1358
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.003596679
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.7
    :title: Ensure 'Allow access to Azure services' for PostgreSQL Database Server
      is disabled
    :desc: |-
      Disable access from Azure services to PostgreSQL Database Server
      If access from Azure services is enabled, the server's firewall will accept connections
      from all Azure resources, including resources not in your subscription. This is usually
      not a desired configuration. Instead, set up firewall rules to allow access from specific
      network ranges or VNET rules to allow access from specific virtual networks.
    :descriptions:
    - :label: default
      :data: |-
        Disable access from Azure services to PostgreSQL Database Server
        If access from Azure services is enabled, the server's firewall will accept connections
        from all Azure resources, including resources not in your subscription. This is usually
        not a desired configuration. Instead, set up firewall rules to allow access from specific
        network ranges or VNET rules to allow access from specific virtual networks.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.7
      :level: 1
    :code: |
      control '4.3.7' do
        title "Ensure 'Allow access to Azure services' for PostgreSQL Database Server is disabled"
        impact 1.0
        tag cis: 'azure:4.3.7'
        tag level: 1
        desc <<-DESC
          Disable access from Azure services to PostgreSQL Database Server
          If access from Azure services is enabled, the server's firewall will accept connections
          from all Azure resources, including resources not in your subscription. This is usually
          not a desired configuration. Instead, set up firewall rules to allow access from specific
          network ranges or VNET rules to allow access from specific virtual networks.
        DESC
        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end
        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration.firewall_rules do
                it { is_expected.not_to respond_to(:AllowAllWindowsAzureIps) }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1390
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.002285311
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.3.8
    :title: Ensure 'Infrastructure double encryption' for PostgreSQL Database Server
      is 'Enabled'
    :desc: |-
      Enable encryption at rest for PostgreSQL Databases.

      If Double Encryption is enabled, another layer of encryption is implemented
      at the hardware level before the storage or network level. Information will
      be encrypted before it is even accessed, preventing both interception of
      data in motion if the network layer encryption is broken and data at rest in
      system resources such as memory or processor cache. Encryption will also be
      in place for any backups taken of the database, so the key will secure
      access the data in all forms. For the most secure implementation of key
      based encryption, it is recommended to use a Customer Managed asymmetric RSA
      2048 Key in Azure Key Vault.
    :descriptions:
    - :label: default
      :data: |-
        Enable encryption at rest for PostgreSQL Databases.

        If Double Encryption is enabled, another layer of encryption is implemented
        at the hardware level before the storage or network level. Information will
        be encrypted before it is even accessed, preventing both interception of
        data in motion if the network layer encryption is broken and data at rest in
        system resources such as memory or processor cache. Encryption will also be
        in place for any backups taken of the database, so the key will secure
        access the data in all forms. For the most secure implementation of key
        based encryption, it is recommended to use a Customer Managed asymmetric RSA
        2048 Key in Azure Key Vault.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.3.8
      :level: 1
    :code: |
      control '4.3.8' do
        title "Ensure 'Infrastructure double encryption' for PostgreSQL Database Server is 'Enabled'"
        impact 1.0
        tag cis: 'azure:4.3.8'
        tag level: 1
        desc <<-DESC
          Enable encryption at rest for PostgreSQL Databases.

          If Double Encryption is enabled, another layer of encryption is implemented
          at the hardware level before the storage or network level. Information will
          be encrypted before it is even accessed, preventing both interception of
          data in motion if the network layer encryption is broken and data at rest in
          system resources such as memory or processor cache. Encryption will also be
          in place for any backups taken of the database, so the key will secure
          access the data in all forms. For the most secure implementation of key
          based encryption, it is recommended to use a Customer Managed asymmetric RSA
          2048 Key in Azure Key Vault.
        DESC

        # Ensure that at least one Azure PostgreSQL server exist
        describe azure_psql_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the PostgreSQL server/servers is/are configured correctly
        psql_servers.each do | resource_group, psql_server_list |
          psql_server_list.each do |psql_server_hash|
            psql_server_hash.keys.each do | server_name |
              server_configuration = psql_server_hash[server_name]
              describe server_configuration do
                its('properties.infrastructureEncryption') { should eq 'Enabled' }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1419
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Postgresql Servers - api_version: 2017-12-01 latest Microsoft.DBforPostgreSQL/servers
        names is expected not to be empty'
      :run_time: 0.002228539
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_postgresql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.4.1
    :title: Ensure 'Enforce SSL connection' is set to 'Enabled' for Standard MySQL
      Database Server
    :desc: |-
      Enable SSL connection on MYSQL Servers.

      SSL connectivity helps to provide a new layer of security by connecting
      database server to client applications using Secure Sockets Layer (SSL).
      Enforcing SSL connections between database server and client applications
      helps protect against "man in the middle" attacks by encrypting the data
      stream between the server and application.
    :descriptions:
    - :label: default
      :data: |-
        Enable SSL connection on MYSQL Servers.

        SSL connectivity helps to provide a new layer of security by connecting
        database server to client applications using Secure Sockets Layer (SSL).
        Enforcing SSL connections between database server and client applications
        helps protect against "man in the middle" attacks by encrypting the data
        stream between the server and application.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.4.1
      :level: 1
    :code: |
      control '4.4.1' do
        title "Ensure 'Enforce SSL connection' is set to 'Enabled' for Standard MySQL Database Server"
        impact 1.0
        tag cis: 'azure:4.4.1'
        tag level: 1
        desc <<-DESC
          Enable SSL connection on MYSQL Servers.

          SSL connectivity helps to provide a new layer of security by connecting
          database server to client applications using Secure Sockets Layer (SSL).
          Enforcing SSL connections between database server and client applications
          helps protect against "man in the middle" attacks by encrypting the data
          stream between the server and application.
        DESC

        # Ensure that at least one Azure MySQL server exist
        describe azure_mySQL_servers do
          its('names') { should_not be_empty }
        end

        # Ensure that the MySQL server/servers is/are configured correctly
        mysql_servers.each do | resource_group, mysql_server |
          mysql_server.each do |mysql_server_name|
            describe azure_mysql_server(resource_group: resource_group, server_name: mysql_server_name) do
              its('properties.sslEnforcement') { should eq 'Enabled' }
            end
          end
        end
      end
    :source_location:
      :line: 1456
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Mysql Servers - api_version: 2020-01-01 latest Microsoft.DBforMySQL/servers
        names is expected not to be empty'
      :run_time: 0.002346043
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_mysql_servers
      :resource_params: "[]"
      :resource_id: ''
  - :id: 4.4.2
    :title: Ensure 'TLS Version' is set to 'TLSV1.2' for MySQL flexible Database Server
    :desc: "Ensure TLS version on MySQL flexible servers is set to the default value.\nTLS
      connectivity helps to provide a new layer of security by connecting\ndatabase
      server to client applications using Transport Layer Security \n(TLS). Enforcing
      TLS connections between database server and client \napplications helps protect
      against \"man in the middle\" attacks by encrypting\nthe data stream between
      the server and application."
    :descriptions:
    - :label: default
      :data: "Ensure TLS version on MySQL flexible servers is set to the default value.\nTLS
        connectivity helps to provide a new layer of security by connecting\ndatabase
        server to client applications using Transport Layer Security \n(TLS). Enforcing
        TLS connections between database server and client \napplications helps protect
        against \"man in the middle\" attacks by encrypting\nthe data stream between
        the server and application."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:4.4.2
      :level: 1
    :code: "control '4.4.2' do\n  title \"Ensure 'TLS Version' is set to 'TLSV1.2'
      for MySQL flexible Database Server\"\n  impact 1.0\n  tag cis: 'azure:4.4.2'\n
      \ tag level: 1\n  desc <<-DESC\n    Ensure TLS version on MySQL flexible servers
      is set to the default value.\n    TLS connectivity helps to provide a new layer
      of security by connecting\n    database server to client applications using
      Transport Layer Security \n    (TLS). Enforcing TLS connections between database
      server and client \n    applications helps protect against \"man in the middle\"
      attacks by encrypting\n    the data stream between the server and application.\n
      \ DESC\n  describe 'no API support' do\n    skip 'No Azure API support. Alternative
      Audit Procedure:\n    From Azure Portal:\n    To ensure security defaults is
      enabled in your directory:\n    1. Login to Azure Portal using https://portal.azure.com\n
      \   2. Go to Azure Database for MySQL flexible servers\n    3. For each database,
      click on Server parameters under Settings\n    4. In the search box, type in
      tls_version\n    5. Ensure tls_version is set to TLSV1.2'\n  end\nend\n"
    :source_location:
      :line: 1486
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: no API support
      :run_time: 8.2e-06
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource: ''
      :skip_message: |-
        No Azure API support. Alternative Audit Procedure:
            From Azure Portal:
            To ensure security defaults is enabled in your directory:
            1. Login to Azure Portal using https://portal.azure.com
            2. Go to Azure Database for MySQL flexible servers
            3. For each database, click on Server parameters under Settings
            4. In the search box, type in tls_version
            5. Ensure tls_version is set to TLSV1.2
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: no API support
  - :id: 5.1.1
    :title: Ensure that a 'Diagnostic Setting' exists
    :desc: |-
      Enable Diagnostic settings for exporting activity logs. Diagnostic settings are available for each individual resource within
      a subscription. Settings should be configured for all appropriate resources for your environment. A diagnostic setting controls
      how a diagnostic log is exported. By default, logs are retained only for 90 days. Diagnostic settings should be defined so that
      logs can be exported and stored for a longer duration in order to analyze security activities within an Azure subscription.
    :descriptions:
    - :label: default
      :data: |-
        Enable Diagnostic settings for exporting activity logs. Diagnostic settings are available for each individual resource within
        a subscription. Settings should be configured for all appropriate resources for your environment. A diagnostic setting controls
        how a diagnostic log is exported. By default, logs are retained only for 90 days. Diagnostic settings should be defined so that
        logs can be exported and stored for a longer duration in order to analyze security activities within an Azure subscription.
    :impact: 0.0
    :refs: []
    :tags:
      :cis: azure:5.1.1
      :level: 1
    :code: |
      control '5.1.1' do
        title "Ensure that a 'Diagnostic Setting' exists"
        impact 0.0
        tag cis: 'azure:5.1.1'
        tag level: 1
        desc <<-DESC
          Enable Diagnostic settings for exporting activity logs. Diagnostic settings are available for each individual resource within
          a subscription. Settings should be configured for all appropriate resources for your environment. A diagnostic setting controls
          how a diagnostic log is exported. By default, logs are retained only for 90 days. Diagnostic settings should be defined so that
          logs can be exported and stored for a longer duration in order to analyze security activities within an Azure subscription.
        DESC

        describe 'Manual check' do
          skip 'There is no automatic check for this control. Alternative Audit Procedure:

          From Azure Portal

          1. Go to Monitor
          2. Click Diagnostic settings
          3. Ensure that Diagnostics status is enabled on all appropriate resources.'
        end
      end
    :source_location:
      :line: 1511
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 3.557e-06
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control. Alternative Audit Procedure:

            From Azure Portal

            1. Go to Monitor
            2. Click Diagnostic settings
            3. Ensure that Diagnostics status is enabled on all appropriate resources.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: 5.1.3
    :title: Ensure the Storage Container Storing the Activity Logs is not Publicly
      Accessible
    :desc: |-
      The storage account container containing the activity log export should not be publicly accessible.

      Allowing public access to activity log content may aid an adversary in identifying weaknesses
      in the affected account's use or configuration.
    :descriptions:
    - :label: default
      :data: |-
        The storage account container containing the activity log export should not be publicly accessible.

        Allowing public access to activity log content may aid an adversary in identifying weaknesses
        in the affected account's use or configuration.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.1.3
      :level: 1
    :code: |
      control '5.1.3' do
        title 'Ensure the Storage Container Storing the Activity Logs is not Publicly Accessible'
        impact 1.0
        tag cis: 'azure:5.1.3'
        tag level: 1
        desc <<-DESC
          The storage account container containing the activity log export should not be publicly accessible.

          Allowing public access to activity log content may aid an adversary in identifying weaknesses
          in the affected account's use or configuration.
        DESC

        # Check for the storage accounts containing blob container named 'insights-operational-logs'
        storage_accounts.each do |resource_group, storage_account_names|
          storage_account_names.each do | sa_hash |
            sa_hash.keys.each do |storage_account|
            # Activity logs are stored in blob container named `insights-operational-logs`
              storage_account_blob_container = azure_storage_account_blob_container(resource_group: resource_group, storage_account_name: storage_account, blob_container_name: 'insights-operational-logs')
              if storage_account_blob_container.exists?
                describe storage_account_blob_container do
                  its('properties.publicAccess') { should cmp 'None' }
                end
              end
            end
          end
        end
      end
    :source_location:
      :line: 1534
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: 5.1.5
    :title: Ensure that logging for Azure Key Vault is 'Enabled'
    :desc: |-
      Enable AuditEvent logging for key vault instances to ensure interactions with key vaults are logged and available.

      Monitoring how and when key vaults are accessed, and by whom, enables an audit trail of
      interactions with confidential information, keys, and certificates managed by Azure
      Keyvault. Enabling logging for Key Vault saves information in an Azure storage account
      which the user provides. This creates a new container named insights-logs-auditevent
      automatically for the specified storage account. This same storage account can be used
      for collecting logs for multiple key vaults.
    :descriptions:
    - :label: default
      :data: |-
        Enable AuditEvent logging for key vault instances to ensure interactions with key vaults are logged and available.

        Monitoring how and when key vaults are accessed, and by whom, enables an audit trail of
        interactions with confidential information, keys, and certificates managed by Azure
        Keyvault. Enabling logging for Key Vault saves information in an Azure storage account
        which the user provides. This creates a new container named insights-logs-auditevent
        automatically for the specified storage account. This same storage account can be used
        for collecting logs for multiple key vaults.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.1.5
      :level: 1
    :code: |
      control '5.1.5' do
        title "Ensure that logging for Azure Key Vault is 'Enabled'"
        impact 1.0
        tag cis: 'azure:5.1.5'
        tag level: 1
        desc <<-DESC
          Enable AuditEvent logging for key vault instances to ensure interactions with key vaults are logged and available.

          Monitoring how and when key vaults are accessed, and by whom, enables an audit trail of
          interactions with confidential information, keys, and certificates managed by Azure
          Keyvault. Enabling logging for Key Vault saves information in an Azure storage account
          which the user provides. This creates a new container named insights-logs-auditevent
          automatically for the specified storage account. This same storage account can be used
          for collecting logs for multiple key vaults.
        DESC

        # Ensure that at least one Azure Key Vault exist
        describe azure_key_vaults do
          its('names') { should_not be_empty }
        end

        # Ensure that the Key Vault/Vaults is/are configured correctly
        key_vaults.each do | resource_group, key_vaults |
          key_vaults.each do |key_vault|
            describe azure_key_vault(resource_group: resource_group, name: key_vault) do
              its('diagnostic_settings') { should_not be_empty }
            end
            azure_key_vault(resource_group: resource_group, name: key_vault).diagnostic_settings.each do |diagnostic_setting|
              describe diagnostic_setting do
                its('properties.storageAccountId') { should_not be_nil }
              end
              describe diagnostic_setting.properties.logs[0] do
                its('category') { should eq "AuditEvent" }
                its('enabled') { should be true }
                its('retentionPolicy.days') { should cmp >= 0 }
              end
            end
          end
        end
      end
    :source_location:
      :line: 1562
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Key Vaults - api_version: 2023-08-01-PREVIEW latest Microsoft.KeyVault/vaults
        names is expected not to be empty'
      :run_time: 0.002239327
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: azure_key_vaults
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.1
    :title: Ensure that Activity Log Alert exists for Create Policy Assignment
    :desc: |-
      Create an activity log alert for the Create Policy Assignment event.

      Monitoring for create policy assignment events gives insight into changes
      done in "Azure policy - assignments" and can reduce the time it takes to
      detect unsolicited changes.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Create Policy Assignment event.

        Monitoring for create policy assignment events gives insight into changes
        done in "Azure policy - assignments" and can reduce the time it takes to
        detect unsolicited changes.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.1
      :level: 1
    :code: |
      control '5.2.1' do
        title 'Ensure that Activity Log Alert exists for Create Policy Assignment'
        impact 1.0
        tag cis: 'azure:5.2.1'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Create Policy Assignment event.

          Monitoring for create policy assignment events gives insight into changes
          done in "Azure policy - assignments" and can reduce the time it takes to
          detect unsolicited changes.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Authorization/policyAssignments/write') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1603
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Authorization/policyAssignments/write"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002251823
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.2
    :title: Ensure that Activity Log Alert exists for Delete Policy Assignment
    :desc: |-
      Create an activity log alert for the Delete Policy Assignment event.

      Monitoring for delete policy assignment events gives insight into changes
      done in "azure policy - assignments" and can reduce the time it takes to detect unsolicited changes.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Delete Policy Assignment event.

        Monitoring for delete policy assignment events gives insight into changes
        done in "azure policy - assignments" and can reduce the time it takes to detect unsolicited changes.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.2
      :level: 1
    :code: |
      control '5.2.2' do
        title 'Ensure that Activity Log Alert exists for Delete Policy Assignment'
        impact 1.0
        tag cis: 'azure:5.2.2'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Delete Policy Assignment event.

          Monitoring for delete policy assignment events gives insight into changes
          done in "azure policy - assignments" and can reduce the time it takes to detect unsolicited changes.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Authorization/policyAssignments/delete') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1648
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Authorization/policyAssignments/delete"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002446668
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.3
    :title: Ensure that Activity Log Alert exists for Create or Update Network Security
      Group
    :desc: |-
      Create an Activity Log Alert for the Create or Update Network Security Group event.

      Monitoring for Create or Update Network Security Group events gives insight into
      network access changes and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an Activity Log Alert for the Create or Update Network Security Group event.

        Monitoring for Create or Update Network Security Group events gives insight into
        network access changes and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.3
      :level: 1
    :code: |
      control '5.2.3' do
        title 'Ensure that Activity Log Alert exists for Create or Update Network Security Group'
        impact 1.0
        tag cis: 'azure:5.2.3'
        tag level: 1
        desc <<-DESC
          Create an Activity Log Alert for the Create or Update Network Security Group event.

          Monitoring for Create or Update Network Security Group events gives insight into
          network access changes and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Network/networkSecurityGroups/write') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1692
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts  Microsoft.Insights/activityLogAlerts
        with operations include? "Microsoft.Network/networkSecurityGroups/write" location
        include? "Global" '
      :run_time: 7.0062e-05
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: Resource is failed due to Connection reset by peer. Error backtrace:/opt/inspec/embedded/lib/ruby/3.1.0/openssl/buffering.rb:214:in
        `sysread_nonblock' /opt/inspec/embedded/lib/ruby/3.1.0/openssl/buffering.rb:214:in
        `read_nonblock' /opt/inspec/embedded/lib/ruby/3.1.0/net/protocol.rb:212:in
        `rbuf_fill' /opt/inspec/embedded/lib/ruby/3.1.0/net/protocol.rb:193:in `readuntil'
        /opt/inspec/embedded/lib/ruby/3.1.0/net/protocol.rb:203:in `readline' /opt/inspec/embedded/lib/ruby/3.1.0/net/http/response.rb:42:in
        `read_status_line' /opt/inspec/embedded/lib/ruby/3.1.0/net/http/response.rb:31:in
        `read_new' /opt/inspec/embedded/lib/ruby/3.1.0/net/http.rb:1575:in `block
        in transport_request' /opt/inspec/embedded/lib/ruby/3.1.0/net/http.rb:1566:in
        `catch' /opt/inspec/embedded/lib/ruby/3.1.0/net/http.rb:1566:in `transport_request'
        /opt/inspec/embedded/lib/ruby/3.1.0/net/http.rb:1539:in `request' /opt/inspec/embedded/lib/ruby/3.1.0/net/http.rb:1288:in
        `get' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-net_http-1.0.1/lib/faraday/adapter/net_http.rb:139:in
        `block in request_via_get_method' /opt/inspec/embedded/lib/ruby/3.1.0/net/http.rb:966:in
        `start' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-net_http-1.0.1/lib/faraday/adapter/net_http.rb:138:in
        `request_via_get_method' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-net_http-1.0.1/lib/faraday/adapter/net_http.rb:129:in
        `request_with_wrapped_block' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-net_http-1.0.1/lib/faraday/adapter/net_http.rb:122:in
        `perform_request' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-net_http-1.0.1/lib/faraday/adapter/net_http.rb:66:in
        `block in call' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-1.10.3/lib/faraday/adapter.rb:50:in
        `connection' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-net_http-1.0.1/lib/faraday/adapter/net_http.rb:64:in
        `call' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday_middleware-1.0.0/lib/faraday_middleware/response_middleware.rb:36:in
        `call' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-retry-1.0.3/lib/faraday/retry/middleware.rb:140:in
        `call' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-1.10.3/lib/faraday/rack_builder.rb:154:in
        `build_response' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-1.10.3/lib/faraday/connection.rb:516:in
        `run_request' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/faraday-1.10.3/lib/faraday/connection.rb:202:in
        `get' libraries/backend/azure_connection.rb:229:in `send_request' libraries/backend/azure_connection.rb:126:in
        `rest_api_call' libraries/azure_backend.rb:156:in `rescue_wrong_api_call'
        libraries/azure_backend.rb:276:in `get_resource' libraries/azure_generic_resources.rb:167:in
        `block in collect_resources' libraries/azure_backend.rb:460:in `catch_failed_resource_queries'
        libraries/azure_generic_resources.rb:166:in `collect_resources' libraries/azure_generic_resources.rb:40:in
        `initialize' libraries/azure_monitor_activity_log_alerts.rb:21:in `initialize'
        /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/resource.rb:127:in
        `block in initialize' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/resource.rb:60:in
        `supersuper_initialize' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/resource.rb:125:in
        `initialize' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile_context.rb:256:in
        `new' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile_context.rb:256:in
        `block (2 levels) in add_registry_methods' controls/translated-controls.rb:1706:in
        `block in load_with_context' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/rule.rb:49:in
        `instance_eval' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/rule.rb:49:in
        `initialize' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/control_eval_context.rb:58:in
        `new' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/control_eval_context.rb:58:in
        `control' controls/translated-controls.rb:1692:in `load_with_context' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile_context.rb:171:in
        `instance_eval' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile_context.rb:171:in
        `load_with_context' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile_context.rb:155:in
        `load_control_file' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile.rb:275:in
        `block in collect_tests' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile.rb:270:in
        `each' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/profile.rb:270:in
        `collect_tests' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:126:in
        `block in load' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:107:in
        `each' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:107:in
        `load' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:177:in
        `run' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:410:in
        `block in exec' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature/runner.rb:21:in
        `with_feature' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature.rb:6:in
        `with_feature' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:395:in
        `exec' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/command.rb:27:in
        `run' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in
        `invoke_command' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor.rb:392:in
        `dispatch' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/base.rb:485:in
        `start' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/base_cli.rb:40:in
        `start' /opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-bin-6.6.0/bin/inspec:11:in
        `<top (required)>' /usr/bin/inspec:280:in `load' /usr/bin/inspec:280:in `<main>'
      :exception: Inspec::Exceptions::ResourceFailed
      :backtrace:
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:366:in
        `block (2 levels) in rspec_failed_block'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:263:in
        `instance_exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:263:in
        `block in run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:511:in
        `block in with_around_and_singleton_context_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:468:in
        `block in with_around_example_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:486:in
        `block in run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:624:in
        `run_around_example_hooks_for'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/hooks.rb:486:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:468:in
        `with_around_example_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:511:in
        `with_around_and_singleton_context_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example.rb:259:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:646:in
        `block in run_examples'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:642:in
        `map'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:642:in
        `run_examples'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/example_group.rb:607:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `block (3 levels) in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `map'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:121:in
        `block (2 levels) in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/configuration.rb:2070:in
        `with_suite_hooks'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:116:in
        `block in run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/reporter.rb:74:in
        `report'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/rspec-core-3.12.2/lib/rspec/core/runner.rb:115:in
        `run_specs'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner_rspec.rb:97:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:222:in
        `run_tests'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/runner.rb:178:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:410:in
        `block in exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature/runner.rb:21:in
        `with_feature'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/feature.rb:6:in
        `with_feature'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/cli.rb:395:in
        `exec'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/command.rb:27:in
        `run'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/invocation.rb:127:in
        `invoke_command'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor.rb:392:in
        `dispatch'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/thor-1.2.2/lib/thor/base.rb:485:in
        `start'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-core-6.6.0/lib/inspec/base_cli.rb:40:in
        `start'"
      - "/opt/inspec/embedded/lib/ruby/gems/3.1.0/gems/inspec-bin-6.6.0/bin/inspec:11:in
        `<top (required)>'"
      - "/usr/bin/inspec:280:in `load'"
      - "/usr/bin/inspec:280:in `<main>'"
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.4
    :title: Ensure that Activity Log Alert exists for Delete Network Security Group
    :desc: |-
      Create an activity log alert for the Delete Network Security Group event.

      Monitoring for "Delete Network Security Group" events gives insight into
      network access changes and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Delete Network Security Group event.

        Monitoring for "Delete Network Security Group" events gives insight into
        network access changes and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.4
      :level: 1
    :code: |
      control '5.2.4' do
        title 'Ensure that Activity Log Alert exists for Delete Network Security Group'
        impact 1.0
        tag cis: 'azure:5.2.4'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Delete Network Security Group event.

          Monitoring for "Delete Network Security Group" events gives insight into
          network access changes and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Network/networkSecurityGroups/delete') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1736
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Network/networkSecurityGroups/delete"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002170759
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.5
    :title: Ensure that Activity Log Alert exists for Create or Update Security Solution
    :desc: |-
      Create an activity log alert for the Create or Update Security Solution event.

      Monitoring for Create or Update Security Solution events gives insight into
      changes to the active security solutions and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Create or Update Security Solution event.

        Monitoring for Create or Update Security Solution events gives insight into
        changes to the active security solutions and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.5
      :level: 1
    :code: |
      control '5.2.5' do
        title 'Ensure that Activity Log Alert exists for Create or Update Security Solution'
        impact 1.0
        tag cis: 'azure:5.2.5'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Create or Update Security Solution event.

          Monitoring for Create or Update Security Solution events gives insight into
          changes to the active security solutions and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Security/securitySolutions/write') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1780
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Security/securitySolutions/write"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002185423
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.6
    :title: Ensure that Activity Log Alert exists for Create or Update Security Solution
    :desc: |-
      Create an activity log alert for the Delete Security Solution event.

      Monitoring for Delete Security Solution events gives insight into
      changes to the active security solutions and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Delete Security Solution event.

        Monitoring for Delete Security Solution events gives insight into
        changes to the active security solutions and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.6
      :level: 1
    :code: |
      control '5.2.6' do
        title 'Ensure that Activity Log Alert exists for Create or Update Security Solution'
        impact 1.0
        tag cis: 'azure:5.2.6'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Delete Security Solution event.

          Monitoring for Delete Security Solution events gives insight into
          changes to the active security solutions and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Security/securitySolutions/delete') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1824
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Security/securitySolutions/delete"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.00354543
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.7
    :title: Ensure that Activity Log Alert exists for Create or Update SQL Server
      Firewall Rule
    :desc: |-
      Create an activity log alert for the Create or Update SQL Server Firewall Rule event.

      Monitoring for Create or Update SQL Server Firewall Rule events gives insight into
      network access changes and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Create or Update SQL Server Firewall Rule event.

        Monitoring for Create or Update SQL Server Firewall Rule events gives insight into
        network access changes and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.7
      :level: 1
    :code: |
      control '5.2.7' do
        title 'Ensure that Activity Log Alert exists for Create or Update SQL Server Firewall Rule'
        impact 1.0
        tag cis: 'azure:5.2.7'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Create or Update SQL Server Firewall Rule event.

          Monitoring for Create or Update SQL Server Firewall Rule events gives insight into
          network access changes and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Sql/servers/firewallRules/write') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1868
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Sql/servers/firewallRules/write"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002219031
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.8
    :title: Ensure that Activity Log Alert exists for Delete SQL Server Firewall Rule
    :desc: |-
      Create an activity log alert for the "Delete SQL Server Firewall Rule."

      Monitoring for Delete SQL Server Firewall Rule events gives insight into
      SQL network access changes and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the "Delete SQL Server Firewall Rule."

        Monitoring for Delete SQL Server Firewall Rule events gives insight into
        SQL network access changes and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.8
      :level: 1
    :code: |
      control '5.2.8' do
        title 'Ensure that Activity Log Alert exists for Delete SQL Server Firewall Rule'
        impact 1.0
        tag cis: 'azure:5.2.8'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the "Delete SQL Server Firewall Rule."

          Monitoring for Delete SQL Server Firewall Rule events gives insight into
          SQL network access changes and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Sql/servers/firewallRules/delete') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1912
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Sql/servers/firewallRules/delete"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002198752
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.9
    :title: Ensure that Activity Log Alert exists for Create or Update Public IP Address
      rule
    :desc: |-
      Create an activity log alert for the Create or Update Public IP Addresses rule.

      Monitoring for Create or Update Public IP Address events gives insight into
      network access changes and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Create or Update Public IP Addresses rule.

        Monitoring for Create or Update Public IP Address events gives insight into
        network access changes and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.9
      :level: 1
    :code: |
      control '5.2.9' do
        title 'Ensure that Activity Log Alert exists for Create or Update Public IP Address rule'
        impact 1.0
        tag cis: 'azure:5.2.9'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Create or Update Public IP Addresses rule.

          Monitoring for Create or Update Public IP Address events gives insight into
          network access changes and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Network/publicIPAddresses/write') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 1956
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Network/publicIPAddresses/write"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002245229
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: 5.2.10
    :title: Ensure that Activity Log Alert exists for Delete Public IP Address rule
    :desc: |-
      Create an activity log alert for the Delete Public IP Address rule.

      Monitoring for Delete Public IP Address events gives insight into
      network access changes and may reduce the time it takes to detect suspicious activity.
    :descriptions:
    - :label: default
      :data: |-
        Create an activity log alert for the Delete Public IP Address rule.

        Monitoring for Delete Public IP Address events gives insight into
        network access changes and may reduce the time it takes to detect suspicious activity.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.2.10
      :level: 1
    :code: |
      control '5.2.10' do
        title 'Ensure that Activity Log Alert exists for Delete Public IP Address rule'
        impact 1.0
        tag cis: 'azure:5.2.10'
        tag level: 1
        desc <<-DESC
          Create an activity log alert for the Delete Public IP Address rule.

          Monitoring for Delete Public IP Address events gives insight into
          network access changes and may reduce the time it takes to detect suspicious activity.
        DESC

        required_scope = "/subscriptions/#{azure_subscription.id}"

        alerts = azure_monitor_activity_log_alerts
                   .where { operations.include?('Microsoft.Network/publicIPAddresses/delete') }
                   .where { location.include?('Global') }

        describe alerts do
          its('entries') { should_not be_empty }
        end

        describe.one do
          alerts.entries.each do |a|
            alert  = azure_monitor_activity_log_alert(resource_group: a.resource_group, name: a.name)
            # Scope can either have a trailing slash or not and be compliant.
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope}
            end
            describe alert do
              it            { should exist }
              it            { should be_enabled }
              its('properties.condition.allOf.to_s') { should_not include "field=>\"level\""}
              its('properties.condition.allOf.to_s') { should_not include "field=>\"status\""}
              its('scopes.to_s') { should include required_scope+"/"}
            end
          end
        end
      end
    :source_location:
      :line: 2000
      :ref: controls/translated-controls.rb
    :waiver_data:
      expiration_date: 2024-06-24
      justification: Under review by security team
      run: true
      skipped_due_to_waiver: false
      message: ''
    :results:
    - :status: failed
      :code_desc: 'Azure Monitor Activity Log Alerts - api_version: 2020-10-01 latest
        Microsoft.Insights/activityLogAlerts with operations include? "Microsoft.Network/publicIPAddresses/delete"
        location include? "Global" entries is expected not to be empty'
      :run_time: 0.002176041
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: expected `[].empty?` to be falsey, got true
      :resource_class: FilterTable::Table
      :resource_params: "[]"
      :resource_id: ''
  - :id: '5.3'
    :title: Ensure that Azure Monitor Resource Logging is Enabled for All Services
      that Support it
    :desc: "Resource Logs capture activity to the data access plane while the Activity
      log is a\nsubscription-level log for the control plane. Resource-level diagnostic
      logs provide\ninsight into operations that were performed within that resource
      itself; for example,\nreading or updating a secret from a Key Vault. Currently,
      95 Azure resources support\nAzure Monitoring (See the more information section
      for a complete list), including\nNetwork Security Groups, Load Balancers, Key
      Vault, AD, Logic Apps, and CosmosDB.\nThe content of these logs varies by resource
      type.\n\nA number of back-end services were not configured to log and store
      Resource Logs for\ncertain activities or for a sufficient length. It is crucial
      that monitoring is correctly\nconfigured to log all relevant activities and
      retain those logs for a sufficient length\nof time. Given that the mean time
      to detection in an enterprise is 240 days, a minimum\nretention period of two
      years is recommended.\n\nA lack of monitoring reduces the visibility into the
      data plane, and therefore an\norganization's ability to detect reconnaissance,
      authorization attempts or other malicious\nactivity. Unlike Activity Logs, Resource
      Logs are not enabled by default. Specifically,\nwithout monitoring it would
      be impossible to tell which entities had accessed a data store \nhat was breached.
      In addition, alerts for failed attempts to access APIs for Web Services or\nDatabases
      are only possible when logging is enabled."
    :descriptions:
    - :label: default
      :data: "Resource Logs capture activity to the data access plane while the Activity
        log is a\nsubscription-level log for the control plane. Resource-level diagnostic
        logs provide\ninsight into operations that were performed within that resource
        itself; for example,\nreading or updating a secret from a Key Vault. Currently,
        95 Azure resources support\nAzure Monitoring (See the more information section
        for a complete list), including\nNetwork Security Groups, Load Balancers,
        Key Vault, AD, Logic Apps, and CosmosDB.\nThe content of these logs varies
        by resource type.\n\nA number of back-end services were not configured to
        log and store Resource Logs for\ncertain activities or for a sufficient length.
        It is crucial that monitoring is correctly\nconfigured to log all relevant
        activities and retain those logs for a sufficient length\nof time. Given that
        the mean time to detection in an enterprise is 240 days, a minimum\nretention
        period of two years is recommended.\n\nA lack of monitoring reduces the visibility
        into the data plane, and therefore an\norganization's ability to detect reconnaissance,
        authorization attempts or other malicious\nactivity. Unlike Activity Logs,
        Resource Logs are not enabled by default. Specifically,\nwithout monitoring
        it would be impossible to tell which entities had accessed a data store \nhat
        was breached. In addition, alerts for failed attempts to access APIs for Web
        Services or\nDatabases are only possible when logging is enabled."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:5.3
      :level: 1
    :code: "control '5.3' do\n  title 'Ensure that Azure Monitor Resource Logging
      is Enabled for All Services that Support it'\n  impact 1.0\n  tag cis: 'azure:5.3'\n
      \ tag level: 1\n  desc <<-DESC\n    Resource Logs capture activity to the data
      access plane while the Activity log is a\n    subscription-level log for the
      control plane. Resource-level diagnostic logs provide\n    insight into operations
      that were performed within that resource itself; for example,\n    reading or
      updating a secret from a Key Vault. Currently, 95 Azure resources support\n
      \   Azure Monitoring (See the more information section for a complete list),
      including\n    Network Security Groups, Load Balancers, Key Vault, AD, Logic
      Apps, and CosmosDB.\n    The content of these logs varies by resource type.\n\n
      \   A number of back-end services were not configured to log and store Resource
      Logs for\n    certain activities or for a sufficient length. It is crucial that
      monitoring is correctly\n    configured to log all relevant activities and retain
      those logs for a sufficient length\n    of time. Given that the mean time to
      detection in an enterprise is 240 days, a minimum\n    retention period of two
      years is recommended.\n\n    A lack of monitoring reduces the visibility into
      the data plane, and therefore an\n    organization's ability to detect reconnaissance,
      authorization attempts or other malicious\n    activity. Unlike Activity Logs,
      Resource Logs are not enabled by default. Specifically,\n    without monitoring
      it would be impossible to tell which entities had accessed a data store \n    hat
      was breached. In addition, alerts for failed attempts to access APIs for Web
      Services or\n    Databases are only possible when logging is enabled.\n  DESC\n\n
      \ describe 'Manual check' do\n    skip('There is no automatic check for this
      control.\n    To ensure that Azure Monitor Resource Logging is Enabled for All
      Services that Support it:\n    The specific steps for configuring resources
      within the Azure console vary depending on\n    resource, but typically the
      steps are:\n\n    From Azure Portal,\n    1. Go to the resource\n    2. Click
      on Diagnostic settings\n    3. In the blade that appears, click \"Add diagnostic
      setting\"\n    4. Configure the diagnostic settings\n    5. Click on Save')\n
      \ end\nend\n"
    :source_location:
      :line: 2044
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 5.601e-06
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control.
            To ensure that Azure Monitor Resource Logging is Enabled for All Services that Support it:
            The specific steps for configuring resources within the Azure console vary depending on
            resource, but typically the steps are:

            From Azure Portal,
            1. Go to the resource
            2. Click on Diagnostic settings
            3. In the blade that appears, click "Add diagnostic setting"
            4. Configure the diagnostic settings
            5. Click on Save
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: '6.1'
    :title: Ensure that RDP access from the Internet is evaluated and restricted
    :desc: |-
      Network security groups should be periodically evaluated for port misconfigurations.
      Where certain ports and protocols may be exposed to the Internet, they should be evaluated
      for necessity and restricted wherever they are not explicitly required.

      Rationale: The potential security problem with using RDP over the Internet is that attackers
      can use various brute force techniques to gain access to Azure Virtual Machines. Once the
      attackers gain access, they can use a virtual machine as a launch point for compromising
      other machines on an Azure Virtual Network or even attack networked devices outside of Azure.
    :descriptions:
    - :label: default
      :data: |-
        Network security groups should be periodically evaluated for port misconfigurations.
        Where certain ports and protocols may be exposed to the Internet, they should be evaluated
        for necessity and restricted wherever they are not explicitly required.

        Rationale: The potential security problem with using RDP over the Internet is that attackers
        can use various brute force techniques to gain access to Azure Virtual Machines. Once the
        attackers gain access, they can use a virtual machine as a launch point for compromising
        other machines on an Azure Virtual Network or even attack networked devices outside of Azure.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:6.1
      :level: 1
    :code: |
      control '6.1' do
        title 'Ensure that RDP access from the Internet is evaluated and restricted'
        impact 1.0
        tag cis: 'azure:6.1'
        tag level: 1
        desc <<-DESC
          Network security groups should be periodically evaluated for port misconfigurations.
          Where certain ports and protocols may be exposed to the Internet, they should be evaluated
          for necessity and restricted wherever they are not explicitly required.

          Rationale: The potential security problem with using RDP over the Internet is that attackers
          can use various brute force techniques to gain access to Azure Virtual Machines. Once the
          attackers gain access, they can use a virtual machine as a launch point for compromising
          other machines on an Azure Virtual Network or even attack networked devices outside of Azure.
        DESC
        network_security_groups.each do |res_gp,network_security_groups_names|
          network_security_groups_names.each do | nsg_hash |
            nsg_hash.keys.each do | nsg_name |
              nsg = nsg_hash[nsg_name]
              describe nsg do
                it { should_not allow_rdp_from_internet }
              end
            end
          end
        end
      end
    :source_location:
      :line: 2087
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '6.2'
    :title: Ensure that SSH access from the Internet is evaluated and restricted
    :desc: |-
      Network security groups should be periodically evaluated for port misconfigurations.
      Where certain ports and protocols may be exposed to the Internet, they should be
      evaluated for necessity and restricted wherever they are not explicitly required.

      Rationale: The potential security problem with using SSH over the Internet
      is that attackers can use various brute force techniques to gain access to
      Azure Virtual Machines. Once the attackers gain access, they can use a virtual
      machine as a launch point for compromising other machines on the Azure Virtual
      Network or even attack networked devices outside of Azure.
    :descriptions:
    - :label: default
      :data: |-
        Network security groups should be periodically evaluated for port misconfigurations.
        Where certain ports and protocols may be exposed to the Internet, they should be
        evaluated for necessity and restricted wherever they are not explicitly required.

        Rationale: The potential security problem with using SSH over the Internet
        is that attackers can use various brute force techniques to gain access to
        Azure Virtual Machines. Once the attackers gain access, they can use a virtual
        machine as a launch point for compromising other machines on the Azure Virtual
        Network or even attack networked devices outside of Azure.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:6.2
      :level: 1
    :code: |
      control '6.2' do
        title 'Ensure that SSH access from the Internet is evaluated and restricted'
        impact 1.0
        tag cis: 'azure:6.2'
        tag level: 1
        desc <<-DESC
          Network security groups should be periodically evaluated for port misconfigurations.
          Where certain ports and protocols may be exposed to the Internet, they should be
          evaluated for necessity and restricted wherever they are not explicitly required.

          Rationale: The potential security problem with using SSH over the Internet
          is that attackers can use various brute force techniques to gain access to
          Azure Virtual Machines. Once the attackers gain access, they can use a virtual
          machine as a launch point for compromising other machines on the Azure Virtual
          Network or even attack networked devices outside of Azure.
        DESC
        network_security_groups.each do |res_gp,network_security_groups_names|
          network_security_groups_names.each do | nsg_hash |
            nsg_hash.keys.each do | nsg_name |
              nsg = nsg_hash[nsg_name]
              describe nsg do
                it { should_not allow_ssh_from_internet }
              end
            end
          end
        end
      end
    :source_location:
      :line: 2114
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '6.3'
    :title: Ensure that UDP access from the Internet is evaluated and restricted
    :desc: |-
      Network security groups should be periodically evaluated for port misconfigurations.
      Where certain ports and protocols may be exposed to the Internet, they should be evaluated
      for necessity and restricted wherever they are not explicitly required.
    :descriptions:
    - :label: default
      :data: |-
        Network security groups should be periodically evaluated for port misconfigurations.
        Where certain ports and protocols may be exposed to the Internet, they should be evaluated
        for necessity and restricted wherever they are not explicitly required.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:6.3
      :level: 1
    :code: |
      control '6.3' do
        title 'Ensure that UDP access from the Internet is evaluated and restricted'
        impact 1.0
        tag cis: 'azure:6.3'
        tag level: 1
        desc <<-DESC
          Network security groups should be periodically evaluated for port misconfigurations.
          Where certain ports and protocols may be exposed to the Internet, they should be evaluated
          for necessity and restricted wherever they are not explicitly required.
        DESC

        network_security_groups.each do |res_gp,network_security_groups_names|
          network_security_groups_names.each do | nsg_hash |
            nsg_hash.keys.each do | nsg_name |
              nsg = nsg_hash[nsg_name]
              describe nsg do
                it { should_not allow_udp_from_internet }
              end
            end
          end
        end
      end
    :source_location:
      :line: 2142
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '6.4'
    :title: Ensure that HTTP(S) access from the Internet is evaluated and restricted
    :desc: |-
      Network security groups should be periodically evaluated for port misconfigurations.
      Where certain ports and protocols may be exposed to the Internet, they should be evaluated
      for necessity and restricted wherever they are not explicitly required and narrowly configured.
    :descriptions:
    - :label: default
      :data: |-
        Network security groups should be periodically evaluated for port misconfigurations.
        Where certain ports and protocols may be exposed to the Internet, they should be evaluated
        for necessity and restricted wherever they are not explicitly required and narrowly configured.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:6.4
      :level: 1
    :code: |
      control '6.4' do
        title 'Ensure that HTTP(S) access from the Internet is evaluated and restricted'
        impact 1.0
        tag cis: 'azure:6.4'
        tag level: 1
        desc <<-DESC
          Network security groups should be periodically evaluated for port misconfigurations.
          Where certain ports and protocols may be exposed to the Internet, they should be evaluated
          for necessity and restricted wherever they are not explicitly required and narrowly configured.
        DESC

        network_security_groups.each do |res_gp,network_security_groups_names|
          network_security_groups_names.each do | nsg_hash |
            nsg_hash.keys.each do | nsg_name |
              nsg = nsg_hash[nsg_name]
              describe nsg do
                it { should_not allow_http_from_internet }
              end
            end
          end
        end
      end
    :source_location:
      :line: 2165
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '6.7'
    :title: Ensure that Public IP addresses are Evaluated on a Periodic Basis
    :desc: |-
      Public IP Addresses provide tenant accounts with Internet connectivity for resources
      contained within the tenant. During the creation of certain resources in Azure, a Public
      IP Address may be created. All Public IP Addresses within the tenant should be periodically
      reviewed for accuracy and necessity.

      Public IP Addresses allocated to the tenant should be periodically reviewed for necessity.
      Public IP Addresses that are not intentionally assigned and controlled present a publicly
      facing vector for threat actors and significant risk to the tenant.
    :descriptions:
    - :label: default
      :data: |-
        Public IP Addresses provide tenant accounts with Internet connectivity for resources
        contained within the tenant. During the creation of certain resources in Azure, a Public
        IP Address may be created. All Public IP Addresses within the tenant should be periodically
        reviewed for accuracy and necessity.

        Public IP Addresses allocated to the tenant should be periodically reviewed for necessity.
        Public IP Addresses that are not intentionally assigned and controlled present a publicly
        facing vector for threat actors and significant risk to the tenant.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:6.7
      :level: 1
    :code: |
      control '6.7' do
        title 'Ensure that Public IP addresses are Evaluated on a Periodic Basis'
        impact 1.0
        tag cis: 'azure:6.7'
        tag level: 1
        desc <<-DESC
          Public IP Addresses provide tenant accounts with Internet connectivity for resources
          contained within the tenant. During the creation of certain resources in Azure, a Public
          IP Address may be created. All Public IP Addresses within the tenant should be periodically
          reviewed for accuracy and necessity.

          Public IP Addresses allocated to the tenant should be periodically reviewed for necessity.
          Public IP Addresses that are not intentionally assigned and controlled present a publicly
          facing vector for threat actors and significant risk to the tenant.
        DESC

        describe 'Manual check' do
          skip('There is no automatic check for this control.
          To ensure that Public IP addresses are Evaluated on a Periodic Basis:
          From Azure Portal,
          1. Open the All Resources blade:
          2. Click on Add Filter
          3. In the Add Filter window, select the following: Filter: Type Operator: Equals Value: Public IP address
          4. Click the Apply button
          5. For each Public IP address in the list, use Overview (or Properties) to review the
          "Associated to:" field and determine if the associated resource is still relevant to your tenant environment.
          If the associated resource is relevant, ensure that additional controls exist to mitigate
          risk (e.g. Firewalls, VPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.)
          on all subsequently attached resources.')
        end
      end
    :source_location:
      :line: 2188
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: Manual check
      :run_time: 4.1e-06
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource: ''
      :skip_message: |-
        There is no automatic check for this control.
            To ensure that Public IP addresses are Evaluated on a Periodic Basis:
            From Azure Portal,
            1. Open the All Resources blade:
            2. Click on Add Filter
            3. In the Add Filter window, select the following: Filter: Type Operator: Equals Value: Public IP address
            4. Click the Apply button
            5. For each Public IP address in the list, use Overview (or Properties) to review the
            "Associated to:" field and determine if the associated resource is still relevant to your tenant environment.
            If the associated resource is relevant, ensure that additional controls exist to mitigate
            risk (e.g. Firewalls, VPNs, Traffic Filtering, Virtual Gateway Appliances, Web Application Firewalls, etc.)
            on all subsequently attached resources.
      :resource_class: Object
      :resource_params: "[]"
      :resource_id: Manual check
  - :id: '7.1'
    :title: Ensure Virtual Machines are utilizing Managed Disks
    :desc: "Migrate blob-based VHDs to Managed Disks on Virtual Machines to exploit
      the default features of this configuration. The features include:\n1. Default
      Disk Encryption\n2. Resilience, as Microsoft will managed the disk storage and
      move around if underlying hardware goes faulty\n3. Reduction of costs over storage
      accounts\nRationale statement: Managed disks are by default encrypted on the
      underlying hardware, so no additional encryption is required \nfor basic protection.
      It is available if additional encryption is required. Managed disks are by design
      more resilient that storage accounts."
    :descriptions:
    - :label: default
      :data: "Migrate blob-based VHDs to Managed Disks on Virtual Machines to exploit
        the default features of this configuration. The features include:\n1. Default
        Disk Encryption\n2. Resilience, as Microsoft will managed the disk storage
        and move around if underlying hardware goes faulty\n3. Reduction of costs
        over storage accounts\nRationale statement: Managed disks are by default encrypted
        on the underlying hardware, so no additional encryption is required \nfor
        basic protection. It is available if additional encryption is required. Managed
        disks are by design more resilient that storage accounts."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:7.1
      :level: 1
    :code: "control '7.1' do\n  title \"Ensure Virtual Machines are utilizing Managed
      Disks\"\n  impact 1.0\n  tag cis: 'azure:7.1'\n  tag level: 1\n  desc <<-DESC\n
      \   Migrate blob-based VHDs to Managed Disks on Virtual Machines to exploit
      the default features of this configuration. The features include:\n    1. Default
      Disk Encryption\n    2. Resilience, as Microsoft will managed the disk storage
      and move around if underlying hardware goes faulty\n    3. Reduction of costs
      over storage accounts\n    Rationale statement: Managed disks are by default
      encrypted on the underlying hardware, so no additional encryption is required
      \n    for basic protection. It is available if additional encryption is required.
      Managed disks are by design more resilient that storage accounts.\n\n  DESC\n\n
      \ resource_groups.each do |resource_group|\n    azure_virtual_machines(resource_group:
      resource_group).vm_names.each do |name|\n      describe azure_virtual_machine(resource_group:
      resource_group, name: name) do\n        its('properties.storageProfile.osDisk.managedDisk.id')
      { should_not be_empty }\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 2220
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '7.4'
    :title: Ensure that only approved extensions are installed
    :desc: |-
      Azure virtual machine extensions are small applications that provide
      post-deployment configuration and automation tasks on Azure virtual
      machines. These extensions run with administrative privileges and could
      potentially access anything on your virtual machine. Azure portal and
      community provide several such extensions. Your organization should
      carefully evaluate such extensions and ensure that only those that are
      approved for use are actually used.
    :descriptions:
    - :label: default
      :data: |-
        Azure virtual machine extensions are small applications that provide
        post-deployment configuration and automation tasks on Azure virtual
        machines. These extensions run with administrative privileges and could
        potentially access anything on your virtual machine. Azure portal and
        community provide several such extensions. Your organization should
        carefully evaluate such extensions and ensure that only those that are
        approved for use are actually used.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:7.4
      :level: 1
    :code: |
      control '7.4' do
        title 'Ensure that only approved extensions are installed'
        impact 1.0
        tag cis: 'azure:7.4'
        tag level: 1
        desc <<-DESC
          Azure virtual machine extensions are small applications that provide
          post-deployment configuration and automation tasks on Azure virtual
          machines. These extensions run with administrative privileges and could
          potentially access anything on your virtual machine. Azure portal and
          community provide several such extensions. Your organization should
          carefully evaluate such extensions and ensure that only those that are
          approved for use are actually used.
        DESC

        # This control will be skipped until you pass in a list of approved
        # extensions using the --attrs flag. If you are running from Automate you
        # will need to make a copy of this profile and add your approved extensions
        # to the attribute at the top of this file and setup your scans to run
        # against your copy of the profile.
        only_if('No Approved Extensions provided.') { approved_extensions_without_values.any? }

        resource_groups.each do |resource_group|
          azure_virtual_machines(resource_group: resource_group).vm_names.each do |name|
            describe azure_virtual_machine(resource_group: resource_group, name: name) do
              it { should have_only_approved_extensions(approved_extensions_without_values) }
            end
          end
        end
      end
    :source_location:
      :line: 2244
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: No-op
      :run_time: 3.956e-06
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource: No-op
      :skip_message: 'Skipped control due to only_if condition: No Approved Extensions
        provided.'
      :resource_class: noop
      :resource_params: "[]"
      :resource_id: No-op
  - :id: '8.1'
    :title: Ensure that the Expiration Date is set for all Keys in RBAC Key Vaults
    :desc: |-
      Ensure that all Keys in Role Based Access Control (RBAC) Azure Key Vaults have an expiration time set.

      Rationale: Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration time) attribute identifies the expiration time on or after which the key MUST NOT be used for encryption of new data, wrapping of new keys, and signing. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration time for all keys to help enforce the key rotation. This ensures that the keys cannot be used beyond their assigned lifetimes.
    :descriptions:
    - :label: default
      :data: |-
        Ensure that all Keys in Role Based Access Control (RBAC) Azure Key Vaults have an expiration time set.

        Rationale: Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration time) attribute identifies the expiration time on or after which the key MUST NOT be used for encryption of new data, wrapping of new keys, and signing. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration time for all keys to help enforce the key rotation. This ensures that the keys cannot be used beyond their assigned lifetimes.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:8.1
      :level: 1
    :code: |
      control '8.1' do
        title 'Ensure that the Expiration Date is set for all Keys in RBAC Key Vaults'
        impact 1.0
        tag cis: 'azure:8.1'
        tag level: 1
        desc <<-DESC
          Ensure that all Keys in Role Based Access Control (RBAC) Azure Key Vaults have an expiration time set.

          Rationale: Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration time) attribute identifies the expiration time on or after which the key MUST NOT be used for encryption of new data, wrapping of new keys, and signing. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration time for all keys to help enforce the key rotation. This ensures that the keys cannot be used beyond their assigned lifetimes.
        DESC

        key_vaults.each do | res_gp, key_vault |
          key_vault.each do |kv|
            enableRbacAuthorization = azure_key_vault(resource_group: res_gp, vault_name: kv).properties.enableRbacAuthorization
            if(enableRbacAuthorization) # only need to check Key Vaults with the EnableRbacAuthorizatoin setting set to True(in case of RBAC Key Vaults)
              azure_key_vault_keys(kv).entries.each do |key| #To access keys in a keyvault, a Permission model(from Access Configuration) should be selected. If the Permission model is 'Vault access policy'(in case of Non-RBAC Key Vaults), should create a policy with the Service Principal you are using or if the Permission model is 'Azure role based access control'(in case of RBAC Key Vaults), the service principal & your useraccount should have the role of KeyVault Administrator.
                describe key do
                  its('kid')            { should_not be_nil }
                  its('attributes.enabled')     { should cmp "true" }
                  its('attributes.exp') { should_not be_nil }
                end
              end
            end
          end
        end
      end
    :source_location:
      :line: 2275
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '8.2'
    :title: Ensure that the Expiration Date is set for all Keys in Non-RBAC Key Vaults.
    :desc: |-
      Ensure that all Keys in Non Role Based Access Control (RBAC) Azure Key Vaults have an expiration time set.

      Rationale: Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration time) attribute identifies the expiration time on or after which the key MUST NOT be used for a cryptographic operation. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration time for all keys. This ensures that the keys cannot be used beyond their assigned lifetimes.
    :descriptions:
    - :label: default
      :data: |-
        Ensure that all Keys in Non Role Based Access Control (RBAC) Azure Key Vaults have an expiration time set.

        Rationale: Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration time) attribute identifies the expiration time on or after which the key MUST NOT be used for a cryptographic operation. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration time for all keys. This ensures that the keys cannot be used beyond their assigned lifetimes.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:8.2
      :level: 1
    :code: |
      control '8.2' do
        title 'Ensure that the Expiration Date is set for all Keys in Non-RBAC Key Vaults.'
        impact 1.0
        tag cis: 'azure:8.2'
        tag level: 1
        desc <<-DESC
          Ensure that all Keys in Non Role Based Access Control (RBAC) Azure Key Vaults have an expiration time set.

          Rationale: Azure Key Vault enables users to store and use cryptographic keys within the Microsoft Azure environment. The exp (expiration time) attribute identifies the expiration time on or after which the key MUST NOT be used for a cryptographic operation. By default, keys never expire. It is thus recommended that keys be rotated in the key vault and set an explicit expiration time for all keys. This ensures that the keys cannot be used beyond their assigned lifetimes.
        DESC

        key_vaults.each do | res_gp, key_vault |
          key_vault.each do |kv|
            enableRbacAuthorization = azure_key_vault(resource_group: res_gp, vault_name: kv).properties.enableRbacAuthorization
            if(!enableRbacAuthorization) # only need to check Key Vaults with the EnableRbacAuthorizatoin setting set to False(in case of Non-RBAC Key Vaults)
              azure_key_vault_keys(kv).entries.each do |key| #To access keys in a keyvault, a Permission model(from Access Configuration) should be selected. If the Permission model is 'Vault access policy'(in case of Non-RBAC Key Vaults), should create a policy with the Service Principal you are using or if the Permission model is 'Azure role based access control'(in case of RBAC Key Vaults), the service principal & your useraccount should have the role of KeyVault Administrator.
                describe key do
                  its('kid')            { should_not be_nil }
                  its('attributes.enabled')     { should cmp "true" }
                  its('attributes.exp') { should_not be_nil }
                end
              end
            end
          end
        end
      end
    :source_location:
      :line: 2302
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '8.3'
    :title: Ensure that the Expiration Date is set for all Secrets in RBAC Key Vaults
    :desc: |-
      Ensure that all Secrets in Role Based Access Control (RBAC) Azure Key Vaults
      have an expiration time set.

      RATIONALE: The Azure Key Vault enables users to store and keep secrets within
      the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences
      with a maximum size of 25k bytes each. The exp (expiration time) attribute identifies
      the expiration time on or after which the secret MUST NOT be used. By default,
      secrets never expire. It is thus recommended to rotate secrets in the key vault
      and set an explicit expiration time for all secrets. This ensures that the secrets
      cannot be used beyond their assigned lifetimes.
    :descriptions:
    - :label: default
      :data: |-
        Ensure that all Secrets in Role Based Access Control (RBAC) Azure Key Vaults
        have an expiration time set.

        RATIONALE: The Azure Key Vault enables users to store and keep secrets within
        the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences
        with a maximum size of 25k bytes each. The exp (expiration time) attribute identifies
        the expiration time on or after which the secret MUST NOT be used. By default,
        secrets never expire. It is thus recommended to rotate secrets in the key vault
        and set an explicit expiration time for all secrets. This ensures that the secrets
        cannot be used beyond their assigned lifetimes.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:8.3
      :level: 1
    :code: |
      control '8.3' do
        title "Ensure that the Expiration Date is set for all Secrets in RBAC Key Vaults"
        impact 1.0
        tag cis: 'azure:8.3'
        tag level: 1
        desc <<-DESC
          Ensure that all Secrets in Role Based Access Control (RBAC) Azure Key Vaults
          have an expiration time set.

          RATIONALE: The Azure Key Vault enables users to store and keep secrets within
          the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences
          with a maximum size of 25k bytes each. The exp (expiration time) attribute identifies
          the expiration time on or after which the secret MUST NOT be used. By default,
          secrets never expire. It is thus recommended to rotate secrets in the key vault
          and set an explicit expiration time for all secrets. This ensures that the secrets
          cannot be used beyond their assigned lifetimes.
        DESC

        key_vaults.each do | res_gp, key_vault |
          key_vault.each do |kv|
            next unless azure_key_vault(resource_group: res_gp, name: kv).properties.enableRbacAuthorization == true
            azure_key_vault_secrets(vault_name: kv).ids.each do |secret_id|
              describe azure_key_vault_secret(secret_id:secret_id) do
                its('attributes.enabled') { should cmp true }
                its('attributes.exp') { should_not be_nil }
              end
            end
          end
        end
      end
    :source_location:
      :line: 2329
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '8.4'
    :title: Ensure that the Expiration Date is set for all Secrets in Non-RBAC Key
      Vaults
    :desc: |-
      Ensure that all Secrets in Non Role Based Access Control (RBAC) Azure Key Vaults
      have an expiration time set.

      RATIONALE: The Azure Key Vault enables users to store and keep secrets within
      the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences
      with a maximum size of 25k bytes each. The exp (expiration time) attribute identifies
      the expiration time on or after which the secret MUST NOT be used. By default,
      secrets never expire. It is thus recommended to rotate secrets in the key vault and
      set an explicit expiration time for all secrets. This ensures that the secrets cannot
      be used beyond their assigned lifetimes.
    :descriptions:
    - :label: default
      :data: |-
        Ensure that all Secrets in Non Role Based Access Control (RBAC) Azure Key Vaults
        have an expiration time set.

        RATIONALE: The Azure Key Vault enables users to store and keep secrets within
        the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences
        with a maximum size of 25k bytes each. The exp (expiration time) attribute identifies
        the expiration time on or after which the secret MUST NOT be used. By default,
        secrets never expire. It is thus recommended to rotate secrets in the key vault and
        set an explicit expiration time for all secrets. This ensures that the secrets cannot
        be used beyond their assigned lifetimes.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:8.4
      :level: 1
    :code: |
      control '8.4' do
        title "Ensure that the Expiration Date is set for all Secrets in Non-RBAC Key Vaults"
        impact 1.0
        tag cis: 'azure:8.4'
        tag level: 1
        desc <<-DESC
          Ensure that all Secrets in Non Role Based Access Control (RBAC) Azure Key Vaults
          have an expiration time set.

          RATIONALE: The Azure Key Vault enables users to store and keep secrets within
          the Microsoft Azure environment. Secrets in the Azure Key Vault are octet sequences
          with a maximum size of 25k bytes each. The exp (expiration time) attribute identifies
          the expiration time on or after which the secret MUST NOT be used. By default,
          secrets never expire. It is thus recommended to rotate secrets in the key vault and
          set an explicit expiration time for all secrets. This ensures that the secrets cannot
          be used beyond their assigned lifetimes.
        DESC

        key_vaults.each do | res_gp, key_vault |
          key_vault.each do |kv|
            next unless azure_key_vault(resource_group: res_gp, name: kv).properties.enableRbacAuthorization == false
            azure_key_vault_secrets(vault_name: kv).ids.each do |secret_id|
              describe azure_key_vault_secret(secret_id:secret_id) do
                its('attributes.enabled') { should cmp true }
                its('attributes.exp') { should_not be_nil }
              end
            end
          end
        end
      end
    :source_location:
      :line: 2360
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '8.5'
    :title: Ensure the Key Vault is Recoverable
    :desc: "The Key Vault contains object keys, secrets, and certificates. Accidental
      unavailability of a Key Vault can cause immediate data loss or loss of security
      functions (authentication, validation, verification, non-repudiation, etc.)
      supported by the Key Vault objects.\n\nIt is recommended the Key Vault be made
      recoverable by enabling the \"Do Not Purge\" and \"Soft Delete\" functions.
      This is in order to prevent loss of encrypted data, including storage accounts,
      SQL databases, and/or dependent services provided by Key Vault objects (Keys,
      Secrets, Certificates) etc. This may happen in the case of accidental deletion
      by a user or from disruptive activity by a malicious user.\n  \nWARNING: A current
      limitation of the soft-delete feature across all Azure services is role assignments
      disappearing when Key Vault is deleted. All role assignments will need to be
      recreated after recovery.\n\nRationale: There could be scenarios where users
      accidentally run delete/purge commands on Key Vault or an attacker/malicious
      user deliberately does so in order to cause disruption. Deleting or purging
      a Key Vault leads to immediate data loss, as keys encrypting data and secrets/certificates
      allowing access/services will become non-accessible. There are 2 Key Vault properties
      that play a role in permanent unavailability of a Key Vault:\n    \n    1. enableSoftDelete:\n
      \   Setting this parameter to \"true\" for a Key Vault ensures that even if
      Key Vault is deleted, Key Vault itself or its objects remain recoverable for
      the next 90 days. Key Vault/objects can either be recovered or purged (permanent
      deletion) during those 90 days. If no action is taken, key vault and its objects
      will subsequently be purged.\n\n    2. enablePurgeProtection:\n    enableSoftDelete
      only ensures that Key Vault is not deleted permanently and will be recoverable
      for 90 days from date of deletion. However, there are scenarios in which the
      Key Vault and/or its objects are accidentally purged and hence will not be recoverable.
      Setting enablePurgeProtection to \"true\" ensures that the Key Vault and its
      objects cannot be purged.\n\n    Enabling both the parameters on Key Vaults
      ensures that Key Vaults and their objects cannot be deleted/purged permanently."
    :descriptions:
    - :label: default
      :data: "The Key Vault contains object keys, secrets, and certificates. Accidental
        unavailability of a Key Vault can cause immediate data loss or loss of security
        functions (authentication, validation, verification, non-repudiation, etc.)
        supported by the Key Vault objects.\n\nIt is recommended the Key Vault be
        made recoverable by enabling the \"Do Not Purge\" and \"Soft Delete\" functions.
        This is in order to prevent loss of encrypted data, including storage accounts,
        SQL databases, and/or dependent services provided by Key Vault objects (Keys,
        Secrets, Certificates) etc. This may happen in the case of accidental deletion
        by a user or from disruptive activity by a malicious user.\n  \nWARNING: A
        current limitation of the soft-delete feature across all Azure services is
        role assignments disappearing when Key Vault is deleted. All role assignments
        will need to be recreated after recovery.\n\nRationale: There could be scenarios
        where users accidentally run delete/purge commands on Key Vault or an attacker/malicious
        user deliberately does so in order to cause disruption. Deleting or purging
        a Key Vault leads to immediate data loss, as keys encrypting data and secrets/certificates
        allowing access/services will become non-accessible. There are 2 Key Vault
        properties that play a role in permanent unavailability of a Key Vault:\n
        \   \n    1. enableSoftDelete:\n    Setting this parameter to \"true\" for
        a Key Vault ensures that even if Key Vault is deleted, Key Vault itself or
        its objects remain recoverable for the next 90 days. Key Vault/objects can
        either be recovered or purged (permanent deletion) during those 90 days. If
        no action is taken, key vault and its objects will subsequently be purged.\n\n
        \   2. enablePurgeProtection:\n    enableSoftDelete only ensures that Key
        Vault is not deleted permanently and will be recoverable for 90 days from
        date of deletion. However, there are scenarios in which the Key Vault and/or
        its objects are accidentally purged and hence will not be recoverable. Setting
        enablePurgeProtection to \"true\" ensures that the Key Vault and its objects
        cannot be purged.\n\n    Enabling both the parameters on Key Vaults ensures
        that Key Vaults and their objects cannot be deleted/purged permanently."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:8.5
      :level: 1
    :code: "control '8.5' do\n  title 'Ensure the Key Vault is Recoverable'\n  impact
      1.0\n  tag cis: 'azure:8.5'\n  tag level: 1\n  desc <<-DESC\n    The Key Vault
      contains object keys, secrets, and certificates. Accidental unavailability of
      a Key Vault can cause immediate data loss or loss of security functions (authentication,
      validation, verification, non-repudiation, etc.) supported by the Key Vault
      objects.\n\n    It is recommended the Key Vault be made recoverable by enabling
      the \"Do Not Purge\" and \"Soft Delete\" functions. This is in order to prevent
      loss of encrypted data, including storage accounts, SQL databases, and/or dependent
      services provided by Key Vault objects (Keys, Secrets, Certificates) etc. This
      may happen in the case of accidental deletion by a user or from disruptive activity
      by a malicious user.\n  \n    WARNING: A current limitation of the soft-delete
      feature across all Azure services is role assignments disappearing when Key
      Vault is deleted. All role assignments will need to be recreated after recovery.\n
      \   \n    Rationale: There could be scenarios where users accidentally run delete/purge
      commands on Key Vault or an attacker/malicious user deliberately does so in
      order to cause disruption. Deleting or purging a Key Vault leads to immediate
      data loss, as keys encrypting data and secrets/certificates allowing access/services
      will become non-accessible. There are 2 Key Vault properties that play a role
      in permanent unavailability of a Key Vault:\n        \n        1. enableSoftDelete:\n
      \       Setting this parameter to \"true\" for a Key Vault ensures that even
      if Key Vault is deleted, Key Vault itself or its objects remain recoverable
      for the next 90 days. Key Vault/objects can either be recovered or purged (permanent
      deletion) during those 90 days. If no action is taken, key vault and its objects
      will subsequently be purged.\n\n        2. enablePurgeProtection:\n        enableSoftDelete
      only ensures that Key Vault is not deleted permanently and will be recoverable
      for 90 days from date of deletion. However, there are scenarios in which the
      Key Vault and/or its objects are accidentally purged and hence will not be recoverable.
      Setting enablePurgeProtection to \"true\" ensures that the Key Vault and its
      objects cannot be purged.\n\n        Enabling both the parameters on Key Vaults
      ensures that Key Vaults and their objects cannot be deleted/purged permanently.\n
      \ DESC\n\n  key_vaults.each do | res_gp, key_vault |\n    key_vault.each do
      |kv|\n      describe azure_key_vault(resource_group: res_gp, vault_name: kv)
      do\n        its('properties')                       { is_expected.to respond_to(:enablePurgeProtection)
      }\n        its('properties.enablePurgeProtection') { should be true }\n        its('properties')
      \                      { is_expected.to respond_to(:enableSoftDelete) }\n        its('properties.enableSoftDelete')
      \     { should be true }\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 2391
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results: []
  - :id: '9.2'
    :title: Ensure Web App Redirects All HTTP traffic to HTTPS in Azure App Service
    :desc: |-
      Azure Web Apps allows sites to run under both HTTP and HTTPS by default. Web apps can be
      accessed by anyone using non-secure HTTP links by default. Non-secure HTTP requests can be
      restricted and all HTTP requests redirected to the secure HTTPS port. It is recommended to
      enforce HTTPS-only traffic.

      RATIONALE: Enabling HTTPS-only traffic will redirect all non-secure HTTP requests to
      HTTPS ports. HTTPS uses the TLS/SSL protocol to provide a secure connection which is both
      encrypted and authenticated. It is therefore important to support HTTPS for the security benefits.
    :descriptions:
    - :label: default
      :data: |-
        Azure Web Apps allows sites to run under both HTTP and HTTPS by default. Web apps can be
        accessed by anyone using non-secure HTTP links by default. Non-secure HTTP requests can be
        restricted and all HTTP requests redirected to the secure HTTPS port. It is recommended to
        enforce HTTPS-only traffic.

        RATIONALE: Enabling HTTPS-only traffic will redirect all non-secure HTTP requests to
        HTTPS ports. HTTPS uses the TLS/SSL protocol to provide a secure connection which is both
        encrypted and authenticated. It is therefore important to support HTTPS for the security benefits.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.2
      :level: 1
    :code: |
      control '9.2' do
        title 'Ensure Web App Redirects All HTTP traffic to HTTPS in Azure App Service'
        impact 1.0
        tag cis: 'azure:9.2'
        tag level: 1
        desc <<-DESC
          Azure Web Apps allows sites to run under both HTTP and HTTPS by default. Web apps can be
          accessed by anyone using non-secure HTTP links by default. Non-secure HTTP requests can be
          restricted and all HTTP requests redirected to the secure HTTPS port. It is recommended to
          enforce HTTPS-only traffic.

          RATIONALE: Enabling HTTPS-only traffic will redirect all non-secure HTTP requests to
          HTTPS ports. HTTPS uses the TLS/SSL protocol to provide a secure connection which is both
          encrypted and authenticated. It is therefore important to support HTTPS for the security benefits.
        DESC

        web_apps.each do | resource_group, webapp_list |
          webapp_list.each do |webapp|
            describe webapp do
              its('properties') { should have_attributes(httpsOnly: true) }
            end
          end
        end
      end
    :source_location:
      :line: 2426
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-autotag-creator-d9730719 properties is expected to
        have attributes {:httpsOnly => true}'
      :run_time: 0.000236238
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-autotag-creator-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-autotag-creator-d9730719"
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-set-default-ttl-d9730719 properties is expected to
        have attributes {:httpsOnly => true}'
      :run_time: 0.000143669
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-set-default-ttl-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-set-default-ttl-d9730719"
  - :id: '9.3'
    :title: Ensure Web App is using the latest version of TLS encryption
    :desc: |-
      The TLS (Transport Layer Security) protocol secures transmission of data over the internet
      using standard encryption technology. Encryption should be set with the latest version of TLS.
      App service allows TLS 1.2 by default, which is the recommended TLS level by
      industry standards such as PCI DSS.

      RATIONALE: App service currently allows the web app to set TLS versions 1.0, 1.1 and 1.2.
      It is highly recommended to use the latest TLS 1.2 version for web app secure connections.
    :descriptions:
    - :label: default
      :data: |-
        The TLS (Transport Layer Security) protocol secures transmission of data over the internet
        using standard encryption technology. Encryption should be set with the latest version of TLS.
        App service allows TLS 1.2 by default, which is the recommended TLS level by
        industry standards such as PCI DSS.

        RATIONALE: App service currently allows the web app to set TLS versions 1.0, 1.1 and 1.2.
        It is highly recommended to use the latest TLS 1.2 version for web app secure connections.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.3
      :level: 1
    :code: |
      control '9.3' do
        title 'Ensure Web App is using the latest version of TLS encryption'
        impact 1.0
        tag cis: 'azure:9.3'
        tag level: 1
        desc <<-DESC
          The TLS (Transport Layer Security) protocol secures transmission of data over the internet
          using standard encryption technology. Encryption should be set with the latest version of TLS.
          App service allows TLS 1.2 by default, which is the recommended TLS level by
          industry standards such as PCI DSS.

          RATIONALE: App service currently allows the web app to set TLS versions 1.0, 1.1 and 1.2.
          It is highly recommended to use the latest TLS 1.2 version for web app secure connections.
        DESC

        web_apps.each do | resource_group, webapp_list |
          webapp_list.each do |webapp|
            describe webapp do
              its('configuration.properties.minTlsVersion') { should cmp >= 1.2 }
            end
          end
        end
      end
    :source_location:
      :line: 2451
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-autotag-creator-d9730719 configuration.properties.minTlsVersion
        is expected to cmp >= 1.2'
      :run_time: 0.00020959
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-autotag-creator-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-autotag-creator-d9730719"
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-set-default-ttl-d9730719 configuration.properties.minTlsVersion
        is expected to cmp >= 1.2'
      :run_time: 0.000148537
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-set-default-ttl-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-set-default-ttl-d9730719"
  - :id: '9.5'
    :title: Ensure that Register with Azure Active Directory is enabled on App Service
    :desc: |-
      Managed service identity in App Service provides more security by eliminating secrets
      from the app, such as credentials in the connection strings. When registering with
      Azure Active Directory in App Service, the app will connect to other Azure services
      securely without the need for usernames and passwords.

      RATIONALE: App Service provides a highly scalable, self-patching web hosting service
      in Azure. It also provides a managed identity for apps, which is a turn-key solution
      for securing access to Azure SQL Database and other Azure services.
    :descriptions:
    - :label: default
      :data: |-
        Managed service identity in App Service provides more security by eliminating secrets
        from the app, such as credentials in the connection strings. When registering with
        Azure Active Directory in App Service, the app will connect to other Azure services
        securely without the need for usernames and passwords.

        RATIONALE: App Service provides a highly scalable, self-patching web hosting service
        in Azure. It also provides a managed identity for apps, which is a turn-key solution
        for securing access to Azure SQL Database and other Azure services.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.5
      :level: 1
    :code: |
      control '9.5' do
        title 'Ensure that Register with Azure Active Directory is enabled on App Service'
        impact 1.0
        tag cis: 'azure:9.5'
        tag level: 1
        desc <<-DESC
          Managed service identity in App Service provides more security by eliminating secrets
          from the app, such as credentials in the connection strings. When registering with
          Azure Active Directory in App Service, the app will connect to other Azure services
          securely without the need for usernames and passwords.

          RATIONALE: App Service provides a highly scalable, self-patching web hosting service
          in Azure. It also provides a managed identity for apps, which is a turn-key solution
          for securing access to Azure SQL Database and other Azure services.
        DESC

        web_apps.each do | resource_group, webapp_list |
          webapp_list.each do |webapp|
            describe webapp do
              it { should have_identity }
              its('identity.principalId') { should_not be_nil }
            end
          end
        end
      end
    :source_location:
      :line: 2475
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-autotag-creator-d9730719 is expected to have identity'
      :run_time: 0.006154233
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-autotag-creator-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-autotag-creator-d9730719"
    - :status: failed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-autotag-creator-d9730719 identity.principalId is expected
        not to be nil'
      :run_time: 0.000425098
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-autotag-creator-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-autotag-creator-d9730719"
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-set-default-ttl-d9730719 is expected to have identity'
      :run_time: 0.002192343
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-set-default-ttl-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-set-default-ttl-d9730719"
    - :status: failed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-set-default-ttl-d9730719 identity.principalId is expected
        not to be nil'
      :run_time: 0.000120822
      :start_time: '2024-03-26T19:39:00+00:00'
      :message: |-
        expected: not nil
             got: nil
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-set-default-ttl-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-set-default-ttl-d9730719"
  - :id: '9.6'
    :title: Ensure That "PHP version" is the Latest, If Used to Run the Web App
    :desc: |-
      Periodically newer versions are released for PHP software either due to security flaws or
      to include additional functionality. Using the latest PHP version for web apps is recommended
      in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.
    :descriptions:
    - :label: default
      :data: |-
        Periodically newer versions are released for PHP software either due to security flaws or
        to include additional functionality. Using the latest PHP version for web apps is recommended
        in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.6
      :level: 1
    :code: |
      control '9.6' do
        title 'Ensure That "PHP version" is the Latest, If Used to Run the Web App'
        impact 1.0
        tag cis: 'azure:9.6'
        tag level: 1
        desc <<-DESC
          Periodically newer versions are released for PHP software either due to security flaws or
          to include additional functionality. Using the latest PHP version for web apps is recommended
          in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.
        DESC

        # Skip if no PHP apps are found.
        only_if('No PHP Apps found.') { !php_web_apps.empty? }
        php_web_apps.each do |php_app|
          describe php_app do
            it { should be_using_latest('php') }
          end
        end
      end
    :source_location:
      :line: 2501
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: No-op
      :run_time: 4.468e-06
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource: No-op
      :skip_message: 'Skipped control due to only_if condition: No PHP Apps found.'
      :resource_class: noop
      :resource_params: "[]"
      :resource_id: No-op
  - :id: '9.7'
    :title: Ensure that "Python version" is the Latest Stable Version, if Used to
      Run the Web App
    :desc: |-
      Periodically, newer versions are released for Python software either due to security flaws or
      to include additional functionality. Using the latest full Python version for web apps is recommended
      in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.
    :descriptions:
    - :label: default
      :data: |-
        Periodically, newer versions are released for Python software either due to security flaws or
        to include additional functionality. Using the latest full Python version for web apps is recommended
        in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.7
      :level: 1
    :code: |
      control '9.7' do
        title 'Ensure that "Python version" is the Latest Stable Version, if Used to Run the Web App'
        impact 1.0
        tag cis: 'azure:9.7'
        tag level: 1
        desc <<-DESC
          Periodically, newer versions are released for Python software either due to security flaws or
          to include additional functionality. Using the latest full Python version for web apps is recommended
          in order to take advantage of security fixes, if any, and/or additional functionalities of the newer version.
        DESC

        # Skip if no Python apps are found.
        only_if('No Python Apps found.') { !python_web_apps.empty? }
        python_web_apps.each do |python_web_app|
          describe python_web_app do
            it { should be_using_latest('python') }
          end
        end
      end
    :source_location:
      :line: 2521
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-autotag-creator-d9730719 is expected to be using latest
        "python"'
      :run_time: 0.383279544
      :start_time: '2024-03-26T19:39:00+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-autotag-creator-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-autotag-creator-d9730719"
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-set-default-ttl-d9730719 is expected to be using latest
        "python"'
      :run_time: 0.132088165
      :start_time: '2024-03-26T19:39:01+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-set-default-ttl-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-set-default-ttl-d9730719"
  - :id: '9.8'
    :title: Ensure that "Java version" is the latest, if used to run the Web App
    :desc: |-
      Periodically, newer versions are released for Java software either due to security flaws or
      to include additional functionality. Using the latest Java version for web apps is recommended
      in order to take advantage of security fixes, if any, and/or new functionalities of the newer version.
    :descriptions:
    - :label: default
      :data: |-
        Periodically, newer versions are released for Java software either due to security flaws or
        to include additional functionality. Using the latest Java version for web apps is recommended
        in order to take advantage of security fixes, if any, and/or new functionalities of the newer version.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.8
      :level: 1
    :code: |
      control '9.8' do
        title 'Ensure that "Java version" is the latest, if used to run the Web App'
        impact 1.0
        tag cis: 'azure:9.8'
        tag level: 1
        desc <<-DESC
          Periodically, newer versions are released for Java software either due to security flaws or
          to include additional functionality. Using the latest Java version for web apps is recommended
          in order to take advantage of security fixes, if any, and/or new functionalities of the newer version.
        DESC

        # Skip if no Java apps are found.
        only_if('No Java Apps found.') { !java_web_apps.empty? }
        java_web_apps.each do |java_app|
          describe java_app do
            it { should be_using_latest('java') }
          end
        end
      end
    :source_location:
      :line: 2541
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: skipped
      :code_desc: No-op
      :run_time: 6.496e-06
      :start_time: '2024-03-26T19:39:01+00:00'
      :resource: No-op
      :skip_message: 'Skipped control due to only_if condition: No Java Apps found.'
      :resource_class: noop
      :resource_params: "[]"
      :resource_id: No-op
  - :id: '9.9'
    :title: Ensure that HTTP Version is the Latest, if Used to Run the Web App
    :desc: "Periodically, newer versions are released for HTTP either due to security
      flaws or to\ninclude additional functionality. Using the latest HTTP version
      for web apps to take\nadvantage of security fixes, if any, and/or new functionalities
      of the newer version.\n\nRATIONALE: Newer versions may contain security enhancements
      and additional functionality.\nUsing the latest version is recommended in order
      to take advantage of enhancements and\nnew capabilities. With each software
      installation, organizations need to determine if\na given update meets their
      requirements. They must also verify the compatibility and\nsupport provided
      for any additional software against the update revision that is selected.\nHTTP
      2.0 has additional performance improvements on the head-of-line blocking problem
      of\nold HTTP version, header compression, and prioritization of requests. HTTP
      2.0 no longer\nsupports HTTP 1.1s chunked transfer encoding mechanism, as it
      provides its own, \nmore efficient, mechanisms for data streaming."
    :descriptions:
    - :label: default
      :data: "Periodically, newer versions are released for HTTP either due to security
        flaws or to\ninclude additional functionality. Using the latest HTTP version
        for web apps to take\nadvantage of security fixes, if any, and/or new functionalities
        of the newer version.\n\nRATIONALE: Newer versions may contain security enhancements
        and additional functionality.\nUsing the latest version is recommended in
        order to take advantage of enhancements and\nnew capabilities. With each software
        installation, organizations need to determine if\na given update meets their
        requirements. They must also verify the compatibility and\nsupport provided
        for any additional software against the update revision that is selected.\nHTTP
        2.0 has additional performance improvements on the head-of-line blocking problem
        of\nold HTTP version, header compression, and prioritization of requests.
        HTTP 2.0 no longer\nsupports HTTP 1.1s chunked transfer encoding mechanism,
        as it provides its own, \nmore efficient, mechanisms for data streaming."
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.9
      :level: 1
    :code: "control '9.9' do\n  title 'Ensure that HTTP Version is the Latest, if
      Used to Run the Web App'\n  impact 1.0\n  tag cis: 'azure:9.9'\n  tag level:
      1\n  desc <<-DESC\n    Periodically, newer versions are released for HTTP either
      due to security flaws or to\n    include additional functionality. Using the
      latest HTTP version for web apps to take\n    advantage of security fixes, if
      any, and/or new functionalities of the newer version.\n\n    RATIONALE: Newer
      versions may contain security enhancements and additional functionality.\n    Using
      the latest version is recommended in order to take advantage of enhancements
      and\n    new capabilities. With each software installation, organizations need
      to determine if\n    a given update meets their requirements. They must also
      verify the compatibility and\n    support provided for any additional software
      against the update revision that is selected.\n    HTTP 2.0 has additional performance
      improvements on the head-of-line blocking problem of\n    old HTTP version,
      header compression, and prioritization of requests. HTTP 2.0 no longer\n    supports
      HTTP 1.1s chunked transfer encoding mechanism, as it provides its own, \n    more
      efficient, mechanisms for data streaming.\n  DESC\n\n  web_apps.each do | resource_group,
      webapp_list |\n    webapp_list.each do |webapp|\n      describe webapp do\n
      \       its('configuration.properties') { should have_attributes(http20Enabled:
      true) }\n      end\n    end\n  end\nend\n"
    :source_location:
      :line: 2561
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-autotag-creator-d9730719 configuration.properties is
        expected to have attributes {:http20Enabled => true}'
      :run_time: 0.000349956
      :start_time: '2024-03-26T19:39:01+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-autotag-creator-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-autotag-creator-d9730719"
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-set-default-ttl-d9730719 configuration.properties is
        expected to have attributes {:http20Enabled => true}'
      :run_time: 0.000172064
      :start_time: '2024-03-26T19:39:01+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-set-default-ttl-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-set-default-ttl-d9730719"
  - :id: '9.10'
    :title: Ensure FTP deployments are Disabled
    :desc: |-
      By default, Azure Functions, Web, and API Services can be deployed over FTP. If FTP is
      required for an essential deployment workflow, FTPS should be required for FTP login for
      all App Service Apps and Functions.

      RATIONALE: Azure FTP deployment endpoints are public. An attacker listening to traffic on
      a wifi network used by a remote employee or a corporate network could see login traffic in
      clear-text which would then grant them full control of the code base of the app or service.
      This finding is more severe if User Credentials for deployment are set at the subscription
      level rather than using the default Application Credentials which are unique per App.
    :descriptions:
    - :label: default
      :data: |-
        By default, Azure Functions, Web, and API Services can be deployed over FTP. If FTP is
        required for an essential deployment workflow, FTPS should be required for FTP login for
        all App Service Apps and Functions.

        RATIONALE: Azure FTP deployment endpoints are public. An attacker listening to traffic on
        a wifi network used by a remote employee or a corporate network could see login traffic in
        clear-text which would then grant them full control of the code base of the app or service.
        This finding is more severe if User Credentials for deployment are set at the subscription
        level rather than using the default Application Credentials which are unique per App.
    :impact: 1.0
    :refs: []
    :tags:
      :cis: azure:9.10
      :level: 1
    :code: |-
      control '9.10' do
        title 'Ensure FTP deployments are Disabled'
        impact 1.0
        tag cis: 'azure:9.10'
        tag level: 1
        desc <<-DESC
          By default, Azure Functions, Web, and API Services can be deployed over FTP. If FTP is
          required for an essential deployment workflow, FTPS should be required for FTP login for
          all App Service Apps and Functions.

          RATIONALE: Azure FTP deployment endpoints are public. An attacker listening to traffic on
          a wifi network used by a remote employee or a corporate network could see login traffic in
          clear-text which would then grant them full control of the code base of the app or service.
          This finding is more severe if User Credentials for deployment are set at the subscription
          level rather than using the default Application Credentials which are unique per App.
        DESC
        web_apps.each do | resource_group, webapp_list |
          webapp_list.each do |webapp|
            describe webapp do
              its('configuration.properties.ftpsState') { should_not cmp "AllAllowed" }
            end
          end
        end
      end
    :source_location:
      :line: 2591
      :ref: controls/translated-controls.rb
    :waiver_data: {}
    :results:
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-autotag-creator-d9730719 configuration.properties.ftpsState
        is expected not to cmp == "AllAllowed"'
      :run_time: 0.000201583
      :start_time: '2024-03-26T19:39:01+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-autotag-creator-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-autotag-creator-d9730719"
    - :status: passed
      :code_desc: 'Azure Webapp - api_version: 2023-12-01 latest: cloud-custodian
        Microsoft.Web/sites az-set-default-ttl-d9730719 configuration.properties.ftpsState
        is expected not to cmp == "AllAllowed"'
      :run_time: 0.000137654
      :start_time: '2024-03-26T19:39:01+00:00'
      :resource_class: azure_webapp
      :resource_params: '[{:resource_group=>"cloud-custodian", :name=>"az-set-default-ttl-d9730719",
        :resource_provider=>"Microsoft.Web/sites", :allowed_parameters=>[:auth_settings_api_version,
        :configuration_api_version, :supported_stacks_api_version], :auth_settings_api_version=>"latest",
        :configuration_api_version=>"latest", :supported_stacks_api_version=>"latest"}]'
      :resource_id: "/subscriptions/b02e675a-cee0-49bd-a056-daa7ed05bf4e/resourceGroups/cloud-custodian/providers/Microsoft.Web/sites/az-set-default-ttl-d9730719"
  :status: loaded
  :status_message: ''
- :name: inspec-azure
  :version: 1.118.32
  :sha256: 3367f23b55a2e26d3be02adb433f122e795415f2e33d72e4dcd9760a4e53a76f
  :title: Azure Resource Pack
  :maintainer: Chef Software, Inc.
  :summary: This resource pack provides compliance resources for Azure.
  :license: Apache-2.0
  :copyright: Chef Software, Inc.
  :copyright_email: support@chef.io
  :supports:
  - :platform: azure
  :attributes: []
  :parent_profile: cis-azure-foundations-level1-v1.5.0
  :groups: []
  :controls: []
  :status: loaded
  :status_message: ''
:statistics:
  :duration: 8.712804684
:version: 6.6.0
